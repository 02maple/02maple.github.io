<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Elasticsearchæ•™ç¨‹ (ä¸€) | æ«å¶</title><meta name="author" content="Maple"><meta name="copyright" content="Maple"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="ElasticsearchåŸºç¡€ä½¿ç”¨æ•™ç¨‹ï¼Œdslè¯­æ³•ä»¥åŠrestfulAPI">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearchæ•™ç¨‹ (ä¸€)">
<meta property="og:url" content="https://dirtydata.cn/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="æ«å¶">
<meta property="og:description" content="ElasticsearchåŸºç¡€ä½¿ç”¨æ•™ç¨‹ï¼Œdslè¯­æ³•ä»¥åŠrestfulAPI">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dirtydata.cn/img/es.png">
<meta property="article:published_time" content="2024-12-25T16:00:00.000Z">
<meta property="article:modified_time" content="2024-12-26T05:43:40.515Z">
<meta property="article:author" content="Maple">
<meta property="article:tag" content="Elasticsearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dirtydata.cn/img/es.png"><link rel="shortcut icon" href="https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/maple-leaf.png"><link rel="canonical" href="https://dirtydata.cn/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E5%9F%BA%E7%A1%80/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  noticeOutdate: {"limitDay":300,"position":"top","messagePrev":"æ­¤æ–‡ç« ä¸º","messageNext":"å¤©ä¹‹å‰æ›´æ–°çš„æ–‡ç« , æ–‡ç« å†…å®¹æˆ–å·²å¤±æ•ˆ"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: Maple","link":"é“¾æ¥: ","source":"æ¥æº: æ«å¶","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Elasticsearchæ•™ç¨‹ (ä¸€)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-26 13:43:40'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="themes/butterfly/source/cssmycss.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/gufengnantou.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/es.png')"><nav id="nav"><span id="blog-info"><a href="/" title="æ«å¶"><span class="site-name">æ«å¶</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Elasticsearchæ•™ç¨‹ (ä¸€)<a class="post-edit-link" href="null_posts/ES åŸºç¡€.md" title="ç¼–è¾‘" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-12-25T16:00:00.000Z" title="å‘è¡¨äº 2024-12-26 00:00:00">2024-12-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-12-26T05:43:40.515Z" title="æ›´æ–°äº 2024-12-26 13:43:40">2024-12-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/">æ¡†æ¶æ•™ç¨‹</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Elasticsearchæ•™ç¨‹ (ä¸€)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ES-ä½¿ç”¨"><a href="#ES-ä½¿ç”¨" class="headerlink" title="ES ä½¿ç”¨"></a>ES ä½¿ç”¨</h1><h2 id="ES-å®‰è£…"><a href="#ES-å®‰è£…" class="headerlink" title="ES å®‰è£…"></a>ES å®‰è£…</h2><p>ElasticSearchå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:7.7.1 <span class="comment"># å®‰è£…es7.7.1ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure>

<p>eså®¹å™¨å†…éƒ¨éœ€è¦æŒ‚è½½çš„æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º</p>
<ul>
<li>å­˜æ”¾é…ç½®ç›¸å…³çš„ï¼š&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;config</li>
<li>å­˜æ”¾æ•°æ®ç›¸å…³çš„ï¼š&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data</li>
<li>å­˜æ”¾æ’ä»¶ç›¸å…³çš„ï¼š&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins</li>
</ul>
<blockquote>
<p>å¦‚æœè¦éƒ¨ç½²kibanaï¼Œåˆ™éœ€è¦è®©eså’Œkibanaäº’è”ï¼Œéœ€è¦åˆ©ç”¨dockeråˆ›å»ºä¸€ä¸ªç½‘ç»œ<code>docker network create es-net</code> è¯¦æƒ…å¯è‡ªå·±æœç´¢</p>
</blockquote>
<p>è¿™é‡Œæˆ‘ä»¬åœ¨å®¿ä¸»æœºåˆ›å»ºç›¸åº”çš„æ–‡ä»¶</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732876644345-12660c50-0234-47ad-a28c-900c4c3432b1.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732876644345-12660c50-0234-47ad-a28c-900c4c3432b1.png"></p>
<p>ä¸ºæ‰€æœ‰æ–‡ä»¶è¿›è¡Œæƒé™èµ‹äºˆ</p>
<figure class="highlight bash"><figcaption><span>title:èµ‹äºˆæƒé™</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 777 /mydata/es/config</span><br><span class="line"><span class="built_in">chmod</span> 777 /mydata/es/data</span><br><span class="line"><span class="built_in">chmod</span> 777 /mydata/es/plugins</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥å¯åŠ¨ä¸€ä¸ªç®€å•çš„å®¹å™¨</p>
<figure class="highlight docker"><figcaption><span>title:å¯åŠ¨ç®€å•çš„ESå®¹å™¨</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsearch:7.7.1</span></span><br></pre></td></tr></table></figure>

<p>å°†configé‡Œé¢çš„å†…å®¹æ‹·è´åˆ°å®¿ä¸»æœº</p>
<figure class="highlight docker"><figcaption><span>title:æ–‡ä»¶æ‹·è´</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp elasticsearch:/usr/share/elasticsearch/config /mydata/es</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤ä¸´æ—¶å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop elasticsearch</span><br><span class="line">docker <span class="built_in">rm</span> -f elasticsearch</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ <code>elasticsearch.yml</code>æ–‡ä»¶</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ<code>elasticsearch 8.x</code>ç‰ˆæœ¬é‡‡ç”¨äº†é»˜è®¤é…ç½®ï¼Œé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰ä¹‹å‰é‚£ä¹ˆå¤šå†…å®¹ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹çš„è¯ï¼Œç›´æ¥è‡ªå·±æ·»åŠ ç›¸åº”çš„å†…å®¹å³å¯ã€‚ä¾‹å¦‚es8é»˜è®¤å¼€å¯äº†è´¦å·æ ¡éªŒï¼Œå¦‚æœéœ€è¦å…³é—­çš„è¯ï¼Œè¾“å…¥ä¸‹å›¾æ‰€ç¤ºçš„é…ç½®å³å¯ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732878270154-a6c0b3cd-d8b4-4e65-a6ea-3d5216cc7f26.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732878270154-a6c0b3cd-d8b4-4e65-a6ea-3d5216cc7f26.png"></p>
<p>ä¿®æ”¹åï¼Œé‡æ–°å¯åŠ¨å®¹å™¨(<strong>ä¸€å®šè¦ç»™æƒé™ç»™æŒ‚è½½çš„æ–‡ä»¶å¤¹ï¼</strong>)</p>
<figure class="highlight docker"><figcaption><span>title:å¯åŠ¨eså®¹å™¨</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> \</span></span><br><span class="line"><span class="language-bash">--name es \</span></span><br><span class="line"><span class="language-bash">--privileged=<span class="literal">true</span> \</span></span><br><span class="line"><span class="language-bash">-p 9200:9200 \</span></span><br><span class="line"><span class="language-bash">-p 9300:9300 \</span></span><br><span class="line"><span class="language-bash">-v /mydata/es/config:/usr/share/elasticsearch/config \</span></span><br><span class="line"><span class="language-bash">-v /mydata/es/data:/usr/share/elasticsearch/data \</span></span><br><span class="line"><span class="language-bash">-v /mydata/es/plugins:/usr/share/elasticsearch/plugins \</span></span><br><span class="line"><span class="language-bash">-e ES_JAVA_OPTS=<span class="string">&quot;-Xms512m -Xmx512m&quot;</span> \</span></span><br><span class="line"><span class="language-bash">-e <span class="string">&quot;discovery.type=single-node&quot;</span> \</span></span><br><span class="line"><span class="language-bash">-d elasticsearch:8.2.0</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åå¯ä»¥è¿›è¡Œé¡µé¢çš„è®¿é—®<code>http://ä½ çš„ip:9200</code></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732876949792-66b60242-0b7f-4f5c-bbe5-a66cef0c1df3.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732876949792-66b60242-0b7f-4f5c-bbe5-a66cef0c1df3.png"></p>
<h3 id="esçš„ikåˆ†è¯å™¨å®‰è£…"><a href="#esçš„ikåˆ†è¯å™¨å®‰è£…" class="headerlink" title="esçš„ikåˆ†è¯å™¨å®‰è£…"></a>esçš„ikåˆ†è¯å™¨å®‰è£…</h3><p>esè‡ªå¸¦çš„åˆ†è¯å™¨æ— æ³•è§£æä¸­æ–‡å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…ikåˆ†è¯å™¨ç”¨äºè§£æä¸­æ–‡å†…å®¹</p>
<p><a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
<p>è¿™é‡ŒæŠŠ8.2.0ç‰ˆæœ¬çš„ä¸Šä¼ ä¸Šæ¥<a target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2024/zip/34408480/1732885252348-6ec9c22d-7e65-487e-ac9a-75779f8b4840.zip">ğŸ“elasticsearch-analysis-ik-8.2.0.zip</a></p>
<p>æ‰¾åˆ°ä¸ä½ esç‰ˆæœ¬ç›¸åº”çš„ikåˆ†è¯å™¨ï¼Œæˆ‘è¿™é‡Œæ˜¯8.2.0ç‰ˆæœ¬çš„es</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884562691-8099ced9-b72a-477a-a566-c12588849bcb.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884562691-8099ced9-b72a-477a-a566-c12588849bcb.png"></p>
<p>ä¸‹è½½å®Œæˆåè¿›è¡Œè§£å‹ï¼Œå°†è§£å‹åçš„æ–‡ä»¶ä¼ è¾“åˆ°linuxæœåŠ¡å™¨ä¸­ï¼Œç›®å½•å’Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884808410-e9bd0d72-25da-455e-ab72-876ee7d3f4d6.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884808410-e9bd0d72-25da-455e-ab72-876ee7d3f4d6.png"></p>
<p>è¿›å…¥å®¹å™¨å†…éƒ¨</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884893480-9039100e-0dc8-4840-b896-6eeece39440a.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884893480-9039100e-0dc8-4840-b896-6eeece39440a.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®¹å™¨å†…æ²¡æœ‰ä»»ä½•æ’ä»¶ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨çš„æ—¶å€™è¿›è¡Œäº†<strong>æ–‡ä»¶æŒ‚è½½</strong>ï¼Œå¯ä»¥<strong>ç›´æ¥åœ¨å®¿ä¸»æœºçš„pluginsæ–‡ä»¶å¤¹ä¸‹æ“ä½œ</strong>ï¼Œå¦‚æœå¯åŠ¨æ—¶æ²¡æœ‰æŒ‚è½½ï¼Œå¯ä»¥<strong>åˆ©ç”¨<code>docker cp</code>çš„å‘½ä»¤è¿›è¡Œæ–‡ä»¶çš„ä¼ è¾“</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884949958-e5897fc6-3a8f-4f8d-8e36-30a2c398a905.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884949958-e5897fc6-3a8f-4f8d-8e36-30a2c398a905.png"></p>
<p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨å®¿ä¸»æœºæ“ä½œï¼ŒæŠŠæ–‡ä»¶ä¼ è¾“è¿‡æ¥åï¼Œé‡å¯es</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732885097347-d2552a45-6494-443a-b937-41bd6c961909.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732885097347-d2552a45-6494-443a-b937-41bd6c961909.png"></p>
<p>é‡å¯æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬è¿›è¡Œæµ‹è¯•</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732885175892-60fb026f-0c8d-44c4-90b1-57abf3bb0fdf.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732885175892-60fb026f-0c8d-44c4-90b1-57abf3bb0fdf.png"></p>
<p>ä¸Šé¢é‡‡ç”¨åŸç”Ÿåˆ†è¯å™¨ï¼Œæ«å¶è¢«æ‹†å¼€äº†</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732885205012-738817dd-7c17-4b6e-a2a2-a7da51c8ed42.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732885205012-738817dd-7c17-4b6e-a2a2-a7da51c8ed42.png"></p>
<p>æ›´æ¢ä¸ºikåˆ†è¯å™¨åï¼Œå¯ä»¥å‘ç°ï¼Œæ«å¶æ²¡æœ‰è¢«æ‹†å¼€</p>
<h2 id="ES-headæ’ä»¶å®‰è£…"><a href="#ES-headæ’ä»¶å®‰è£…" class="headerlink" title="ES-headæ’ä»¶å®‰è£…"></a>ES-headæ’ä»¶å®‰è£…</h2><p><a href="es-head.zip">es-head.zip</a></p>
<p>ä¸‹è½½å¥½åï¼Œç›´æ¥æ‹–å…¥chromeï¼Œå®‰è£…æ’ä»¶</p>
<p>è¿æ¥å¥½esåï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç•Œé¢</p>
<p><img src="/image.png" alt="image.png"></p>
<h2 id="ESåŸºç¡€httpè°ƒç”¨"><a href="#ESåŸºç¡€httpè°ƒç”¨" class="headerlink" title="ESåŸºç¡€httpè°ƒç”¨"></a>ESåŸºç¡€httpè°ƒç”¨</h2><p>ä½¿ç”¨httpçš„putæ–¹æ³•ï¼Œä¼ ä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨åˆ›å»ºäº†ä¸€ä¸ªsubject_indexçš„ç´¢å¼•</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880526093-4f3763b5-981f-4b83-bbaf-a281368999a9.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880526093-4f3763b5-981f-4b83-bbaf-a281368999a9.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880572832-fdf55452-4e82-4857-a510-f18dc77ff3c5.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880572832-fdf55452-4e82-4857-a510-f18dc77ff3c5.png"></p>
<p>æŸ¥çœ‹ç´¢å¼•ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„æƒ…å†µ</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880806714-af635b86-e88d-4e83-88a5-0dbcee3c3e8c.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880806714-af635b86-e88d-4e83-88a5-0dbcee3c3e8c.png"></p>
<p>æŸ¥çœ‹å•ä¸ªç´¢å¼•</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880888703-16162d4d-960c-4464-9562-afc071782c32.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880888703-16162d4d-960c-4464-9562-afc071782c32.png"></p>
<p>åˆ é™¤å•ä¸ªç´¢å¼•</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880935931-b03975ad-17d8-4a1a-8d73-9867e37404dd.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732880935931-b03975ad-17d8-4a1a-8d73-9867e37404dd.png"></p>
<p>åˆ›å»ºæ–‡æ¡£</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732881245944-f1be22ae-8dc8-4e7f-bd93-db23f0b8df7d.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732881245944-f1be22ae-8dc8-4e7f-bd93-db23f0b8df7d.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732881287059-ad23ba7e-6cc4-4d00-81a0-52fa8d537c62.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732881287059-ad23ba7e-6cc4-4d00-81a0-52fa8d537c62.png"></p>
<p>æŸ¥çœ‹æ–‡æ¡£ï¼Œéœ€è¦ä¼ å…¥ä¸Šå›¾çš„<code>_id</code>çš„å€¼</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732881357585-3055247d-c2fd-447f-a760-f23bc794e166.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732881357585-3055247d-c2fd-447f-a760-f23bc794e166.png"></p>
<p>åˆ›å»ºæ˜ å°„ï¼Œä¸ºåˆ—è®¾ç½®å±æ€§</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732881992274-d911bf56-89e9-4009-b5e4-3fbbb0919cc3.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732881992274-d911bf56-89e9-4009-b5e4-3fbbb0919cc3.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732882069639-5a3775fd-f707-4a74-a0a9-84505dd5b4ea.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732882069639-5a3775fd-f707-4a74-a0a9-84505dd5b4ea.png"></p>
<p>æŸ¥çœ‹æ˜ å°„ï¼Œå°†è®¾ç½®æ˜ å°„çš„æ–¹æ³•æ”¹ä¸ºget</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732882311670-00b42ad4-664c-42fd-a0d3-90ed00a69bb7.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732882311670-00b42ad4-664c-42fd-a0d3-90ed00a69bb7.png"></p>
<p>æŸ¥çœ‹åŒ¹é…æ–‡æ¡£</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732883103375-fc697437-e4e5-4caa-b3a8-2d2fe2a59b8f.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732883103375-fc697437-e4e5-4caa-b3a8-2d2fe2a59b8f.png"></p>
<p>æŸ¥çœ‹ç‰¹å®šå­—æ®µåŒ¹é…æ–‡æ¡£</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732883295309-c22929e7-a352-4f7e-abda-db845968adbd.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732883295309-c22929e7-a352-4f7e-abda-db845968adbd.png"></p>
<p>åŸç”Ÿåˆ†è¯å™¨ä½¿ç”¨</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884119238-636a92da-ff75-4e0d-bfa6-25bfafd739d0.png" alt="https://cdn.nlark.com/yuque/0/2024/png/34408480/1732884119238-636a92da-ff75-4e0d-bfa6-25bfafd739d0.png"></p>
<h2 id="spring-data-esåŸºç¡€è°ƒç”¨"><a href="#spring-data-esåŸºç¡€è°ƒç”¨" class="headerlink" title="spring-data-esåŸºç¡€è°ƒç”¨"></a>spring-data-esåŸºç¡€è°ƒç”¨</h2><p>é¦–å…ˆéœ€è¦å¼•å…¥esçš„mavenåŒ…</p>
<p><img src="/image%201.png" alt="image.png"></p>
<p>æ³¨æ„è¿™é‡Œçš„ç‰ˆæœ¬ï¼Œä¸æ˜¯<code>springboot</code>çš„ç‰ˆæœ¬è¦ç›¸å¯¹åº”ï¼Œå¦‚æœç‰ˆæœ¬è¿‡é«˜ï¼Œå¯èƒ½ä¼šä¸<code>springboot</code>äº§ç”Ÿå†²çªï¼Œå¯¼è‡´é¡¹ç›®æ— æ³•å¯åŠ¨ã€‚åŒæ—¶2.4.2ç‰ˆæœ¬å¯¹åº”çš„<code>es</code>ç‰ˆæœ¬éœ€è¦æ˜¯7.xï¼Œå¦‚æœ<code>es</code>ç‰ˆæœ¬è¿‡é«˜ï¼Œä¾‹å¦‚8.xï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚</p>
<p>å¯¼å…¥æˆåŠŸåï¼Œå°±å¯ä»¥ä½¿ç”¨springdataesä¸­çš„æ¥å£äº†</p>
<figure class="highlight java"><figcaption><span>title:SubjectEsRepo</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SubjectEsRepo</span> <span class="keyword">extends</span> <span class="title class_">ElasticsearchRepository</span>&lt;SubjectInfoES, Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œæ³¨å…¥åˆ°springå®¹å™¨å†…ï¼Œç»§æ‰¿äº†<code>ElasticsearchRepository</code> ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å…¶ä¸­çš„æ–¹æ³•ã€‚</p>
<p><img src="/image%202.png" alt="image.png"></p>
<p>ä¸»è¦ä½¿ç”¨åˆ°çš„å°±æ˜¯<code>ElasticsearchRepository</code> æ¥å£ä»¥åŠä¸€ä¸ªåå«<code>ElasticsearchRestTemplate</code>çš„ç±»ã€‚</p>
<p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªè‡ªå·±å®šä¹‰çš„æ¥å£<code>SubjectEsService</code>ï¼Œç›´æ¥å±•ç¤ºå®ç°ç±»<code>SubjectEsServiceImpl</code>çš„ä»£ç </p>
<figure class="highlight java"><figcaption><span>fold title:SubjectEsServiceImpl</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubjectEsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SubjectEsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ElasticsearchRestTemplate elasticsearchRestTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SubjectEsRepo subjectEsRepo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createIndex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">IndexOperations</span> <span class="variable">indexOperations</span> <span class="operator">=</span> elasticsearchRestTemplate.indexOps(SubjectInfoES.class);</span><br><span class="line">        indexOperations.create();</span><br><span class="line">        <span class="type">Document</span> <span class="variable">mapping</span> <span class="operator">=</span> indexOperations.createMapping(SubjectInfoES.class);</span><br><span class="line">        indexOperations.putMapping(mapping);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getDocuments</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addDocuments</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;SubjectInfoES&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ•°æ®</span></span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">SubjectInfoES</span>(<span class="number">1</span>, <span class="string">&quot;redisæ˜¯ä»€ä¹ˆ&quot;</span>, <span class="string">&quot;æ˜¯ä¸€ç§ç¼“å­˜&quot;</span>, <span class="string">&quot;maple&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">SubjectInfoES</span>(<span class="number">2</span>, <span class="string">&quot;mysqlæ˜¯ä»€ä¹ˆ&quot;</span>, <span class="string">&quot;æ˜¯ä¸€ç§æ•°æ®åº“&quot;</span>, <span class="string">&quot;maple&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        subjectEsRepo.saveAll(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">find</span><span class="params">()</span> &#123;</span><br><span class="line">        Iterable&lt;SubjectInfoES&gt; all = subjectEsRepo.findAll();</span><br><span class="line">        all.forEach(subjectInfoES -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;find.subjectInfoES:&#123;&#125;&quot;</span>, subjectInfoES);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">search</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">NativeSearchQuery</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NativeSearchQueryBuilder</span>()</span><br><span class="line">                .withQuery(QueryBuilders.matchQuery(<span class="string">&quot;subjectName&quot;</span>, <span class="string">&quot;redis&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">        SearchHits&lt;SubjectInfoES&gt; searchHits = elasticsearchRestTemplate.search(query, SubjectInfoES.class);</span><br><span class="line">        List&lt;SearchHit&lt;SubjectInfoES&gt;&gt; hits = searchHits.getSearchHits();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit&lt;SubjectInfoES&gt; hit : hits) &#123;</span><br><span class="line">            <span class="type">SubjectInfoES</span> <span class="variable">subjectInfoES</span> <span class="operator">=</span> hit.getContent();</span><br><span class="line">            log.info(<span class="string">&quot;subjectInfoES:&#123;&#125;&quot;</span>, subjectInfoES);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>createIndex</code> æ–¹æ³•ç”¨äºåœ¨ Elasticsearch ä¸­åˆ›å»ºç´¢å¼•ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>è·å–ç´¢å¼•æ“ä½œå¯¹è±¡</strong>ï¼šé€šè¿‡ <code>elasticsearchRestTemplate.indexOps(SubjectInfoES.class)</code> è·å– <code>IndexOperations</code> å¯¹è±¡ï¼Œç”¨äºæ‰§è¡Œç´¢å¼•æ“ä½œã€‚</li>
<li><strong>åˆ›å»ºç´¢å¼•</strong>ï¼šè°ƒç”¨ <code>indexOperations.create()</code> æ–¹æ³•åˆ›å»ºç´¢å¼•ã€‚</li>
<li><strong>åˆ›å»ºæ˜ å°„</strong>ï¼šé€šè¿‡ <code>indexOperations.createMapping(SubjectInfoES.class)</code> åˆ›å»ºç´¢å¼•çš„æ˜ å°„ï¼ˆmappingï¼‰ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ <code>Document</code> å¯¹è±¡ä¸­ã€‚</li>
<li><strong>è®¾ç½®æ˜ å°„</strong>ï¼šè°ƒç”¨ <code>indexOperations.putMapping(mapping)</code> æ–¹æ³•ï¼Œå°†æ˜ å°„åº”ç”¨åˆ°ç´¢å¼•ä¸­ã€‚</li>
</ol>
<p><code>addDocuments</code>æ–¹æ³•ç¡®ä¿äº†åœ¨ Elasticsearch ä¸­ä¸º <code>SubjectInfoES</code> ç±»åˆ›å»ºç›¸åº”çš„ç´¢å¼•å’Œæ˜ å°„ã€‚</p>
<p><code>addDocuments</code> æ–¹æ³•ç”¨äºå‘ Elasticsearch ä¸­æ·»åŠ æ–‡æ¡£ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª <code>List&lt;SubjectInfoES&gt;</code> å¯¹è±¡ <code>list</code>ï¼Œç”¨äºå­˜å‚¨è¦æ·»åŠ çš„æ–‡æ¡£ã€‚</li>
<li>å‘ <code>list</code> ä¸­æ·»åŠ ä¸¤ä¸ª <code>SubjectInfoES</code> å¯¹è±¡ï¼Œåˆ†åˆ«åŒ…å«æ¨¡æ‹Ÿæ•°æ®ã€‚</li>
<li>ä½¿ç”¨ <code>subjectEsRepo.saveAll(list)</code> æ–¹æ³•å°† <code>list</code> ä¸­çš„æ‰€æœ‰æ–‡æ¡£ä¿å­˜åˆ° Elasticsearch ä¸­ã€‚</li>
</ol>
<p>è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯å°†ä¸€äº›æ¨¡æ‹Ÿæ•°æ®æ‰¹é‡æ·»åŠ åˆ° Elasticsearch ç´¢å¼•ä¸­ã€‚</p>
<p><code>find</code> æ–¹æ³•ä» Elasticsearch æ•°æ®åº“ä¸­æ£€ç´¢æ‰€æœ‰ <code>SubjectInfoES</code> å®ä½“ï¼Œå¹¶å°†æ¯ä¸ªå®ä½“çš„ä¿¡æ¯è®°å½•åˆ°æ—¥å¿—ä¸­ã€‚</p>
<p><code>search</code> æ–¹æ³•ç”¨äºæœç´¢æ–‡æ¡£ï¼Œåœ¨httpçš„è°ƒç”¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œéœ€è¦å°è£…çš„jsonç±»å‹éå¸¸çš„å¤æ‚ç¹çï¼Œè¿™é‡Œåˆ©ç”¨äº†<code>querybuilder</code> ç›´æ¥åˆ›å»ºäº†ä¸€ä¸ªæŸ¥è¯¢å¯¹è±¡ç”¨äºæŸ¥è¯¢ï¼Œå°±ç±»ä¼¼äºå°è£…äº†ä¸€ä¸ªhttpçš„è¯·æ±‚</p>
<p><img src="/image%203.png" alt="image.png"></p>
<h2 id="è‡ªå®šä¹‰-ES-å·¥å…·"><a href="#è‡ªå®šä¹‰-ES-å·¥å…·" class="headerlink" title="è‡ªå®šä¹‰ ES å·¥å…·"></a>è‡ªå®šä¹‰ ES å·¥å…·</h2><p>é¦–å…ˆå¯¼å…¥å¦‚ä¸‹ä¸‰ä¸ªåŒ…</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>7.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>7.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>7.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="å°è£…é›†ç¾¤-ES-è¿æ¥ï¼Œç»Ÿä¸€é…ç½®"><a href="#å°è£…é›†ç¾¤-ES-è¿æ¥ï¼Œç»Ÿä¸€é…ç½®" class="headerlink" title="å°è£…é›†ç¾¤ ES è¿æ¥ï¼Œç»Ÿä¸€é…ç½®"></a>å°è£…é›†ç¾¤ ES è¿æ¥ï¼Œç»Ÿä¸€é…ç½®</h3><p>æ–°å»ºä¸€ä¸ªåŒ…åä¸º<code>es</code> ï¼Œå°†ä¸esæœ‰å…³çš„ç±»éƒ½æ”¾åœ¨è¯¥åŒ…ä¸‹ï¼Œæ–°å»ºå¦‚ä¸‹å‡ ä¸ªç±»</p>
<p><img src="/image%204.png" alt="image.png"></p>
<ul>
<li><p><code>EsSourceData.java</code></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * esæ•°æ®æº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EsSourceData</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String docId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ä½œç”¨æ˜¯è¡¨ç¤ºä» Elasticsearch ä¸­è·å–çš„æ•°æ®æºã€‚å®ƒåŒ…å«ä¸¤ä¸ªå­—æ®µï¼š</p>
<ul>
<li><p><code>docId</code>ï¼šè¡¨ç¤ºæ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p>
</li>
<li><p><code>data</code>ï¼šè¡¨ç¤ºæ–‡æ¡£çš„å®é™…æ•°æ®ï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ã€‚</p>
</li>
<li><p><code>EsSearchRequest.java</code></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EsSearchRequest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BoolQueryBuilder bq;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String[] fields;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é¡µæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> from;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¡æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦éœ€è¦å¿«ç…§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean needScroll;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¿«ç…§æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long minutes;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’åºå­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sortName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’åºç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sortOrder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é«˜äº®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> HighlightBuilder highlightBuilder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ç”¨äºå°è£… Elasticsearch æŸ¥è¯¢è¯·æ±‚çš„å‚æ•°ã€‚å®ƒåŒ…å«äº†æŸ¥è¯¢æ¡ä»¶ã€æŸ¥è¯¢å­—æ®µã€åˆ†é¡µä¿¡æ¯ã€æ’åºä¿¡æ¯ä»¥åŠé«˜äº®è®¾ç½®ç­‰ã€‚é€šè¿‡è¿™ä¸ªç±»ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ„å»ºå’Œä¼ é€’ Elasticsearch æŸ¥è¯¢è¯·æ±‚çš„å„ç§å‚æ•°ã€‚</p>
<ul>
<li><p><code>EsIndexInfo.java</code></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EsIndexInfo</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">6010237985622125807L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é›†ç¾¤åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String clusterName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç´¢å¼•åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String indexName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>è¡¨ç¤º Elasticsearch ç´¢å¼•çš„ä¿¡æ¯ã€‚å®ƒåŒ…å«äº†é›†ç¾¤åç§° (<code>clusterName</code>) å’Œç´¢å¼•åç§° (<code>indexName</code>) ä¸¤ä¸ªå­—æ®µï¼Œç”¨äºå­˜å‚¨å’Œä¼ é€’ä¸ Elasticsearch ç´¢å¼•ç›¸å…³çš„åŸºæœ¬ä¿¡æ¯ã€‚</p>
<ul>
<li><p><code>EsClusterConfig.java</code></p>
  <figure class="highlight java"><figcaption><span>title:EsClusterConfig.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * esé›†ç¾¤é…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EsClusterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é›†ç¾¤åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é›†ç¾¤èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nodes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ç”¨äºè¡¨ç¤º Elasticsearch é›†ç¾¤çš„é…ç½®</p>
<ul>
<li><p><code>EsConfigProperties</code></p>
  <figure class="highlight java"><figcaption><span>unwrap title:EsConfigProperties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;es.cluster&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EsConfigProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;EsClusterConfig&gt; esConfigs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p>ç”¨äºåŠ è½½å’Œå­˜å‚¨ Elasticsearch é›†ç¾¤çš„é…ç½®ä¿¡æ¯ã€‚å®ƒé€šè¿‡ Spring Boot çš„ <code>@ConfigurationProperties</code>  æ³¨è§£ï¼Œå°†é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§æ˜ å°„åˆ°ç±»çš„å­—æ®µä¸­ã€‚</p>
<p><img src="/image%205.png" alt="image.png"></p>
<figure class="highlight java"><figcaption><span>title:EsRestClient</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EsRestClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, RestHighLevelClient&gt; clientMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EsConfigProperties esConfigProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;EsClusterConfig&gt; esConfigs = esConfigProperties.getEsConfigs();</span><br><span class="line">        <span class="keyword">for</span>(EsClusterConfig esClusterConfig : esConfigs)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;es client init start, clusterName:&#123;&#125;,node:&#123;&#125;&quot;</span>, esClusterConfig.getName(), esClusterConfig.getNodes());</span><br><span class="line">            <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> initRestClient(esClusterConfig);</span><br><span class="line">            <span class="keyword">if</span>(client != <span class="literal">null</span>)&#123;</span><br><span class="line">                clientMap.put(esClusterConfig.getName(), client);</span><br><span class="line">                log.info(<span class="string">&quot;es client init success, clusterName:&#123;&#125;,node:&#123;&#125;&quot;</span>, esClusterConfig.getName(), esClusterConfig.getNodes());</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                log.error(<span class="string">&quot;es client init fail, clusterName:&#123;&#125;,node:&#123;&#125;&quot;</span>, esClusterConfig.getName(), esClusterConfig.getNodes());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient <span class="title function_">initRestClient</span><span class="params">(EsClusterConfig esClusterConfig)</span> &#123;</span><br><span class="line">        String[] ipPortArr = esClusterConfig.getNodes().split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        List&lt;HttpHost&gt; httpHosts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(ipPortArr.length);</span><br><span class="line">        <span class="keyword">for</span> (String ipPort : ipPortArr) &#123;</span><br><span class="line">            String[] ipPortSplit = ipPort.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(ipPortSplit.length != <span class="number">2</span>)&#123;</span><br><span class="line">                log.error(<span class="string">&quot;es node config error, node:&#123;&#125;&quot;</span>, ipPort);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> ipPortSplit[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> Integer.parseInt(ipPortSplit[<span class="number">1</span>]);</span><br><span class="line">            <span class="type">HttpHost</span> <span class="variable">httpHost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;http://&quot;</span> + ip + <span class="string">&quot;:&quot;</span> + port);</span><br><span class="line">            httpHosts.add(httpHost);</span><br><span class="line">        &#125;</span><br><span class="line">        HttpHost[] hosts = <span class="keyword">new</span> <span class="title class_">HttpHost</span>[httpHosts.size()];</span><br><span class="line">        httpHosts.toArray(hosts);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">RestClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> RestClient.builder(hosts);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(builder);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;es client init fail, clusterName:&#123;&#125;,node:&#123;&#125;,error:&#123;&#125;&quot;</span>, esClusterConfig.getName(), esClusterConfig.getNodes(), e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆå§‹åŒ–å’Œç®¡ç†ä¸ Elasticsearch é›†ç¾¤çš„è¿æ¥ã€‚å®ƒé€šè¿‡è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„é›†ç¾¤ä¿¡æ¯ï¼Œåˆ›å»ºå¹¶ç»´æŠ¤ <code>RestHighLevelClient</code>   å®ä¾‹ï¼Œä»¥ä¾¿ä¸ä¸åŒçš„ Elasticsearch é›†ç¾¤è¿›è¡Œäº¤äº’</p>
<p>ä¸»è¦åŠŸèƒ½ï¼š</p>
<ol>
<li><strong>è¯»å–é…ç½®</strong>ï¼šé€šè¿‡ <code>EsConfigProperties</code> è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„ Elasticsearch é›†ç¾¤ä¿¡æ¯ã€‚</li>
<li><strong>åˆå§‹åŒ–å®¢æˆ·ç«¯</strong>ï¼šåœ¨ <code>initialize</code> æ–¹æ³•ä¸­ï¼Œéå†æ‰€æœ‰é…ç½®çš„é›†ç¾¤ä¿¡æ¯ï¼Œè°ƒç”¨ <code>initRestClient</code> æ–¹æ³•ä¸ºæ¯ä¸ªé›†ç¾¤åˆ›å»º <code>RestHighLevelClient</code> å®ä¾‹ã€‚</li>
<li><strong>ç®¡ç†å®¢æˆ·ç«¯</strong>ï¼šå°†åˆ›å»ºçš„ <code>RestHighLevelClient</code> å®ä¾‹å­˜å‚¨åœ¨ <code>clientMap</code> ä¸­ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚</li>
</ol>
<p>é€šè¿‡è¿™äº›è¿æ¥æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯ä¸ºäº†æ¨¡æ‹Ÿä¸ Elasticsearch (ES) è¿›è¡Œ HTTP è¿æ¥ä»¥åŠå‘é€è¯·æ±‚</p>
<p>@PostConstruct æ˜¯ä¸€ä¸ª Java æ ‡å‡†æ³¨è§£ï¼Œç”¨äº<strong>æ ‡è®°ä¸€ä¸ªæ–¹æ³•åœ¨ä¾èµ–æ³¨å…¥å®Œæˆåæ‰§è¡Œ</strong>ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåœ¨<strong>æ‰€æœ‰ä¾èµ–æ³¨å…¥å®Œæˆåã€ä½†åœ¨è¯¥ bean è¢«ä»»ä½•å…¶ä»– bean ä½¿ç”¨ä¹‹å‰è°ƒç”¨</strong>ã€‚</p>
<p>åˆå§‹åŒ–é€»è¾‘ï¼šåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œinitialize æ–¹æ³•è¢«æ ‡è®°ä¸º @PostConstructï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å°†åœ¨æ‰€æœ‰ä¾èµ–æ³¨å…¥å®Œæˆåè‡ªåŠ¨è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ– Elasticsearch å®¢æˆ·ç«¯ã€‚</p>
<p>ç¡®ä¿é¡ºåºï¼šé€šè¿‡ä½¿ç”¨ @PostConstructï¼Œå¯ä»¥ç¡®ä¿åœ¨ä»»ä½•ä¸šåŠ¡é€»è¾‘å¼€å§‹ä¹‹å‰ï¼ŒElasticsearch å®¢æˆ·ç«¯å·²ç»æ­£ç¡®åˆå§‹åŒ–ã€‚</p>
<h1 id="ES-å­¦ä¹ "><a href="#ES-å­¦ä¹ " class="headerlink" title="ES å­¦ä¹ "></a>ES å­¦ä¹ </h1><p>æ¥æº : [é»‘é©¬Elasticsearchå…¨å¥—æ•™ç¨‹][<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1b8411Z7w5]">https://www.bilibili.com/video/BV1b8411Z7w5]</a></p>
<h2 id="1-å€’æ’ç´¢å¼•"><a href="#1-å€’æ’ç´¢å¼•" class="headerlink" title="1. å€’æ’ç´¢å¼•"></a><strong>1. å€’æ’ç´¢å¼•</strong></h2><p>åœ¨ Elasticsearchï¼ˆESï¼‰ä¸­ï¼Œ<strong>å€’æ’ç´¢å¼•</strong>æ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºå¿«é€Ÿå…¨æ–‡æœç´¢ã€‚å®ƒçš„åç§°æ¥æºäºä¸ä¼ ç»Ÿçš„â€œæ­£æ’ç´¢å¼•â€ç›¸æ¯”çš„æ•°æ®ç»„ç»‡æ–¹å¼ã€‚</p>
<p><strong>1. ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿ</strong></p>
<p>å€’æ’ç´¢å¼•æ˜¯ä»æ–‡æ¡£åˆ°è¯çš„æ˜ å°„çš„åå‘è¿‡ç¨‹ã€‚</p>
<ul>
<li><p><strong>æ­£æ’ç´¢å¼•</strong>ï¼šè®°å½•æ¯ä¸ªæ–‡æ¡£åŒ…å«å“ªäº›è¯ã€‚</p>
<ul>
<li><p>ç¤ºä¾‹ï¼š</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ–‡æ¡£1: &quot;æˆ‘çˆ±å­¦ä¹ &quot;</span><br><span class="line">æ–‡æ¡£2: &quot;å­¦ä¹ ä½¿æˆ‘å¿«ä¹&quot;</span><br><span class="line">æ­£æ’ç´¢å¼•:</span><br><span class="line">  æ–‡æ¡£1 -&gt; æˆ‘, çˆ±, å­¦ä¹ </span><br><span class="line">  æ–‡æ¡£2 -&gt; å­¦ä¹ , ä½¿, æˆ‘, å¿«ä¹</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>å€’æ’ç´¢å¼•</strong>ï¼šè®°å½•æ¯ä¸ªè¯åœ¨å“ªäº›æ–‡æ¡£ä¸­å‡ºç°ã€‚</p>
<ul>
<li><p>ç¤ºä¾‹ï¼š</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å€’æ’ç´¢å¼•:</span><br><span class="line">  æˆ‘ -&gt; æ–‡æ¡£1, æ–‡æ¡£2</span><br><span class="line">  çˆ± -&gt; æ–‡æ¡£1</span><br><span class="line">  å­¦ä¹  -&gt; æ–‡æ¡£1, æ–‡æ¡£2</span><br><span class="line">  ä½¿ -&gt; æ–‡æ¡£2</span><br><span class="line">  å¿«ä¹ -&gt; æ–‡æ¡£2</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<aside>
ğŸ’¡

<p>å€’æ’ç´¢å¼•çš„æ ¸å¿ƒåœ¨äºï¼Œå®ƒå°†<strong>è¯è¯­ä½œä¸ºç´¢å¼•çš„é”®</strong>ï¼Œ<strong>å¿«é€Ÿå®šä½åŒ…å«è¯¥è¯çš„æ–‡æ¡£é›†åˆ</strong>ï¼Œè¿™ç§ç»“æ„ç‰¹åˆ«é€‚åˆæœç´¢åœºæ™¯ã€‚</p>
</aside>

<p><strong>2. ä¸ºä»€ä¹ˆå«â€œå€’æ’â€ç´¢å¼•ï¼Ÿ</strong></p>
<ul>
<li>åœ¨ä¼ ç»Ÿçš„æ­£æ’ç´¢å¼•ä¸­ï¼Œç³»ç»Ÿéœ€è¦ä»æ–‡æ¡£é€ä¸€æ‰«æå†…å®¹ï¼ˆæ¯”å¦‚æŒ‰æ–‡æ¡£ ID çš„é¡ºåºå­˜å‚¨æ¯ä¸ªæ–‡æ¡£çš„å†…å®¹ï¼‰ã€‚</li>
<li>è€Œ<strong>å€’æ’ç´¢å¼•å°†è¿™ç§â€œæ–‡æ¡£åˆ°è¯â€çš„å…³ç³»åè½¬ä¸ºâ€œè¯åˆ°æ–‡æ¡£â€</strong>ï¼Œåœ¨æœç´¢æ—¶ä¸éœ€è¦é€ä¸ªæ‰«ææ–‡æ¡£ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥æŸ¥æ‰¾åˆ°ç›¸å…³æ–‡æ¡£ã€‚<br>è¿™ç§â€œè¯ -&gt; æ–‡æ¡£â€çš„å…³ç³»ä¸ä¼ ç»Ÿæ­£æ’çš„â€œæ–‡æ¡£ -&gt; è¯â€ç›¸åï¼Œå› æ­¤ç§°ä¸º<strong>å€’æ’ç´¢å¼•</strong>ã€‚</li>
</ul>
<p><strong>3. å€’æ’ç´¢å¼•çš„ç»“æ„</strong></p>
<p>å€’æ’ç´¢å¼•ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>æ–‡æ¡£ï¼ˆ<code>Document</code>ï¼‰ï¼šç”¨æ¥æœç´¢çš„æ•°æ®ï¼Œå…¶ä¸­çš„æ¯ä¸€æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ã€‚ä¾‹å¦‚ä¸€ä¸ªç½‘é¡µã€ä¸€ä¸ªå•†å“ä¿¡æ¯</li>
</ul>
<ol>
<li><strong>è¯å…¸ï¼ˆTerm Dictionaryï¼‰</strong>ï¼šåŒ…å«æ‰€æœ‰è¯ï¼ˆå»é‡åçš„å…³é”®è¯åˆ—è¡¨ï¼‰ã€‚<ul>
<li>ä¾‹å¦‚ï¼š<code>[&quot;æˆ‘&quot;, &quot;å­¦ä¹ &quot;, &quot;å¿«ä¹&quot;, &quot;çˆ±&quot;, &quot;ä½¿&quot;]</code></li>
</ul>
</li>
<li><strong>å€’æ’è¡¨ï¼ˆPosting Listï¼‰</strong>ï¼šè®°å½•æ¯ä¸ªè¯åœ¨å“ªäº›æ–‡æ¡£ä¸­å‡ºç°ã€‚<ul>
<li><p>ä¾‹å¦‚ï¼š</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ -&gt; [1, 2]</span><br><span class="line">å­¦ä¹  -&gt; [1, 2]</span><br><span class="line">å¿«ä¹ -&gt; [2]</span><br><span class="line">çˆ± -&gt; [1]</span><br><span class="line">ä½¿ -&gt; [2]</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<p>æ‰©å±•çš„å€’æ’ç´¢å¼•è¿˜å¯ä»¥å­˜å‚¨ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>è¯é¢‘ï¼šè¯åœ¨æŸä¸ªæ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚</li>
<li>ä½ç½®ä¿¡æ¯ï¼šè¯åœ¨æ–‡æ¡£ä¸­çš„å…·ä½“ä½ç½®ï¼ˆç”¨äºçŸ­è¯­æŸ¥è¯¢ï¼‰ã€‚</li>
<li>æ–‡æ¡£æƒé‡ï¼šç”¨äºæ’åºçš„æƒé‡ä¿¡æ¯ã€‚</li>
</ul>
<p><strong>4. ä¸ºä»€ä¹ˆ Elasticsearch ä½¿ç”¨å€’æ’ç´¢å¼•ï¼Ÿ</strong></p>
<p>å€’æ’ç´¢å¼•æ˜¯<strong>å…¨æ–‡æ£€ç´¢</strong>çš„åŸºç¡€æ•°æ®ç»“æ„ï¼Œèƒ½æ˜¾è‘—æå‡æœç´¢æ•ˆç‡ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>å¿«é€Ÿå®šä½æ–‡æ¡£</strong>ï¼šæŸ¥è¯¢ä¸€ä¸ªè¯æ—¶ï¼Œç›´æ¥é€šè¿‡å€’æ’è¡¨æ‰¾åˆ°ç›¸å…³æ–‡æ¡£ IDï¼Œæ— éœ€é€ä¸€æ‰«ææ‰€æœ‰æ–‡æ¡£ã€‚</li>
<li><strong>é«˜æ•ˆæ”¯æŒå¤šç§æŸ¥è¯¢</strong>ï¼šå¦‚å…³é”®è¯æŸ¥è¯¢ã€çŸ­è¯­æŸ¥è¯¢ã€å¸ƒå°”æŸ¥è¯¢ç­‰ã€‚</li>
<li><strong>èŠ‚çœå­˜å‚¨ç©ºé—´</strong>ï¼šé€šè¿‡åˆ†è¯ã€å»é‡å’Œå‹ç¼©æŠ€æœ¯ï¼Œå€’æ’ç´¢å¼•èƒ½å¤§å¹…å‡å°‘å­˜å‚¨å¼€é”€ã€‚</li>
<li><strong>çµæ´»çš„ç›¸å…³æ€§è®¡ç®—</strong>ï¼šç»“åˆè¯é¢‘å’Œæ–‡æ¡£è¯„åˆ†æœºåˆ¶ï¼Œå¯ä»¥ä¸ºæœç´¢ç»“æœæ’åºï¼Œæé«˜ç›¸å…³æ€§ã€‚</li>
</ol>
<p><strong>5. å¯¹æ¯”æ­£æ’ç´¢å¼•çš„åŠ£åŠ¿</strong></p>
<p>å€’æ’ç´¢å¼•è™½ç„¶åœ¨æœç´¢åœºæ™¯ä¸‹æ€§èƒ½ä¼˜è¶Šï¼Œä½†å®ƒå¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼š</p>
<ul>
<li><strong>å®æ—¶æ€§è¾ƒå·®</strong>ï¼šæ–°å¢æ–‡æ¡£éœ€è¦æ›´æ–°å€’æ’ç´¢å¼•ï¼Œè€Œæ­£æ’ç´¢å¼•æ›´é€‚åˆå¿«é€Ÿå†™å…¥å’Œæ›´æ–°ã€‚</li>
<li><strong>ç»“æ„å¤æ‚</strong>ï¼šå®ç°å€’æ’ç´¢å¼•éœ€è¦æ›´å¤šçš„å†…å­˜å’Œè®¡ç®—èµ„æºã€‚</li>
<li><strong>ç´¢å¼•é™åˆ¶</strong>ï¼šåªèƒ½ç»™è¯æ¡åˆ›å»ºç´¢å¼•ï¼Œè€Œä¸æ˜¯å­—æ®µ</li>
<li><strong>æ— æ³•å­—æ®µæ’åº</strong>ï¼šæ— æ³•æ ¹æ®å­—æ®µåšæ’åº</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œå€’æ’ç´¢å¼•å’Œæ­£æ’ç´¢å¼•é€šå¸¸ç»“åˆä½¿ç”¨ï¼ˆä¾‹å¦‚ï¼šES ä½¿ç”¨å€’æ’ç´¢å¼•ç”¨äºå…¨æ–‡æ£€ç´¢ï¼Œç»“åˆå…¶ä»–æ•°æ®ç»“æ„å¤„ç†èšåˆæŸ¥è¯¢æˆ–æ’åºï¼‰ã€‚</p>
<p><strong>æ€»ç»“</strong></p>
<p>å€’æ’ç´¢å¼•å› å…¶<strong>â€œè¯åˆ°æ–‡æ¡£â€</strong>çš„æ˜ å°„ç‰¹ç‚¹å¾—åï¼Œæ˜¯å…¨æ–‡æ£€ç´¢çš„æ ¸å¿ƒæŠ€æœ¯ã€‚åœ¨ Elasticsearch ä¸­ï¼Œå€’æ’ç´¢å¼•é€šè¿‡é«˜æ•ˆçš„åˆ†è¯ã€å‹ç¼©å’Œä¼˜åŒ–æŠ€æœ¯ï¼Œä¸ºæµ·é‡æ–‡æœ¬æ•°æ®çš„å¿«é€Ÿæ£€ç´¢æä¾›äº†åšå®åŸºç¡€ã€‚</p>
<h2 id="2-ES-æ•°æ®åº“åŸºæœ¬æ¦‚å¿µ"><a href="#2-ES-æ•°æ®åº“åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="2. ES æ•°æ®åº“åŸºæœ¬æ¦‚å¿µ"></a>2. ES æ•°æ®åº“åŸºæœ¬æ¦‚å¿µ</h2><p>elasticsearchä¸­æœ‰å¾ˆå¤šç‹¬æœ‰çš„æ¦‚å¿µï¼Œä¸mysqlä¸­ç•¥æœ‰å·®åˆ«ï¼Œä½†ä¹Ÿæœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚</p>
<ol>
<li><p><strong>æ–‡æ¡£å’Œå­—æ®µ</strong></p>
<p> ä¸€ä¸ªæ–‡æ¡£å°±åƒæ•°æ®åº“é‡Œçš„ä¸€æ¡æ•°æ®ï¼Œå­—æ®µå°±åƒæ•°æ®åº“é‡Œçš„åˆ—</p>
<p> elasticsearchæ˜¯é¢å‘<strong>æ–‡æ¡£ï¼ˆDocumentï¼‰</strong>å­˜å‚¨çš„ï¼Œå¯ä»¥æ˜¯<strong>æ•°æ®åº“ä¸­çš„ä¸€æ¡å•†å“æ•°æ®</strong>ï¼Œä¸€ä¸ªè®¢å•ä¿¡æ¯ã€‚æ–‡æ¡£æ•°æ®ä¼šè¢«åºåˆ—åŒ–ä¸º<strong>jsonæ ¼å¼</strong>åå­˜å‚¨åœ¨elasticsearchä¸­ï¼š</p>
<p> <img src="/image%206.png" alt="image.png"></p>
<p> è€ŒJsonæ–‡æ¡£ä¸­å¾€å¾€åŒ…å«å¾ˆå¤šçš„<strong>å­—æ®µï¼ˆFieldï¼‰</strong>ï¼Œç±»ä¼¼äº<strong>mysqlæ•°æ®åº“ä¸­çš„åˆ—</strong>ã€‚</p>
</li>
<li><p><strong>ç´¢å¼•å’Œæ˜ å°„</strong></p>
<p> ç´¢å¼•å°±åƒæ•°æ®åº“é‡Œçš„è¡¨ï¼Œæ˜ å°„å°±åƒæ•°æ®åº“ä¸­å®šä¹‰çš„è¡¨ç»“æ„</p>
<p> ä¾‹å¦‚ï¼š</p>
<ul>
<li>æ‰€æœ‰ç”¨æˆ·æ–‡æ¡£ï¼Œå°±å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç§°ä¸ºç”¨æˆ·çš„ç´¢å¼•ï¼›</li>
<li>æ‰€æœ‰å•†å“çš„æ–‡æ¡£ï¼Œå¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç§°ä¸ºå•†å“çš„ç´¢å¼•ï¼›</li>
<li>æ‰€æœ‰è®¢å•çš„æ–‡æ¡£ï¼Œå¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç§°ä¸ºè®¢å•çš„ç´¢å¼•ï¼›</li>
</ul>
<p> <img src="/image%207.png" alt="image.png"></p>
<p> å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç´¢å¼•å½“åšæ˜¯æ•°æ®åº“ä¸­çš„è¡¨ã€‚</p>
<p> æ•°æ®åº“çš„è¡¨ä¼šæœ‰çº¦æŸä¿¡æ¯ï¼Œç”¨æ¥å®šä¹‰è¡¨çš„ç»“æ„ã€å­—æ®µçš„åç§°ã€ç±»å‹ç­‰ä¿¡æ¯ã€‚å› æ­¤ï¼Œç´¢å¼•åº“ä¸­å°±æœ‰<strong>æ˜ å°„ï¼ˆmappingï¼‰</strong>ï¼Œæ˜¯ç´¢å¼•ä¸­æ–‡æ¡£çš„å­—æ®µçº¦æŸä¿¡æ¯ï¼Œç±»ä¼¼è¡¨çš„ç»“æ„çº¦æŸã€‚
 </p>
</li>
<li><p><strong>MySQLä¸Elasticsearch</strong></p>
<p> å„è‡ªé•¿å¤„ï¼š</p>
<ul>
<li>MySQLï¼šæ“…é•¿äº‹åŠ¡ç±»å‹æ“ä½œï¼Œå¯ä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨å’Œä¸€è‡´æ€§</li>
<li>Elasticsearchï¼šæ“…é•¿æµ·é‡æ•°æ®çš„æœç´¢ã€åˆ†æã€è®¡ç®—</li>
</ul>
<p> æˆ‘ä»¬ç»Ÿä¸€çš„æŠŠ<strong>mysqlä¸elasticsearchçš„æ¦‚å¿µåšä¸€ä¸‹å¯¹æ¯”</strong>ï¼š</p>
<table>
<thead>
<tr>
<th><strong>MySQL</strong></th>
<th><strong>Elasticsearch</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Table</td>
<td>Index</td>
<td>ç´¢å¼•(index)ï¼Œå°±æ˜¯æ–‡æ¡£çš„é›†åˆï¼Œç±»ä¼¼æ•°æ®åº“çš„è¡¨(table)</td>
</tr>
<tr>
<td>Row</td>
<td>Document</td>
<td>æ–‡æ¡£ï¼ˆDocumentï¼‰ï¼Œå°±æ˜¯ä¸€æ¡æ¡çš„æ•°æ®ï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„è¡Œï¼ˆRowï¼‰ï¼Œæ–‡æ¡£éƒ½æ˜¯JSONæ ¼å¼</td>
</tr>
<tr>
<td>Column</td>
<td>Field</td>
<td>å­—æ®µï¼ˆFieldï¼‰ï¼Œå°±æ˜¯JSONæ–‡æ¡£ä¸­çš„å­—æ®µï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„åˆ—ï¼ˆColumnï¼‰</td>
</tr>
<tr>
<td>Schema</td>
<td>Mapping</td>
<td>Mappingï¼ˆæ˜ å°„ï¼‰æ˜¯ç´¢å¼•ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œä¾‹å¦‚å­—æ®µç±»å‹çº¦æŸã€‚ç±»ä¼¼æ•°æ®åº“çš„è¡¨ç»“æ„ï¼ˆSchemaï¼‰</td>
</tr>
<tr>
<td>SQL</td>
<td>DSL</td>
<td>DSLæ˜¯elasticsearchæä¾›çš„JSONé£æ ¼çš„è¯·æ±‚è¯­å¥ï¼Œç”¨æ¥æ“ä½œelasticsearchï¼Œå®ç°CRUD</td>
</tr>
</tbody></table>
<p> åœ¨ä¼ä¸šä¸­ï¼Œå¾€å¾€æ˜¯ä¸¤è€…ç»“åˆä½¿ç”¨ï¼š</p>
<ul>
<li>å¯¹å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„å†™æ“ä½œï¼Œä½¿ç”¨mysqlå®ç°</li>
<li>å¯¹æŸ¥è¯¢æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„æœç´¢éœ€æ±‚ï¼Œä½¿ç”¨elasticsearchå®ç°</li>
<li>ä¸¤è€…å†åŸºäºæŸç§æ–¹å¼ï¼Œå®ç°æ•°æ®çš„åŒæ­¥ï¼Œä¿è¯ä¸€è‡´æ€§</li>
</ul>
<p> <img src="/image%208.png" alt="image.png"></p>
</li>
</ol>
<h2 id="3-IKåˆ†è¯å™¨"><a href="#3-IKåˆ†è¯å™¨" class="headerlink" title="3. IKåˆ†è¯å™¨"></a>3. IKåˆ†è¯å™¨</h2><p><strong>åˆ†è¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li>åˆ›å»ºå€’æ’ç´¢å¼•æ—¶å¯¹æ–‡æ¡£åˆ†è¯</li>
<li>ç”¨æˆ·æœç´¢æ—¶ï¼Œå¯¹è¾“å…¥çš„å†…å®¹åˆ†è¯</li>
</ul>
<p><strong>IKåˆ†è¯å™¨æœ‰å‡ ç§æ¨¡å¼ï¼Ÿ</strong></p>
<ul>
<li><code>ik_smart</code>ï¼šæ™ºèƒ½åˆ‡åˆ†ï¼Œç²—ç²’åº¦</li>
<li><code>ik_max_word</code>ï¼šæœ€ç»†åˆ‡åˆ†ï¼Œç»†ç²’åº¦</li>
</ul>
<p><strong>IKåˆ†è¯å™¨å¦‚ä½•æ‹“å±•è¯æ¡ï¼Ÿå¦‚ä½•åœç”¨è¯æ¡ï¼Ÿ</strong></p>
<ul>
<li>åˆ©ç”¨configç›®å½•çš„IkAnalyzer.cfg.xmlæ–‡ä»¶æ·»åŠ æ‹“å±•è¯å…¸å’Œåœç”¨è¯å…¸</li>
<li>åœ¨è¯å…¸ä¸­æ·»åŠ æ‹“å±•è¯æ¡æˆ–è€…åœç”¨è¯æ¡</li>
</ul>
<p><strong>IKåˆ†è¯å™¨åŒ…å«ä¸¤ç§æ¨¡å¼ï¼š</strong></p>
<ul>
<li><code>ik_smart</code>ï¼šæœ€å°‘åˆ‡åˆ†</li>
<li><code>ik_max_word</code>ï¼šæœ€ç»†åˆ‡åˆ†</li>
</ul>
<p>åœ¨kibanaçš„Dev toolsä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p>
<blockquote>
<p>â€analyzerâ€œ å°±æ˜¯é€‰æ‹©åˆ†è¯å™¨æ¨¡å¼</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;é»‘é©¬ç¨‹åºå‘˜å­¦ä¹ javaå¤ªæ£’äº†&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>ç»“æœï¼š</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;é»‘é©¬&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ç¨‹åºå‘˜&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ç¨‹åº&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å‘˜&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å­¦ä¹ &quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;java&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ENGLISH&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å¤ªæ£’äº†&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">6</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å¤ªæ£’&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">7</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;äº†&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">8</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="æ‰©å±•è¯è¯å…¸"><a href="#æ‰©å±•è¯è¯å…¸" class="headerlink" title="æ‰©å±•è¯è¯å…¸"></a><strong>æ‰©å±•è¯è¯å…¸</strong></h3><p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œâ€œé€ è¯è¿åŠ¨â€ä¹Ÿè¶Šå‘çš„é¢‘ç¹ã€‚å‡ºç°äº†å¾ˆå¤šæ–°çš„è¯è¯­ï¼Œåœ¨åŸæœ‰çš„è¯æ±‡åˆ—è¡¨ä¸­å¹¶ä¸å­˜åœ¨ã€‚æ¯”å¦‚ï¼šâ€œå¥¥åŠ›ç»™â€ï¼Œâ€œç™½å«–â€ ç­‰ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬çš„è¯æ±‡ä¹Ÿéœ€è¦ä¸æ–­çš„æ›´æ–°ï¼ŒIKåˆ†è¯å™¨æä¾›äº†æ‰©å±•è¯æ±‡çš„åŠŸèƒ½ã€‚</p>
<p>1ï¼‰æ‰“å¼€IKåˆ†è¯å™¨configç›®å½•ï¼š</p>
<p><img src="https://img2023.cnblogs.com/blog/2729274/202302/2729274-20230205172005673-1129389907.png" alt="https://img2023.cnblogs.com/blog/2729274/202302/2729274-20230205172005673-1129389907.png"></p>
<p>2ï¼‰åœ¨IKAnalyzer.cfg.xmlé…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">properties</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">comment</span>&gt;</span>IK Analyzer æ‰©å±•é…ç½®<span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ *** æ·»åŠ æ‰©å±•è¯å…¸--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_dict&quot;</span>&gt;</span>ext.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3ï¼‰æ–°å»ºä¸€ä¸ª ext.dicï¼Œå¯ä»¥å‚è€ƒconfigç›®å½•ä¸‹å¤åˆ¶ä¸€ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç™½å«–</span><br><span class="line">å¥¥åŠ›ç»™</span><br></pre></td></tr></table></figure>

<p>4ï¼‰é‡å¯elasticsearch</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker restart es</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ æ—¥å¿—</span></span><br><span class="line">docker logs -f elasticsearch</span><br></pre></td></tr></table></figure>

<p><img src="https://img2023.cnblogs.com/blog/2729274/202302/2729274-20230205172011932-1622225700.png" alt="https://img2023.cnblogs.com/blog/2729274/202302/2729274-20230205172011932-1622225700.png"></p>
<p>æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½ext.dicé…ç½®æ–‡ä»¶</p>
<p>5ï¼‰æµ‹è¯•æ•ˆæœï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¼ æ™ºæ’­å®¢Javaå°±ä¸šè¶…è¿‡90%,å¥¥åŠ›ç»™ï¼&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨Windowsè®°äº‹æœ¬ç¼–è¾‘</p>
</blockquote>
<h3 id="åœç”¨è¯è¯å…¸"><a href="#åœç”¨è¯è¯å…¸" class="headerlink" title="åœç”¨è¯è¯å…¸"></a><strong>åœç”¨è¯è¯å…¸</strong></h3><p>åœ¨äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œåœ¨ç½‘ç»œé—´ä¼ è¾“çš„é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥å¾ˆå¤šè¯­è¨€æ˜¯ä¸å…è®¸åœ¨ç½‘ç»œä¸Šä¼ é€’çš„ï¼Œå¦‚ï¼šå…³äºå®—æ•™ã€æ”¿æ²»ç­‰æ•æ„Ÿè¯è¯­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æœç´¢æ—¶ä¹Ÿåº”è¯¥å¿½ç•¥å½“å‰è¯æ±‡ã€‚</p>
<p>IKåˆ†è¯å™¨ä¹Ÿæä¾›äº†å¼ºå¤§çš„åœç”¨è¯åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬åœ¨ç´¢å¼•æ—¶å°±ç›´æ¥å¿½ç•¥å½“å‰çš„åœç”¨è¯æ±‡è¡¨ä¸­çš„å†…å®¹ã€‚</p>
<p>1ï¼‰IKAnalyzer.cfg.xmlé…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">properties</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">comment</span>&gt;</span>IK Analyzer æ‰©å±•é…ç½®<span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_dict&quot;</span>&gt;</span>ext.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸  *** æ·»åŠ åœç”¨è¯è¯å…¸--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_stopwords&quot;</span>&gt;</span>stopword.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3ï¼‰åœ¨ stopword.dic æ·»åŠ åœç”¨è¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¤§å¸…é€¼</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4ï¼‰é‡å¯elasticsearch</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¯æœåŠ¡</span></span><br><span class="line">docker restart es</span><br><span class="line">docker restart kibana</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ æ—¥å¿—</span></span><br><span class="line">docker logs -f elasticsearch</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½stopword.dicé…ç½®æ–‡ä»¶</p>
<p>5ï¼‰æµ‹è¯•æ•ˆæœï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æˆ‘æ˜¯çœŸçš„ä¼šè°¢Javaå°±ä¸šç‡è¶…è¿‡95%,å¤§å¸…é€¼éƒ½ç‚¹èµç™½å«–,å¥¥åŠ›ç»™ï¼&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨Windowsè®°äº‹æœ¬ç¼–è¾‘</p>
</blockquote>
<h2 id="4-ç´¢å¼•åº“æ“ä½œ"><a href="#4-ç´¢å¼•åº“æ“ä½œ" class="headerlink" title="4. ç´¢å¼•åº“æ“ä½œ"></a>4. ç´¢å¼•åº“æ“ä½œ</h2><p>ç´¢å¼•åº“å°±ç±»ä¼¼æ•°æ®åº“è¡¨ï¼Œmappingæ˜ å°„å°±ç±»ä¼¼è¡¨çš„ç»“æ„ã€‚</p>
<p>æˆ‘ä»¬è¦å‘esä¸­å­˜å‚¨æ•°æ®ï¼Œå¿…é¡»å…ˆåˆ›å»ºâ€œåº“â€å’Œâ€œè¡¨â€ã€‚</p>
<h3 id="Mappingæ˜ å°„å±æ€§"><a href="#Mappingæ˜ å°„å±æ€§" class="headerlink" title="Mappingæ˜ å°„å±æ€§"></a>Mappingæ˜ å°„å±æ€§</h3><p>mappingæ˜¯å¯¹ç´¢å¼•åº“ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œå¸¸è§çš„mappingå±æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>typeï¼šå­—æ®µæ•°æ®ç±»å‹ï¼Œå¸¸è§çš„ç®€å•ç±»å‹æœ‰ï¼š</p>
<ul>
<li><p>å­—ç¬¦ä¸²ï¼š<strong>textï¼ˆå¯åˆ†è¯çš„æ–‡æœ¬ï¼‰</strong>ã€<strong>keywordï¼ˆç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ï¼šå“ç‰Œã€å›½å®¶ã€ipåœ°å€ï¼‰</strong></p>
<blockquote>
<p><strong>keywordç±»å‹åªèƒ½æ•´ä½“æœç´¢ï¼Œä¸æ”¯æŒæœç´¢éƒ¨åˆ†å†…å®¹</strong></p>
</blockquote>
</li>
<li><p>æ•°å€¼ï¼šlongã€integerã€shortã€byteã€doubleã€floatã€</p>
</li>
<li><p>å¸ƒå°”ï¼šboolean</p>
</li>
<li><p>æ—¥æœŸï¼šdate</p>
</li>
<li><p>å¯¹è±¡ï¼šobject</p>
</li>
</ul>
</li>
<li><p><strong>indexï¼šæ˜¯å¦åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrue</strong></p>
<blockquote>
<p>å®é™…ä¸Šä¸æ˜¯æ¯ä¸ªå­—æ®µéƒ½éœ€è¦åˆ›å»ºå€’æ’ç´¢å¼•è¿›è¡Œæœç´¢ï¼Œæ¯”å¦‚é‚®ç®±ï¼Œå•†å“å›¾ç‰‡çš„urlåœ°å€ç±»ä¼¼å­—æ®µä¸éœ€è¦å‚ä¸æœç´¢ï¼Œå…·ä½“éœ€è¦çœ‹ä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœä¸å‚ä¸ï¼Œéœ€è¦è®¾ç½®ä¸ºfalse</p>
</blockquote>
</li>
<li><p>analyzerï¼šä½¿ç”¨å“ªç§åˆ†è¯å™¨</p>
</li>
<li><p>propertiesï¼šè¯¥å­—æ®µçš„å­å­—æ®µ</p>
</li>
</ul>
<p>ä¾‹å¦‚ä¸‹é¢çš„jsonæ–‡æ¡£ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span>Â <span class="number">21</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span>Â <span class="number">52.1</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;isMarried&quot;</span><span class="punctuation">:</span>Â <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;çœŸç›¸åªæœ‰ä¸€ä¸ªï¼&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;zy@itcast.cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span><span class="number">99.1</span><span class="punctuation">,</span> <span class="number">99.5</span><span class="punctuation">,</span> <span class="number">98.9</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;firstName&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;æŸ¯&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;lastName&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å—&quot;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„æ¯ä¸ªå­—æ®µæ˜ å°„ï¼ˆmappingï¼‰ï¼š</p>
<ul>
<li>ageï¼šç±»å‹ä¸º integerï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨</li>
<li>weightï¼šç±»å‹ä¸ºfloatï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨</li>
<li>isMarriedï¼šç±»å‹ä¸ºbooleanï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨</li>
<li>infoï¼šç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œéœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯textï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›åˆ†è¯å™¨å¯ä»¥ç”¨ik_smart</li>
<li>emailï¼šç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸éœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯keywordï¼›ä¸å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºfalseï¼›æ— éœ€åˆ†è¯å™¨</li>
<li>scoreï¼šè™½ç„¶æ˜¯æ•°ç»„ï¼Œä½†æ˜¯æˆ‘ä»¬åªçœ‹å…ƒç´ çš„ç±»å‹ï¼Œç±»å‹ä¸ºfloatï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨</li>
<li>nameï¼šç±»å‹ä¸ºobjectï¼Œéœ€è¦å®šä¹‰å¤šä¸ªå­å±æ€§<ul>
<li>name.firstNameï¼›ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸éœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯keywordï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨</li>
<li>name.lastNameï¼›ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸éœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯keywordï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨</li>
</ul>
</li>
</ul>
<h3 id="ç´¢å¼•åº“-CRUD"><a href="#ç´¢å¼•åº“-CRUD" class="headerlink" title="ç´¢å¼•åº“ CRUD"></a>ç´¢å¼•åº“ CRUD</h3><blockquote>
<p>CRUDç®€å•æè¿°ï¼š</p>
<ul>
<li>åˆ›å»ºç´¢å¼•åº“ï¼šPUT &#x2F;ç´¢å¼•åº“å</li>
<li>æŸ¥è¯¢ç´¢å¼•åº“ï¼šGET &#x2F;ç´¢å¼•åº“å</li>
<li>åˆ é™¤ç´¢å¼•åº“ï¼šDELETE &#x2F;ç´¢å¼•åº“å</li>
<li>ä¿®æ”¹ç´¢å¼•åº“ï¼ˆæ·»åŠ å­—æ®µï¼‰ï¼šPUT &#x2F;ç´¢å¼•åº“å&#x2F;_mapping</li>
</ul>
</blockquote>
<p>è¿™é‡Œç»Ÿä¸€ä½¿ç”¨Kibanaç¼–å†™DSLçš„æ–¹å¼æ¥æ¼”ç¤ºã€‚</p>
<h4 id="1-åˆ›å»ºç´¢å¼•åº“å’Œæ˜ å°„"><a href="#1-åˆ›å»ºç´¢å¼•åº“å’Œæ˜ å°„" class="headerlink" title="1.  åˆ›å»ºç´¢å¼•åº“å’Œæ˜ å°„"></a>1.  <strong>åˆ›å»ºç´¢å¼•åº“å’Œæ˜ å°„</strong></h4><p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šPUT</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;ç´¢å¼•åº“åï¼Œå¯ä»¥è‡ªå®šä¹‰</li>
<li>è¯·æ±‚å‚æ•°ï¼šmappingæ˜ å°„</li>
</ul>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PUTÂ /ç´¢å¼•åº“åç§°</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">	  <span class="attr">&quot;å­—æ®µå&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">	  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	  <span class="attr">&quot;å­—æ®µå2&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;index&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;false&quot;</span></span><br><span class="line">	  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	  <span class="attr">&quot;å­—æ®µå3&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">		  <span class="attr">&quot;å­å­—æ®µ&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;keyword&quot;</span></span><br><span class="line">		  <span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">// ...ç•¥</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">PUT /conan</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">	  <span class="attr">&quot;column1&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">	  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	  <span class="attr">&quot;column2&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">	  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	  <span class="attr">&quot;column3&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		  <span class="attr">&quot;å­å­—æ®µ1&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">		  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		  <span class="attr">&quot;å­å­—æ®µ2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">		  <span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	  <span class="comment">// ...ç•¥</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-æŸ¥è¯¢ç´¢å¼•åº“"><a href="#2-æŸ¥è¯¢ç´¢å¼•åº“" class="headerlink" title="2. æŸ¥è¯¢ç´¢å¼•åº“"></a>2. <strong>æŸ¥è¯¢ç´¢å¼•åº“</strong></h4><p><strong>åŸºæœ¬è¯­æ³•</strong>ï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šGET</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;ç´¢å¼•åº“å</li>
<li>è¯·æ±‚å‚æ•°ï¼šæ— </li>
</ul>
<p><strong>æ ¼å¼</strong>ï¼š</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /ç´¢å¼•åº“å</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p><img src="/image%209.png" alt="image.png"></p>
<h4 id="3-ä¿®æ”¹ç´¢å¼•åº“"><a href="#3-ä¿®æ”¹ç´¢å¼•åº“" class="headerlink" title="3. ä¿®æ”¹ç´¢å¼•åº“"></a>3. <strong>ä¿®æ”¹ç´¢å¼•åº“</strong></h4><blockquote>
<p><strong>è¿™é‡Œçš„ä¿®æ”¹æ˜¯åªèƒ½å¢åŠ æ–°çš„å­—æ®µåˆ°mappingä¸­</strong></p>
</blockquote>
<p>å€’æ’ç´¢å¼•ç»“æ„è™½ç„¶ä¸å¤æ‚ï¼Œä½†æ˜¯ä¸€æ—¦æ•°æ®ç»“æ„æ”¹å˜ï¼ˆæ¯”å¦‚æ”¹å˜äº†åˆ†è¯å™¨ï¼‰ï¼Œå°±éœ€è¦é‡æ–°åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œè¿™ç®€ç›´æ˜¯ç¾éš¾ã€‚å› æ­¤ç´¢å¼•åº“<strong>ä¸€æ—¦åˆ›å»ºï¼Œæ— æ³•ä¿®æ”¹mapping</strong>ã€‚</p>
<p>è™½ç„¶<strong>æ— æ³•ä¿®æ”¹mappingä¸­å·²æœ‰çš„å­—æ®µ</strong>ï¼Œä½†æ˜¯å´<strong>å…è®¸æ·»åŠ æ–°çš„å­—æ®µ</strong>åˆ°mappingä¸­ï¼Œå› ä¸ºä¸ä¼šå¯¹å€’æ’ç´¢å¼•äº§ç”Ÿå½±å“ã€‚</p>
<p><strong>è¯­æ³•è¯´æ˜</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /ç´¢å¼•åº“å/_mapping</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;æ–°å­—æ®µå&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">	  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p><img src="/image%2010.png" alt="image.png"></p>
<h4 id="4-åˆ é™¤ç´¢å¼•åº“"><a href="#4-åˆ é™¤ç´¢å¼•åº“" class="headerlink" title="4. åˆ é™¤ç´¢å¼•åº“"></a>4. <strong>åˆ é™¤ç´¢å¼•åº“</strong></h4><p><strong>è¯­æ³•ï¼š</strong></p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šDELETE</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;ç´¢å¼•åº“å</li>
<li>è¯·æ±‚å‚æ•°ï¼šæ— </li>
</ul>
<p><strong>æ ¼å¼ï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /ç´¢å¼•åº“å</span><br></pre></td></tr></table></figure>

<p>åœ¨kibanaä¸­æµ‹è¯•ï¼š</p>
<p><img src="/image%2011.png" alt="image.png"></p>
<h2 id="5-æ–‡æ¡£æ“ä½œ"><a href="#5-æ–‡æ¡£æ“ä½œ" class="headerlink" title="5. æ–‡æ¡£æ“ä½œ"></a>5. æ–‡æ¡£æ“ä½œ</h2><h4 id="1-æ–°å¢æ–‡æ¡£"><a href="#1-æ–°å¢æ–‡æ¡£" class="headerlink" title="1. æ–°å¢æ–‡æ¡£"></a>1. <strong>æ–°å¢æ–‡æ¡£</strong></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POSTÂ /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;å­—æ®µ1&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼1&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;å­—æ®µ2&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼2&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;å­—æ®µ3&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;å­å±æ€§1&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼3&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;å­å±æ€§2&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼4&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">copy</span><br><span class="line">POSTÂ /heima/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;info&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;çœŸç›¸åªæœ‰ä¸€ä¸ªï¼&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;zy@itcast.cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;firstName&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;æŸ¯&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;lastName&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å—&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>å“åº”ï¼š</strong></p>
<p><img src="/image%2012.png" alt="image.png"></p>
<h4 id="2-æŸ¥è¯¢æ–‡æ¡£"><a href="#2-æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="2. æŸ¥è¯¢æ–‡æ¡£"></a>2. <strong>æŸ¥è¯¢æ–‡æ¡£</strong></h4><p>æ ¹æ®resté£æ ¼ï¼Œæ–°å¢æ˜¯postï¼ŒæŸ¥è¯¢åº”è¯¥æ˜¯getï¼Œä¸è¿‡æŸ¥è¯¢ä¸€èˆ¬éƒ½éœ€è¦æ¡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠæ–‡æ¡£idå¸¦ä¸Šã€‚</p>
<p><strong>è¯­æ³•ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /<span class="punctuation">&#123;</span>ç´¢å¼•åº“åç§°<span class="punctuation">&#125;</span>/_doc/<span class="punctuation">&#123;</span>id<span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">//æ‰¹é‡æŸ¥è¯¢ï¼šæŸ¥è¯¢è¯¥ç´¢å¼•åº“ä¸‹çš„å…¨éƒ¨æ–‡æ¡£</span></span><br><span class="line">GET /<span class="punctuation">&#123;</span>ç´¢å¼•åº“åç§°<span class="punctuation">&#125;</span>/_search</span><br></pre></td></tr></table></figure>

<p><strong>é€šè¿‡kibanaæŸ¥çœ‹æ•°æ®ï¼š</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> /heima/_doc/<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><strong>æŸ¥çœ‹ç»“æœï¼š</strong></p>
<p><img src="/image%2013.png" alt="image.png"></p>
<h4 id="3-åˆ é™¤æ–‡æ¡£"><a href="#3-åˆ é™¤æ–‡æ¡£" class="headerlink" title="3. åˆ é™¤æ–‡æ¡£"></a>3. <strong>åˆ é™¤æ–‡æ¡£</strong></h4><p>åˆ é™¤ä½¿ç”¨DELETEè¯·æ±‚ï¼ŒåŒæ ·ï¼Œéœ€è¦æ ¹æ®idè¿›è¡Œåˆ é™¤ï¼š</p>
<p><strong>è¯­æ³•ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /&#123;ç´¢å¼•åº“å&#125;/_doc/idå€¼</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ ¹æ®idåˆ é™¤æ•°æ®</span><br><span class="line">DELETE /heima/_doc/<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><strong>ç»“æœï¼š</strong></p>
<p><img src="/image%2014.png" alt="image.png"></p>
<h4 id="4-ä¿®æ”¹æ–‡æ¡£"><a href="#4-ä¿®æ”¹æ–‡æ¡£" class="headerlink" title="4. ä¿®æ”¹æ–‡æ¡£"></a>4. <strong>ä¿®æ”¹æ–‡æ¡£</strong></h4><p>ä¿®æ”¹æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li><strong>å…¨é‡ä¿®æ”¹</strong>ï¼šç›´æ¥è¦†ç›–åŸæ¥çš„æ–‡æ¡£</li>
<li><strong>å¢é‡ä¿®æ”¹</strong>ï¼šä¿®æ”¹æ–‡æ¡£ä¸­çš„éƒ¨åˆ†å­—æ®µ</li>
</ul>
<p><strong>4.1 å…¨é‡ä¿®æ”¹</strong></p>
<p>å…¨é‡ä¿®æ”¹æ˜¯è¦†ç›–åŸæ¥çš„æ–‡æ¡£ï¼Œå…¶æœ¬è´¨æ˜¯ï¼š</p>
<blockquote>
<p>è·Ÿæ–°å¢ç±»ä¼¼ï¼Œåªä¸è¿‡POSTæ”¹ä¸ºäº†PUT</p>
</blockquote>
<ul>
<li>æ ¹æ®æŒ‡å®šçš„idåˆ é™¤æ–‡æ¡£</li>
<li>æ–°å¢ä¸€ä¸ªç›¸åŒidçš„æ–‡æ¡£</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæ ¹æ®idåˆ é™¤æ—¶ï¼Œidä¸å­˜åœ¨ï¼Œç¬¬äºŒæ­¥çš„æ–°å¢ä¹Ÿä¼šæ‰§è¡Œï¼Œä¹Ÿå°±ä»ä¿®æ”¹å˜æˆäº†æ–°å¢æ“ä½œäº†ã€‚</p>
<p><strong>è¯­æ³•ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUTÂ /<span class="punctuation">&#123;</span>ç´¢å¼•åº“å<span class="punctuation">&#125;</span>/_doc/æ–‡æ¡£id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;å­—æ®µ1&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼1&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;å­—æ®µ2&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼2&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">// ... ç•¥&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUTÂ /heima/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;info&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;é»‘é©¬ç¨‹åºå‘˜é«˜çº§Javaè®²å¸ˆ&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;zy@itcast.cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;firstName&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;äº‘&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;lastName&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;èµµ&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>4.2 å¢é‡ä¿®æ”¹</strong></p>
<p>å¢é‡ä¿®æ”¹æ˜¯<strong>åªä¿®æ”¹æŒ‡å®šidåŒ¹é…çš„æ–‡æ¡£ä¸­çš„éƒ¨åˆ†å­—æ®µ</strong>ã€‚</p>
<p><strong>è¯­æ³•ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POSTÂ /<span class="punctuation">&#123;</span>ç´¢å¼•åº“å<span class="punctuation">&#125;</span>/_update/æ–‡æ¡£id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		 <span class="attr">&quot;å­—æ®µå&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;æ–°çš„å€¼&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">copy</span><br><span class="line">POSTÂ /heima/_update/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;ZhaoYun@itcast.cn&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-RestClient-æ“ä½œç´¢å¼•åº“"><a href="#6-RestClient-æ“ä½œç´¢å¼•åº“" class="headerlink" title="6. RestClient æ“ä½œç´¢å¼•åº“"></a>6. RestClient æ“ä½œç´¢å¼•åº“</h2><p>ESå®˜æ–¹æä¾›äº†å„ç§ä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œç”¨æ¥æ“ä½œESã€‚è¿™äº›å®¢æˆ·ç«¯çš„æœ¬è´¨å°±æ˜¯ç»„è£…DSLè¯­å¥ï¼Œé€šè¿‡httpè¯·æ±‚å‘é€ç»™ESã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/index.html">https://www.elastic.co/guide/en/elasticsearch/client/index.html</a></p>
<p>å…¶ä¸­çš„Java Rest ClientåˆåŒ…æ‹¬ä¸¤ç§ï¼š</p>
<ul>
<li>Java Low Level Rest Client</li>
<li>Java High Level Rest Client<br>![[Pasted image 20241223190523.png]]<br>![[Pasted image 20241223190602.png]]<br>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Java HighLevel Rest Clientå®¢æˆ·ç«¯API</li>
</ul>
<h3 id="APIæ“ä½œç´¢å¼•åº“"><a href="#APIæ“ä½œç´¢å¼•åº“" class="headerlink" title="APIæ“ä½œç´¢å¼•åº“"></a>APIæ“ä½œç´¢å¼•åº“</h3><blockquote>
<p>JavaRestClientæ“ä½œelasticsearchçš„æµç¨‹åŸºæœ¬ç±»ä¼¼ã€‚æ ¸å¿ƒæ˜¯client.indices()æ–¹æ³•æ¥è·å–ç´¢å¼•åº“çš„æ“ä½œå¯¹è±¡ã€‚</p>
<p>ç´¢å¼•åº“æ“ä½œçš„åŸºæœ¬æ­¥éª¤ï¼šã€å¯ä»¥æ ¹æ®å‘é€è¯·æ±‚é‚£æ­¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå‘è¿‡æ¥åˆ¤æ–­éœ€è¦åˆ›å»ºä»€ä¹ˆXXXXRequestã€‘</p>
<ul>
<li>åˆå§‹åŒ–<code>RestHighLevelClient</code></li>
<li>åˆ›å»º<code>XxxIndexRequest</code>ã€‚XXXæ˜¯Createã€Getã€Delete</li>
<li>å‡†å¤‡DSLï¼ˆ Createæ—¶éœ€è¦ï¼Œå…¶å®ƒæ˜¯æ— å‚ï¼‰</li>
<li>å‘é€è¯·æ±‚ã€‚è°ƒç”¨<code>RestHighLevelClient#indices().xxx()</code>æ–¹æ³•ï¼Œxxxæ˜¯<code>createã€existsã€delete</code></li>
</ul>
</blockquote>
<h4 id="1-mappingæ˜ å°„åˆ†æ"><a href="#1-mappingæ˜ å°„åˆ†æ" class="headerlink" title="1. mappingæ˜ å°„åˆ†æ"></a>1. mappingæ˜ å°„åˆ†æ</h4><blockquote>
<p><strong>æ ¹æ®MySQLæ•°æ®åº“è¡¨ç»“æ„ï¼ˆå»ºè¡¨è¯­å¥ï¼‰ï¼Œå»å†™ç´¢å¼•åº“ç»“æ„JSONã€‚è¡¨å’Œç´¢å¼•åº“ä¸€ä¸€å¯¹åº”</strong></p>
<p><strong>æ³¨æ„</strong>ï¼šåœ°ç†åæ ‡ã€ç»„åˆå­—æ®µã€‚ç´¢å¼•åº“é‡Œçš„åœ°ç†åæ ‡æ˜¯ä¸€ä¸ªå­—æ®µï¼š<code>åæ ‡ï¼šç»´åº¦,ç²¾åº¦</code>Â ã€‚copy_toç»„åˆå­—æ®µä½œç”¨æ˜¯ä¾›ç”¨æˆ·æŸ¥è¯¢ï¼ˆè¾“å…¥å…³é”®å­—å¯ä»¥æŸ¥è¯¢å¤šä¸ªå­—æ®µï¼‰</p>
</blockquote>
<p>åˆ›å»ºç´¢å¼•åº“ï¼Œæœ€å…³é”®çš„æ˜¯mappingæ˜ å°„ï¼Œè€Œmappingæ˜ å°„è¦è€ƒè™‘çš„ä¿¡æ¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>å­—æ®µå</li>
<li>å­—æ®µæ•°æ®ç±»å‹</li>
<li>æ˜¯å¦å‚ä¸æœç´¢</li>
<li>æ˜¯å¦éœ€è¦åˆ†è¯</li>
<li>å¦‚æœåˆ†è¯ï¼Œåˆ†è¯å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>å­—æ®µåã€å­—æ®µæ•°æ®ç±»å‹ï¼Œå¯ä»¥å‚è€ƒæ•°æ®è¡¨ç»“æ„çš„åç§°å’Œç±»å‹</li>
<li>æ˜¯å¦å‚ä¸æœç´¢è¦åˆ†æä¸šåŠ¡æ¥åˆ¤æ–­ï¼Œä¾‹å¦‚å›¾ç‰‡åœ°å€ï¼Œå°±æ— éœ€å‚ä¸æœç´¢</li>
<li>æ˜¯å¦åˆ†è¯å‘¢è¦çœ‹å†…å®¹ï¼Œå†…å®¹å¦‚æœæ˜¯ä¸€ä¸ªæ•´ä½“å°±æ— éœ€åˆ†è¯ï¼Œåä¹‹åˆ™è¦åˆ†è¯</li>
<li>åˆ†è¯å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€ä½¿ç”¨ik_max_word</li>
</ul>
<p>æ¥çœ‹ä¸‹é…’åº—æ•°æ®çš„ç´¢å¼•åº“ç»“æ„:</p>
<figure class="highlight json"><figcaption><span>title:ç´¢å¼•åº“ç»“æ„</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">PUT /hotel</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;starName&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;business&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;geo_point&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pic&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;all&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‡ ä¸ªç‰¹æ®Šå­—æ®µè¯´æ˜ï¼š</p>
<ul>
<li>locationï¼šåœ°ç†åæ ‡ï¼Œé‡Œé¢åŒ…å«ç²¾åº¦ã€çº¬åº¦</li>
<li>allï¼šä¸€ä¸ªç»„åˆå­—æ®µï¼Œå…¶ç›®çš„æ˜¯å°†å¤šå­—æ®µçš„å€¼ åˆ©ç”¨<code>copy_to</code>åˆå¹¶ï¼Œæä¾›ç»™ç”¨æˆ·æœç´¢<br>åœ°ç†åæ ‡è¯´æ˜ï¼š<br>![[Pasted image 20241223194718.png]]<br>copy_toè¯´æ˜ï¼š<br>![[Pasted image 20241223194725.png]]</li>
</ul>
<p>åœ¨ Elasticsearch ä¸­ï¼Œ<code>copy_to</code> æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å­—æ®µå±æ€§ï¼Œç”¨äºå°†å­—æ®µçš„å†…å®¹å¤åˆ¶åˆ°å…¶ä»–å­—æ®µï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå…¨æ–‡æœç´¢çš„å­—æ®µã€‚å®ƒçš„ä¸»è¦ä½œç”¨åŒ…æ‹¬ï¼š</p>
<blockquote>
<p><code>copy_to</code> çš„ä½œç”¨ä»…ä»…æ˜¯<strong>åœ¨ç´¢å¼•è¿‡ç¨‹ä¸­å¤åˆ¶å†…å®¹åˆ°ç›®æ ‡å­—æ®µç”¨äºå€’æ’ç´¢å¼•</strong>ï¼Œè€Œä¸ä¼šåœ¨å­˜å‚¨è¿‡ç¨‹ä¸­åˆ›å»ºçœŸå®çš„å­—æ®µå€¼ã€‚</p>
</blockquote>
<ul>
<li><strong>èšåˆå¤šä¸ªå­—æ®µè¿›è¡Œå…¨æ–‡æœç´¢</strong><ul>
<li>å¦‚æœä½ æƒ³å¯¹å¤šä¸ªå­—æ®µï¼ˆå¦‚ <code>name</code>ã€<code>brand</code>ã€<code>city</code>ï¼‰è¿›è¡Œç»Ÿä¸€çš„å…¨æ–‡æœç´¢ï¼Œè€Œä¸æƒ³åˆ†åˆ«å¯¹æ¯ä¸ªå­—æ®µæŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨ <code>copy_to</code> å°†è¿™äº›å­—æ®µçš„å†…å®¹å¤åˆ¶åˆ°ä¸€ä¸ªå•ç‹¬çš„å­—æ®µï¼ˆå¦‚ <code>all</code>ï¼‰ã€‚</li>
<li>æŸ¥è¯¢æ—¶<strong>åªéœ€è¦å¯¹ <code>all</code> å­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œç®€åŒ–äº†æŸ¥è¯¢é€»è¾‘</strong>ã€‚</li>
</ul>
</li>
<li><strong>æé«˜æŸ¥è¯¢æ•ˆç‡</strong><ul>
<li>å¦‚æœå¯¹å¤šä¸ªå­—æ®µè¿›è¡Œ <code>OR</code> æŸ¥è¯¢ï¼Œæ€§èƒ½å¯èƒ½è¾ƒä½ã€‚</li>
<li>å°†å¤šä¸ªå­—æ®µåˆå¹¶åˆ° <code>all</code> ä¸­åï¼Œåªéœ€å¯¹å•ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œå¯ä»¥æ˜¾è‘—æå‡æŸ¥è¯¢æ•ˆç‡ã€‚</li>
</ul>
</li>
<li><strong>çµæ´»æ€§</strong><ul>
<li>ä½¿ç”¨ <code>copy_to</code>ï¼Œä½ ä»ç„¶å¯ä»¥å•ç‹¬æŸ¥è¯¢åŸå§‹å­—æ®µï¼ŒåŒæ—¶è¿˜èƒ½ä½¿ç”¨èšåˆå­—æ®µï¼ˆå¦‚ <code>all</code>ï¼‰è¿›è¡Œæ›´å¤æ‚çš„æŸ¥è¯¢ã€‚<br> <strong>æ³¨æ„äº‹é¡¹</strong></li>
</ul>
</li>
</ul>
<ol>
<li><strong><code>copy_to</code> ä¸ä¼šå½±å“åŸå­—æ®µçš„å­˜å‚¨å’Œç´¢å¼•</strong>ï¼š<ul>
<li>åŸå­—æ®µä»ç„¶å¯ä»¥æ­£å¸¸ç´¢å¼•å’ŒæŸ¥è¯¢ï¼Œ<code>copy_to</code> åªæ˜¯é¢å¤–ç”Ÿæˆä¸€ä¸ªå­—æ®µç”¨äºç‰¹å®šç”¨é€”ã€‚</li>
</ul>
</li>
<li><strong>å¢åŠ äº†ç´¢å¼•å­˜å‚¨æˆæœ¬</strong>ï¼š<ul>
<li>è¢«å¤åˆ¶çš„å†…å®¹ä¼šå ç”¨æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼Œå› ä¸ºå®ƒåœ¨ç›®æ ‡å­—æ®µä¸­ä¼šè¢«é‡å¤å­˜å‚¨ã€‚</li>
</ul>
</li>
</ol>
<h4 id="2-åˆå§‹åŒ–RestClient"><a href="#2-åˆå§‹åŒ–RestClient" class="headerlink" title="2. åˆå§‹åŒ–RestClient"></a>2. åˆå§‹åŒ–RestClient</h4><p>åœ¨elasticsearchæä¾›çš„APIä¸­ï¼Œä¸elasticsearchä¸€åˆ‡äº¤äº’éƒ½å°è£…åœ¨ä¸€ä¸ªåä¸ºRestHighLevelClientçš„ç±»ä¸­ï¼Œå¿…é¡»å…ˆå®Œæˆè¿™ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œå»ºç«‹ä¸elasticsearchçš„è¿æ¥ã€‚<br>åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<p>1ï¼‰å¼•å…¥esçš„RestHighLevelClientä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>     </span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>     </span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2ï¼‰å› ä¸ºSpringBooté»˜è®¤çš„ESç‰ˆæœ¬æ˜¯7.6.2ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¦†ç›–é»˜è®¤çš„ESç‰ˆæœ¬ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span>     </span><br><span class="line">	<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.12.1<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>![[Pasted image 20241223200821.png]]<br>3ï¼‰åˆå§‹åŒ–RestHighLevelClientï¼šè¿™é‡Œä¸€èˆ¬åœ¨å¯åŠ¨ç±»æˆ–è€…é…ç½®ç±»é‡Œæ³¨å…¥è¯¥Beanï¼Œç”¨äºå‘Šè¯‰Java è®¿é—®ESçš„ipåœ°å€<br>åˆå§‹åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><figcaption><span>title:åˆå§‹åŒ–RestHighLevelClient</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span> </span><br><span class="line"><span class="keyword">public</span> RestHighLevelClient <span class="title function_">client</span><span class="params">()</span>&#123;     </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(HttpHost.create(<span class="string">&quot;http://192.168.150.101:9200&quot;</span>))); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸ºäº†å•å…ƒæµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»<code>HotelIndexTest</code>ï¼Œç„¶åå°†åˆå§‹åŒ–çš„ä»£ç ç¼–å†™åœ¨<code>@BeforeEach</code>æ–¹æ³•ä¸­ï¼š</p>
<figure class="highlight java"><figcaption><span>title:HotelIndexTest</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelIndexTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                HttpHost.create(<span class="string">&quot;http://192.168.150.101:9200&quot;</span>)</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>@BeforeEach</code>**ï¼šä¸ºæ¯ä¸ªæµ‹è¯•æ–¹æ³•è¿è¡Œå‰çš„åˆå§‹åŒ–æä¾›æ”¯æŒã€‚</li>
<li>**<code>@AfterEach</code>**ï¼šç¡®ä¿æ¯ä¸ªæµ‹è¯•æ–¹æ³•è¿è¡Œåæ­£ç¡®æ¸…ç†èµ„æºã€‚å®ƒä»¬ç”¨äºåœ¨æµ‹è¯•æ–¹æ³•ä¹‹é—´åˆå§‹åŒ–å’Œå…³é—­ Elasticsearch å®¢æˆ·ç«¯ï¼Œä¿è¯è¿æ¥èµ„æºçš„æ­£ç¡®ç®¡ç†ã€‚</li>
</ul>
<h4 id="3-Client-ç´¢å¼•åº“CRUD"><a href="#3-Client-ç´¢å¼•åº“CRUD" class="headerlink" title="3. Client ç´¢å¼•åº“CRUD"></a>3. Client ç´¢å¼•åº“CRUD</h4><p>ç´¢å¼•åº“æ“ä½œçš„åŸºæœ¬æ­¥éª¤</p>
<ol>
<li>åˆå§‹åŒ–<code>RestHighLevelclient</code></li>
<li>åˆ›å»º<code>XxxIndexRequest</code>ã€‚XXXæ˜¯<code>CREATEã€Getã€Delete</code></li>
<li>å‡†å¤‡<code>DSL</code>(CREATEæ—¶éœ€è¦)</li>
<li>å‘é€è¯·æ±‚ã€‚è°ƒç”¨<code>RestHighLevelClient#indices().xxx()</code>æ–¹æ³• xxxæ˜¯<code>createã€existsã€delete</code></li>
</ol>
<h5 id="3-1-åˆ›å»ºç´¢å¼•åº“"><a href="#3-1-åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="3.1 åˆ›å»ºç´¢å¼•åº“"></a>3.1 åˆ›å»ºç´¢å¼•åº“</h5><blockquote>
<p>ä»£ç åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<p>1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚å› ä¸ºæ˜¯åˆ›å»ºç´¢å¼•åº“çš„æ“ä½œï¼Œå› æ­¤Requestæ˜¯CreateIndexRequestã€‚<br>2ï¼‰æ·»åŠ è¯·æ±‚å‚æ•°ï¼Œå…¶å®å°±æ˜¯DSLçš„JSONå‚æ•°éƒ¨åˆ†ã€‚å› ä¸ºjsonå­—ç¬¦ä¸²å¾ˆé•¿ï¼Œè¿™é‡Œæ˜¯å®šä¹‰äº†é™æ€å­—ç¬¦ä¸²å¸¸é‡MAPPING_TEMPLATEï¼Œè®©ä»£ç çœ‹èµ·æ¥æ›´åŠ ä¼˜é›…ã€‚<br>3ï¼‰å‘é€è¯·æ±‚ï¼Œclient.indices()æ–¹æ³•çš„è¿”å›å€¼æ˜¯IndicesClientç±»å‹ï¼Œå°è£…äº†æ‰€æœ‰ä¸ç´¢å¼•åº“æ“ä½œæœ‰å…³çš„æ–¹æ³•ã€‚</p>
</blockquote>
<p>åˆ›å»ºç´¢å¼•åº“çš„APIå¦‚ä¸‹ï¼š<br>![[Pasted image 20241223200121.png]]<br><strong>ä»£ç ï¼š</strong></p>
<p>åœ¨hotel-demoçš„cn.itcast.hotel.constantsåŒ…ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªç±»ï¼Œå®šä¹‰mappingæ˜ å°„çš„JSONå­—ç¬¦ä¸²å¸¸é‡ï¼š</p>
<figure class="highlight java"><figcaption><span>title:å®šä¹‰å¸¸é‡JSON</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.constants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelConstants</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MAPPING_TEMPLATE</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;  \&quot;mappings\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    \&quot;properties\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;id\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;name\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;address\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;index\&quot;: false\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;price\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;score\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;brand\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;city\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;starName\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;business\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;location\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;geo_point\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;pic\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;index\&quot;: false\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;all\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;  &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨hotel-demoä¸­çš„HotelIndexTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå®ç°åˆ›å»ºç´¢å¼•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">createHotelIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequestå¯¹è±¡</span></span><br><span class="line">    <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡è¯·æ±‚çš„å‚æ•°ï¼šDSLè¯­å¥</span></span><br><span class="line">    request.source(MAPPING_TEMPLATE, XContentType.JSON);</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-åˆ é™¤ç´¢å¼•åº“"><a href="#3-2-åˆ é™¤ç´¢å¼•åº“" class="headerlink" title="3.2 åˆ é™¤ç´¢å¼•åº“"></a>3.2 åˆ é™¤ç´¢å¼•åº“</h5><p>ä¸‰æ­¥èµ°ï¼š</p>
<ul>
<li>1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯DeleteIndexRequestå¯¹è±¡</li>
<li>2ï¼‰å‡†å¤‡å‚æ•°ã€‚è¿™é‡Œæ˜¯æ— å‚</li>
<li>3ï¼‰å‘é€è¯·æ±‚ã€‚æ”¹ç”¨deleteæ–¹æ³•<br>åˆ é™¤ç´¢å¼•åº“çš„DSLè¯­å¥éå¸¸ç®€å•ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /hotel</span><br></pre></td></tr></table></figure>
åœ¨hotel-demoä¸­çš„HotelIndexTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå®ç°åˆ é™¤ç´¢å¼•ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteHotelIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequestå¯¹è±¡</span></span><br><span class="line">    <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3-3-æŸ¥è¯¢ç´¢å¼•åº“"><a href="#3-3-æŸ¥è¯¢ç´¢å¼•åº“" class="headerlink" title="3.3 æŸ¥è¯¢ç´¢å¼•åº“"></a>3.3 æŸ¥è¯¢ç´¢å¼•åº“</h5><p>ä¸‰æ­¥èµ°ï¼š</p>
<ul>
<li>1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯GetIndexRequestå¯¹è±¡</li>
<li>2ï¼‰å‡†å¤‡å‚æ•°ã€‚è¿™é‡Œæ˜¯æ— å‚</li>
<li>3ï¼‰å‘é€è¯·æ±‚ã€‚æ”¹ç”¨existsæ–¹æ³•<br>åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨ï¼Œæœ¬è´¨å°±æ˜¯æŸ¥è¯¢ï¼Œå¯¹åº”çš„DSLæ˜¯ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨ï¼Œæœ¬è´¨å°±æ˜¯æŸ¥è¯¢ï¼Œå¯¹åº”çš„DSLæ˜¯ï¼š</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testExistsHotelIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequestå¯¹è±¡</span></span><br><span class="line">    <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 3.è¾“å‡º</span></span><br><span class="line">    System.err.println(exists ? <span class="string">&quot;ç´¢å¼•åº“å·²ç»å­˜åœ¨ï¼&quot;</span> : <span class="string">&quot;ç´¢å¼•åº“ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="APIæ“ä½œæ–‡æ¡£"><a href="#APIæ“ä½œæ–‡æ¡£" class="headerlink" title="APIæ“ä½œæ–‡æ¡£"></a>APIæ“ä½œæ–‡æ¡£</h3><p><strong>æ–‡æ¡£æ“ä½œçš„åŸºæœ¬æ­¥éª¤:</strong></p>
<ol>
<li>åˆå§‹åŒ–<code>RestHighLevelclient</code></li>
<li>åˆ›å»º<code>XxxRequest</code>ã€‚XXXæ˜¯<code>Indexã€Getã€Updateã€Delete</code></li>
<li>å‡†å¤‡å‚æ•°(Indexå’ŒUpdateæ—¶éœ€è¦)</li>
<li>å‘é€è¯·æ±‚ã€‚è°ƒç”¨<code>RestHighLevelClient#.xxx()</code>æ–¹æ³•ï¼Œxxxæ˜¯indexã€getã€updateã€delete</li>
<li>è§£æç»“æœ(Getæ—¶éœ€è¦)</li>
</ol>
<h4 id="æ–°å¢æ–‡æ¡£"><a href="#æ–°å¢æ–‡æ¡£" class="headerlink" title="æ–°å¢æ–‡æ¡£"></a>æ–°å¢æ–‡æ¡£</h4><p>![[Pasted image 20241223203317.png]]<br>è¿™é‡Œæ“ä½œæ–‡æ¡£ï¼Œç›´æ¥<code>index()</code>å³å¯ï¼Œå‰é¢ç´¢å¼•åº“éœ€è¦<code>indices()</code></p>
<h4 id="æŸ¥è¯¢æ–‡æ¡£"><a href="#æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="æŸ¥è¯¢æ–‡æ¡£"></a>æŸ¥è¯¢æ–‡æ¡£</h4><p>![[Pasted image 20241223204633.png]]</p>
<h4 id="ä¿®æ”¹æ–‡æ¡£"><a href="#ä¿®æ”¹æ–‡æ¡£" class="headerlink" title="ä¿®æ”¹æ–‡æ¡£"></a>ä¿®æ”¹æ–‡æ¡£</h4><p>![[Pasted image 20241223205459.png]]</p>
<h4 id="åˆ é™¤æ–‡æ¡£"><a href="#åˆ é™¤æ–‡æ¡£" class="headerlink" title="åˆ é™¤æ–‡æ¡£"></a>åˆ é™¤æ–‡æ¡£</h4><p>![[Pasted image 20241223210308.png]]</p>
<h4 id="æ‰¹é‡å¯¼å…¥æ–‡æ¡£"><a href="#æ‰¹é‡å¯¼å…¥æ–‡æ¡£" class="headerlink" title="æ‰¹é‡å¯¼å…¥æ–‡æ¡£"></a>æ‰¹é‡å¯¼å…¥æ–‡æ¡£</h4><blockquote>
<p>ä¸‰æ­¥èµ°ï¼š</p>
<ul>
<li>1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚è¿™é‡Œæ˜¯BulkRequest</li>
<li>2ï¼‰å‡†å¤‡å‚æ•°ã€‚æ‰¹å¤„ç†çš„å‚æ•°ï¼Œå°±æ˜¯å…¶å®ƒRequestå¯¹è±¡ï¼Œè¿™é‡Œå°±æ˜¯å¤šä¸ªIndexRequest</li>
<li>3ï¼‰å‘èµ·è¯·æ±‚ã€‚è¿™é‡Œæ˜¯æ‰¹å¤„ç†ï¼Œè°ƒç”¨çš„æ–¹æ³•ä¸ºclient.bulk()æ–¹æ³•</li>
</ul>
</blockquote>
<p>æ¡ˆä¾‹éœ€æ±‚ï¼šåˆ©ç”¨BulkRequestæ‰¹é‡å°†æ•°æ®åº“æ•°æ®å¯¼å…¥åˆ°ç´¢å¼•åº“ä¸­ã€‚<br>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>åˆ©ç”¨mybatis-plusæŸ¥è¯¢é…’åº—æ•°æ®</li>
<li>å°†æŸ¥è¯¢åˆ°çš„é…’åº—æ•°æ®ï¼ˆHotelï¼‰è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹æ•°æ®ï¼ˆHotelDocï¼‰</li>
<li>åˆ©ç”¨<code>JavaRestClient</code>ä¸­çš„<code>BulkRequest</code>æ‰¹å¤„ç†ï¼Œå®ç°æ‰¹é‡æ–°å¢æ–‡æ¡£</li>
</ul>
<p><strong>è¯­æ³•è¯´æ˜ï¼š</strong><br>æ‰¹é‡å¤„ç†BulkRequestï¼Œå…¶æœ¬è´¨å°±æ˜¯å°†å¤šä¸ªæ™®é€šçš„CRUDè¯·æ±‚ç»„åˆåœ¨ä¸€èµ·å‘é€ã€‚<br>å…¶ä¸­æä¾›äº†ä¸€ä¸ªaddæ–¹æ³•ï¼Œç”¨æ¥æ·»åŠ å…¶ä»–è¯·æ±‚ï¼š<br>![[Pasted image 20241223203057.png]]<br>å¯ä»¥çœ‹åˆ°ï¼Œèƒ½æ·»åŠ çš„è¯·æ±‚åŒ…æ‹¬ï¼š</p>
<ul>
<li>IndexRequestï¼Œä¹Ÿå°±æ˜¯æ–°å¢</li>
<li>UpdateRequestï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹</li>
<li>DeleteRequestï¼Œä¹Ÿå°±æ˜¯åˆ é™¤</li>
</ul>
<p>å› æ­¤Bulkä¸­æ·»åŠ äº†å¤šä¸ªIndexRequestï¼Œå°±æ˜¯æ‰¹é‡æ–°å¢åŠŸèƒ½äº†ã€‚ç¤ºä¾‹ï¼š<br>![[Pasted image 20241223212143.png]]<br>æˆ‘ä»¬åœ¨å¯¼å…¥é…’åº—æ•°æ®æ—¶ï¼Œå°†ä¸Šè¿°ä»£ç æ”¹é€ æˆforå¾ªç¯å¤„ç†å³å¯ã€‚<br>åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š</p>
<figure class="highlight java"><figcaption><span>title:HotelDocumentTest</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// æ‰¹é‡æŸ¥è¯¢é…’åº—æ•°æ®</span></span><br><span class="line">    List&lt;Hotel&gt; hotels = hotelService.list();</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequest</span></span><br><span class="line">    <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡å‚æ•°ï¼Œæ·»åŠ å¤šä¸ªæ–°å¢çš„Request</span></span><br><span class="line">    <span class="keyword">for</span> (Hotel hotel : hotels) &#123;</span><br><span class="line">        <span class="comment">// 2.1.è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹HotelDoc</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line">        <span class="comment">// 2.2.åˆ›å»ºæ–°å¢æ–‡æ¡£çš„Requestå¯¹è±¡</span></span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>)</span><br><span class="line">                    .id(hotelDoc.getId().toString())</span><br><span class="line">                    .source(JSON.toJSONString(hotelDoc), XContentType.JSON));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-ES-æœç´¢å¼•æ“"><a href="#7-ES-æœç´¢å¼•æ“" class="headerlink" title="7. ES æœç´¢å¼•æ“"></a>7. ES æœç´¢å¼•æ“</h2><p>elasticsearchçš„æŸ¥è¯¢ä¾ç„¶æ˜¯åŸºäºJSONé£æ ¼çš„DSLæ¥å®ç°çš„ã€‚</p>
<h3 id="7-1-DSLè®¾ç½®æŸ¥è¯¢æ¡ä»¶"><a href="#7-1-DSLè®¾ç½®æŸ¥è¯¢æ¡ä»¶" class="headerlink" title="7.1. DSLè®¾ç½®æŸ¥è¯¢æ¡ä»¶"></a>7.1. DSLè®¾ç½®æŸ¥è¯¢æ¡ä»¶</h3><h4 id="7-1-1-DSLæŸ¥è¯¢åˆ†ç±»"><a href="#7-1-1-DSLæŸ¥è¯¢åˆ†ç±»" class="headerlink" title="7.1.1 DSLæŸ¥è¯¢åˆ†ç±»"></a>7.1.1 DSLæŸ¥è¯¢åˆ†ç±»</h4><p>Elasticsearchæä¾›äº†åŸºäºJSONçš„DSLï¼ˆ<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Domain Specific Language</a>ï¼‰æ¥å®šä¹‰æŸ¥è¯¢ã€‚å¸¸è§çš„æŸ¥è¯¢ç±»å‹åŒ…æ‹¬ï¼š</p>
<ul>
<li><p><strong>æŸ¥è¯¢æ‰€æœ‰</strong>ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œ_ä¸€èˆ¬æµ‹è¯•ç”¨_ã€‚ä¾‹å¦‚ï¼šmatch_all</p>
</li>
<li><p><strong>å…¨æ–‡æ£€ç´¢ï¼ˆfull textï¼‰æŸ¥è¯¢</strong>ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•åº“ä¸­åŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>match_query</li>
<li>multi_match_query</li>
</ul>
</li>
<li><p><strong>ç²¾ç¡®æŸ¥è¯¢</strong>ï¼šæ ¹æ®ç²¾ç¡®è¯æ¡å€¼æŸ¥æ‰¾æ•°æ®ï¼Œä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>ids</li>
<li>range</li>
<li>term</li>
</ul>
</li>
<li><p><strong>åœ°ç†ï¼ˆgeoï¼‰æŸ¥è¯¢</strong>ï¼šæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>geo_distance</li>
<li>geo_bounding_box</li>
</ul>
</li>
<li><p><strong>å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢</strong>ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†ä¸Šè¿°å„ç§æŸ¥è¯¢æ¡ä»¶ç»„åˆèµ·æ¥ï¼Œåˆå¹¶æŸ¥è¯¢æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>bool</li>
<li>function_score</li>
</ul>
</li>
</ul>
<p>æŸ¥è¯¢çš„è¯­æ³•åŸºæœ¬ä¸€è‡´ï¼š</p>
<figure class="highlight json"><figcaption><span>title:æŸ¥è¯¢åŸºæœ¬è¯­æ³•</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;æŸ¥è¯¢ç±»å‹&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;æŸ¥è¯¢æ¡ä»¶&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;æ¡ä»¶å€¼&quot;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä»¥æŸ¥è¯¢æ‰€æœ‰ä¸ºä¾‹ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>æŸ¥è¯¢ç±»å‹ä¸ºmatch_all</li>
<li>æ²¡æœ‰æŸ¥è¯¢æ¡ä»¶<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢æ‰€æœ‰</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
![[Pasted image 20241223213814.png]]<blockquote>
<p>æŸ¥è¯¢äº†æ‰€æœ‰ï¼Œè¿”å›äº†æ‰€æœ‰çš„æ•°æ®ï¼Œå¯ä»¥çœ‹è§<code>total</code>é‡Œé¢çš„<code>value</code>çš„å€¼ï¼ŒåŒæ—¶æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨ä¸€ä¸ªå«<code>hits</code>çš„<code>json</code>æ•°ç»„ä¸­ï¼Œä»£è¡¨å‘½ä¸­çš„æ•°æ®</p>
</blockquote>
</li>
</ul>
<p>å…¶å®ƒæŸ¥è¯¢æ— éå°±æ˜¯<strong>æŸ¥è¯¢ç±»å‹</strong>ã€<strong>æŸ¥è¯¢æ¡ä»¶</strong>çš„å˜åŒ–ã€‚</p>
<h4 id="7-1-2-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢"><a href="#7-1-2-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢" class="headerlink" title="7.1.2 å…¨æ–‡æ£€ç´¢æŸ¥è¯¢"></a>7.1.2 å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</h4><blockquote>
<p>matchå’Œmulti_matchçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>matchï¼šæ ¹æ®ä¸€ä¸ªå­—æ®µæŸ¥è¯¢ã€æ¨èï¼šä½¿ç”¨copy_toæ„é€ allå­—æ®µã€‘<br>multi_matchï¼šæ ¹æ®å¤šä¸ªå­—æ®µæŸ¥è¯¢ï¼Œå‚ä¸æŸ¥è¯¢å­—æ®µè¶Šå¤šï¼ŒæŸ¥è¯¢æ€§èƒ½è¶Šå·®</p>
<p><strong>æ³¨ï¼šæœç´¢å­—æ®µè¶Šå¤šï¼Œå¯¹æŸ¥è¯¢æ€§èƒ½å½±å“è¶Šå¤§ï¼Œå› æ­¤å»ºè®®é‡‡ç”¨copy_toï¼Œç„¶åå•å­—æ®µæŸ¥è¯¢çš„æ–¹å¼ã€‚</strong></p>
</blockquote>
<h5 id="7-1-2-1-ä½¿ç”¨åœºæ™¯"><a href="#7-1-2-1-ä½¿ç”¨åœºæ™¯" class="headerlink" title="7.1.2.1 ä½¿ç”¨åœºæ™¯"></a>7.1.2.1 ä½¿ç”¨åœºæ™¯</h5><p>å…¨æ–‡æ£€ç´¢æŸ¥è¯¢çš„<strong>åŸºæœ¬æµç¨‹</strong>å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¯¹ç”¨æˆ·æœç´¢çš„å†…å®¹åš<strong>åˆ†è¯</strong>ï¼Œå¾—åˆ°è¯æ¡</li>
<li>æ ¹æ®è¯æ¡å»<strong>å€’æ’ç´¢å¼•</strong>åº“ä¸­åŒ¹é…ï¼Œå¾—åˆ°æ–‡æ¡£id</li>
<li>æ ¹æ®<strong>æ–‡æ¡£id</strong>æ‰¾åˆ°æ–‡æ¡£ï¼Œè¿”å›ç»™ç”¨æˆ·</li>
</ul>
<p>æ¯”è¾ƒå¸¸ç”¨çš„<strong>åœºæ™¯</strong>åŒ…æ‹¬ï¼š</p>
<ul>
<li>å•†åŸçš„è¾“å…¥æ¡†æœç´¢</li>
<li>ç™¾åº¦è¾“å…¥æ¡†æœç´¢</li>
</ul>
<p>ä¾‹å¦‚äº¬ä¸œï¼š<br>![[Pasted image 20241223214146.png]]<br>å› ä¸ºæ˜¯æ‹¿ç€è¯æ¡å»åŒ¹é…ï¼Œå› æ­¤å‚ä¸æœç´¢çš„å­—æ®µä¹Ÿ<strong>å¿…é¡»æ˜¯å¯åˆ†è¯çš„textç±»å‹</strong>çš„å­—æ®µã€‚<br>å¸¸è§çš„å…¨æ–‡æ£€ç´¢æŸ¥è¯¢åŒ…æ‹¬ï¼š</p>
<ul>
<li>match æŸ¥è¯¢ï¼šå•å­—æ®µæŸ¥è¯¢</li>
<li>multi_match æŸ¥è¯¢ï¼šå¤šå­—æ®µæŸ¥è¯¢ï¼Œä»»æ„ä¸€ä¸ªå­—æ®µç¬¦åˆæ¡ä»¶å°±ç®—ç¬¦åˆæŸ¥è¯¢æ¡ä»¶</li>
</ul>
<h5 id="7-1-2-2-matchæŸ¥è¯¢"><a href="#7-1-2-2-matchæŸ¥è¯¢" class="headerlink" title="7.1.2.2 matchæŸ¥è¯¢"></a>7.1.2.2 matchæŸ¥è¯¢</h5><p>matchæŸ¥è¯¢è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;TEXT&quot;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œä½¿ç”¨çš„allè™½ç„¶çœ‹ä¸è§ï¼Œä½†æ˜¯åœ¨ä¹‹å‰åˆ›å»ºçš„æ—¶å€™ï¼Œå¯¹ä¸€äº›å­—æ®µç”¨äº†copy_toï¼Œæ‰€ä»¥allåœ¨å€’æ’ç´¢<br>è¡¨ä¸­æ˜¯å­˜åœ¨çš„ã€‚</p>
</blockquote>
<p>![[Pasted image 20241223214257.png]]<br>æ¯æ¡æ•°æ®ä¼šæœ‰ä¸€ä¸ªscoreï¼Œä¹Ÿå°±æ˜¯åŒ¹é…çš„åˆ†æ•°ï¼Œåˆ†æ•°è¶Šé«˜ï¼Œè¶Šé å‰</p>
<h5 id="7-1-2-3-mulit-matchæŸ¥è¯¢"><a href="#7-1-2-3-mulit-matchæŸ¥è¯¢" class="headerlink" title="7.1.2.3 mulit_matchæŸ¥è¯¢"></a>7.1.2.3 mulit_matchæŸ¥è¯¢</h5><p>mulit_matchè¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;TEXT&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span><span class="string">&quot;FIELD1&quot;</span><span class="punctuation">,</span>Â <span class="string">&quot; FIELD12&quot;</span><span class="punctuation">]</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>multi_matchæŸ¥è¯¢ç¤ºä¾‹ï¼š<br>![[Pasted image 20241223214821.png]]</p>
<h4 id="7-1-3-ç²¾å‡†æŸ¥è¯¢"><a href="#7-1-3-ç²¾å‡†æŸ¥è¯¢" class="headerlink" title="7.1.3 ç²¾å‡†æŸ¥è¯¢"></a>7.1.3 ç²¾å‡†æŸ¥è¯¢</h4><blockquote>
<p>ç²¾å‡†æŸ¥è¯¢ç±»å‹ï¼š</p>
<p>termæŸ¥è¯¢ï¼šæ ¹æ®è¯æ¡ç²¾ç¡®åŒ¹é…ï¼Œä¸€èˆ¬æœç´¢keywordç±»å‹ã€æ•°å€¼ç±»å‹ã€å¸ƒå°”ç±»å‹ã€æ—¥æœŸç±»å‹å­—æ®µ<br>rangeæŸ¥è¯¢ï¼šæ ¹æ®æ•°å€¼èŒƒå›´æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯æ•°å€¼ã€æ—¥æœŸçš„èŒƒå›´</p>
</blockquote>
<p>ç²¾ç¡®æŸ¥è¯¢ä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚æ‰€ä»¥<strong>ä¸ä¼š</strong>å¯¹æœç´¢æ¡ä»¶åˆ†è¯ã€‚å¸¸è§çš„æœ‰ï¼š</p>
<ul>
<li><strong>termï¼šæ ¹æ®è¯æ¡ç²¾ç¡®å€¼æŸ¥è¯¢</strong></li>
<li><strong>rangeï¼šæ ¹æ®å€¼çš„èŒƒå›´æŸ¥è¯¢</strong></li>
</ul>
<h5 id="1-3-1-termæŸ¥è¯¢"><a href="#1-3-1-termæŸ¥è¯¢" class="headerlink" title="1.3.1 termæŸ¥è¯¢"></a>1.3.1 termæŸ¥è¯¢</h5><p>å› ä¸ºç²¾ç¡®æŸ¥è¯¢çš„å­—æ®µæœæ—¶<strong>ä¸åˆ†è¯çš„å­—æ®µ</strong>ï¼Œå› æ­¤æŸ¥è¯¢çš„æ¡ä»¶ä¹Ÿ<strong>å¿…é¡»</strong>æ˜¯<strong>ä¸åˆ†è¯</strong>çš„è¯æ¡ã€‚æŸ¥è¯¢æ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„å†…å®¹è·Ÿè‡ªåŠ¨å€¼å®Œå…¨åŒ¹é…æ—¶æ‰è®¤ä¸ºç¬¦åˆæ¡ä»¶ã€‚å¦‚æœç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿‡å¤šï¼Œåè€Œæœç´¢ä¸åˆ°æ•°æ®ã€‚</p>
<p>è¯­æ³•è¯´æ˜ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â termæŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;VALUE&quot;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<p>å½“æˆ‘æœç´¢çš„æ˜¯ç²¾ç¡®è¯æ¡æ—¶ï¼Œèƒ½æ­£ç¡®æŸ¥è¯¢å‡ºç»“æœï¼š<br>![[Pasted image 20241223214924.png]]<br>ä½†æ˜¯ï¼Œå½“æˆ‘æœç´¢çš„å†…å®¹ä¸æ˜¯è¯æ¡ï¼Œè€Œæ˜¯å¤šä¸ªè¯è¯­å½¢æˆçš„çŸ­è¯­æ—¶ï¼Œåè€Œæœç´¢ä¸åˆ°ï¼š<br>![[Pasted image 20241223214931.png]]</p>
<h5 id="1-3-2-rangeæŸ¥è¯¢"><a href="#1-3-2-rangeæŸ¥è¯¢" class="headerlink" title="1.3.2 rangeæŸ¥è¯¢"></a>1.3.2 rangeæŸ¥è¯¢</h5><blockquote>
<p>èŒƒå›´æŸ¥è¯¢ï¼Œä¸€èˆ¬åº”ç”¨åœ¨å¯¹æ•°å€¼ç±»å‹åšèŒƒå›´è¿‡æ»¤çš„æ—¶å€™ã€‚æ¯”å¦‚åšä»·æ ¼èŒƒå›´è¿‡æ»¤ã€‚</p>
</blockquote>
<p>åŸºæœ¬è¯­æ³•ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â rangeæŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span>Â <span class="number">10</span><span class="punctuation">,</span> <span class="comment">// è¿™é‡Œçš„gteä»£è¡¨å¤§äºç­‰äºï¼Œgtåˆ™ä»£è¡¨å¤§äº</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span>Â <span class="number">20</span> <span class="comment">// lteä»£è¡¨å°äºç­‰äºï¼Œltåˆ™ä»£è¡¨å°äº</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š<br>![[Pasted image 20241223215339.png]]</p>
<h4 id="7-1-4-åœ°ç†åæ ‡æŸ¥è¯¢"><a href="#7-1-4-åœ°ç†åæ ‡æŸ¥è¯¢" class="headerlink" title="7.1.4 åœ°ç†åæ ‡æŸ¥è¯¢"></a>7.1.4 åœ°ç†åæ ‡æŸ¥è¯¢</h4><p>æ‰€è°“çš„åœ°ç†åæ ‡æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html</a></p>
<p>å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>æºç¨‹ï¼šæœç´¢æˆ‘é™„è¿‘çš„é…’åº—</li>
<li>æ»´æ»´ï¼šæœç´¢æˆ‘é™„è¿‘çš„å‡ºç§Ÿè½¦</li>
<li>å¾®ä¿¡ï¼šæœç´¢æˆ‘é™„è¿‘çš„äºº</li>
</ul>
<p>é™„è¿‘çš„é…’åº—ï¼š<br>![[Pasted image 20241223215623.png]]<br>é™„è¿‘çš„è½¦ï¼š<br>![[Pasted image 20241223215633.png]]</p>
<h5 id="1-4-1-çŸ©å½¢èŒƒå›´æŸ¥è¯¢"><a href="#1-4-1-çŸ©å½¢èŒƒå›´æŸ¥è¯¢" class="headerlink" title="1.4.1 çŸ©å½¢èŒƒå›´æŸ¥è¯¢"></a>1.4.1 çŸ©å½¢èŒƒå›´æŸ¥è¯¢</h5><blockquote>
<p>å¾ˆå°‘æœ‰ä¸šåŠ¡æœ‰è¿™ç§éœ€æ±‚</p>
</blockquote>
<p>çŸ©å½¢èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯geo_bounding_boxæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åæ ‡è½åœ¨æŸä¸ªçŸ©å½¢èŒƒå›´çš„æ‰€æœ‰æ–‡æ¡£ï¼š<br><img src="https://img2023.cnblogs.com/blog/2729274/202302/2729274-20230205172556695-448469947.gif" alt="image"></p>
<p>æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æŒ‡å®šçŸ©å½¢çš„<strong>å·¦ä¸Š</strong>ã€<strong>å³ä¸‹</strong>ä¸¤ä¸ªç‚¹çš„åæ ‡ï¼Œç„¶åç”»å‡ºä¸€ä¸ªçŸ©å½¢ï¼Œè½åœ¨è¯¥çŸ©å½¢å†…çš„éƒ½æ˜¯ç¬¦åˆæ¡ä»¶çš„ç‚¹ã€‚</p>
<p>è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â geo_bounding_boxæŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;geo_bounding_box&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;top_left&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span> <span class="comment">// å·¦ä¸Šç‚¹</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;lat&quot;</span><span class="punctuation">:</span>Â <span class="number">31.1</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;lon&quot;</span><span class="punctuation">:</span>Â <span class="number">121.5</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;bottom_right&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span> <span class="comment">// å³ä¸‹ç‚¹</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;lat&quot;</span><span class="punctuation">:</span>Â <span class="number">30.9</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;lon&quot;</span><span class="punctuation">:</span>Â <span class="number">121.7</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="1-4-2-é™„è¿‘-åœ†å½¢-æŸ¥è¯¢"><a href="#1-4-2-é™„è¿‘-åœ†å½¢-æŸ¥è¯¢" class="headerlink" title="1.4.2 é™„è¿‘(åœ†å½¢)æŸ¥è¯¢"></a>1.4.2 é™„è¿‘(åœ†å½¢)æŸ¥è¯¢</h5><p>é™„è¿‘æŸ¥è¯¢ï¼Œä¹Ÿå«åšè·ç¦»æŸ¥è¯¢ï¼ˆgeo_distanceï¼‰ï¼šæŸ¥è¯¢åˆ°æŒ‡å®šä¸­å¿ƒç‚¹å°äºæŸä¸ªè·ç¦»å€¼çš„æ‰€æœ‰æ–‡æ¡£ã€‚<br>æ¢å¥è¯æ¥è¯´ï¼Œåœ¨åœ°å›¾ä¸Šæ‰¾ä¸€ä¸ªç‚¹ä½œä¸ºåœ†å¿ƒï¼Œä»¥æŒ‡å®šè·ç¦»ä¸ºåŠå¾„ï¼Œç”»ä¸€ä¸ªåœ†ï¼Œè½åœ¨åœ†å†…çš„åæ ‡éƒ½ç®—ç¬¦åˆæ¡ä»¶ï¼š<br>![[Pasted image 20241223215847.png]]<br>è¯­æ³•è¯´æ˜ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â geo_distance æŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;geo_distance&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;distance&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;15km&quot;</span><span class="punctuation">,</span> <span class="comment">// åŠå¾„</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;31.21,121.5&quot;</span> <span class="comment">// åœ†å¿ƒ</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š<br>æˆ‘ä»¬å…ˆæœç´¢é™†å®¶å˜´é™„è¿‘15kmçš„é…’åº—ï¼š<br>![[Pasted image 20241223215926.png]]</p>
<h4 id="7-1-5-å¤åˆæŸ¥è¯¢"><a href="#7-1-5-å¤åˆæŸ¥è¯¢" class="headerlink" title="7.1.5.å¤åˆæŸ¥è¯¢"></a>7.1.5.å¤åˆæŸ¥è¯¢</h4><p>å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†å…¶å®ƒç®€å•æŸ¥è¯¢ç»„åˆèµ·æ¥ï¼Œå®ç°æ›´å¤æ‚çš„æœç´¢é€»è¾‘ã€‚å¸¸è§çš„æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li><strong>fuction score</strong>ï¼šç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼Œå¯ä»¥æ§åˆ¶æ–‡æ¡£ç›¸å…³æ€§ç®—åˆ†ï¼Œæ§åˆ¶æ–‡æ¡£æ’å</li>
<li><strong>bool query</strong>ï¼šå¸ƒå°”æŸ¥è¯¢ï¼Œåˆ©ç”¨é€»è¾‘å…³ç³»ç»„åˆå¤šä¸ªå…¶å®ƒçš„æŸ¥è¯¢ï¼Œå®ç°å¤æ‚æœç´¢</li>
</ul>
<h5 id="1-5-1-ç›¸å…³æ€§ç®—åˆ†"><a href="#1-5-1-ç›¸å…³æ€§ç®—åˆ†" class="headerlink" title="1.5.1.ç›¸å…³æ€§ç®—åˆ†"></a>1.5.1.ç›¸å…³æ€§ç®—åˆ†</h5><p>å½“æˆ‘ä»¬åˆ©ç”¨matchæŸ¥è¯¢æ—¶ï¼Œæ–‡æ¡£ç»“æœä¼šæ ¹æ®ä¸æœç´¢è¯æ¡çš„å…³è”åº¦æ‰“åˆ†ï¼ˆ_scoreï¼‰ï¼Œè¿”å›ç»“æœæ—¶æŒ‰ç…§åˆ†å€¼é™åºæ’åˆ—ã€‚<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœç´¢ â€œè™¹æ¡¥å¦‚å®¶â€ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line">Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_score&quot;</span>Â <span class="punctuation">:</span>Â <span class="number">17.850193</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_source&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;name&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;è™¹æ¡¥å¦‚å®¶é…’åº—çœŸä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_score&quot;</span>Â <span class="punctuation">:</span>Â <span class="number">12.259849</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_source&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;name&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;å¤–æ»©å¦‚å®¶é…’åº—çœŸä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_score&quot;</span>Â <span class="punctuation">:</span>Â <span class="number">11.91091</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_source&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;name&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;è¿ªå£«å°¼å¦‚å®¶é…’åº—çœŸä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>


<p>åœ¨elasticsearchä¸­ï¼Œæ—©æœŸä½¿ç”¨çš„æ‰“åˆ†ç®—æ³•æ˜¯TF-IDFç®—æ³•ï¼Œå…¬å¼å¦‚ä¸‹<br><img src="/img/image-20210721190152134.png" alt="image-20210721190152134"></p>
<p>åœ¨åæ¥çš„5.1ç‰ˆæœ¬å‡çº§ä¸­ï¼Œelasticsearchå°†ç®—æ³•æ”¹è¿›ä¸ºBM25ç®—æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š<br><img src="/img/image-20210721190416214.png" alt="image-20210721190416214"><br>TF-IDFç®—æ³•æœ‰ä¸€å„ç¼ºé™·ï¼Œå°±æ˜¯<strong>è¯æ¡é¢‘ç‡è¶Šé«˜ï¼Œæ–‡æ¡£å¾—åˆ†ä¹Ÿä¼šè¶Šé«˜</strong>ï¼Œå•ä¸ªè¯æ¡å¯¹æ–‡æ¡£å½±å“è¾ƒå¤§ã€‚è€ŒBM25åˆ™ä¼šè®©å•ä¸ªè¯æ¡çš„ç®—åˆ†æœ‰ä¸€ä¸ªä¸Šé™ï¼Œæ›²çº¿æ›´åŠ å¹³æ»‘ï¼š<br><img src="/img/image-20210721190907320.png" alt="image-20210721190907320"><br>å°ç»“ï¼šelasticsearchä¼šæ ¹æ®è¯æ¡å’Œæ–‡æ¡£çš„ç›¸å…³åº¦åšæ‰“åˆ†ï¼Œç®—æ³•ç”±ä¸¤ç§ï¼š</p>
<ul>
<li>TF-IDFç®—æ³•</li>
<li>BM25ç®—æ³•ï¼Œelasticsearch5.1ç‰ˆæœ¬åé‡‡ç”¨çš„ç®—æ³•</li>
</ul>
<h5 id="1-5-2-ç®—åˆ†å‡½æ•°æŸ¥è¯¢"><a href="#1-5-2-ç®—åˆ†å‡½æ•°æŸ¥è¯¢" class="headerlink" title="1.5.2.ç®—åˆ†å‡½æ•°æŸ¥è¯¢"></a>1.5.2.ç®—åˆ†å‡½æ•°æŸ¥è¯¢</h5><p>æ ¹æ®ç›¸å…³åº¦æ‰“åˆ†æ˜¯æ¯”è¾ƒåˆç†çš„éœ€æ±‚ï¼Œä½†<strong>åˆç†çš„ä¸ä¸€å®šæ˜¯äº§å“ç»ç†éœ€è¦</strong>çš„ã€‚<br>ä»¥ç™¾åº¦ä¸ºä¾‹ï¼Œä½ æœç´¢çš„ç»“æœä¸­ï¼Œå¹¶ä¸æ˜¯ç›¸å…³åº¦è¶Šé«˜æ’åè¶Šé å‰ï¼Œè€Œæ˜¯è°æçš„é’±å¤šæ’åå°±è¶Šé å‰ã€‚å¦‚å›¾ï¼š<br><img src="/img/image-20210721191144560.png" alt="image-20210721191144560"></p>
<p>è¦æƒ³è®¤ä¸ºæ§åˆ¶ç›¸å…³æ€§ç®—åˆ†ï¼Œå°±éœ€è¦åˆ©ç”¨elasticsearchä¸­çš„function score æŸ¥è¯¢äº†ã€‚<br>1ï¼‰è¯­æ³•è¯´æ˜<br><img src="/img/image-20210721191544750.png" alt="image-20210721191544750"></p>
<p>function score æŸ¥è¯¢ä¸­åŒ…å«å››éƒ¨åˆ†å†…å®¹ï¼š</p>
<ul>
<li><strong>åŸå§‹æŸ¥è¯¢</strong>æ¡ä»¶ï¼šqueryéƒ¨åˆ†ï¼ŒåŸºäºè¿™ä¸ªæ¡ä»¶æœç´¢æ–‡æ¡£ï¼Œå¹¶ä¸”åŸºäºBM25ç®—æ³•ç»™æ–‡æ¡£æ‰“åˆ†ï¼Œ<strong>åŸå§‹ç®—åˆ†</strong>ï¼ˆquery score)</li>
<li><strong>è¿‡æ»¤æ¡ä»¶</strong>ï¼šfilteréƒ¨åˆ†ï¼Œç¬¦åˆè¯¥æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šé‡æ–°ç®—åˆ†</li>
<li><strong>ç®—åˆ†å‡½æ•°</strong>ï¼šç¬¦åˆfilteræ¡ä»¶çš„æ–‡æ¡£è¦æ ¹æ®è¿™ä¸ªå‡½æ•°åšè¿ç®—ï¼Œå¾—åˆ°çš„<strong>å‡½æ•°ç®—åˆ†</strong>ï¼ˆfunction scoreï¼‰ï¼Œæœ‰å››ç§å‡½æ•°<br>Â  - <strong>weight</strong>ï¼šå‡½æ•°ç»“æœæ˜¯å¸¸é‡<br>Â  - <strong>field_value_factor</strong>ï¼šä»¥æ–‡æ¡£ä¸­çš„æŸä¸ªå­—æ®µå€¼ä½œä¸ºå‡½æ•°ç»“æœ<br>Â  - <strong>random_score</strong>ï¼šä»¥éšæœºæ•°ä½œä¸ºå‡½æ•°ç»“æœ<br>Â  - <strong>script_score</strong>ï¼šè‡ªå®šä¹‰ç®—åˆ†å‡½æ•°ç®—æ³•</li>
<li><strong>è¿ç®—æ¨¡å¼</strong>ï¼šç®—åˆ†å‡½æ•°çš„ç»“æœã€åŸå§‹æŸ¥è¯¢çš„ç›¸å…³æ€§ç®—åˆ†ï¼Œä¸¤è€…ä¹‹é—´çš„è¿ç®—æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š<br>Â  - multiplyï¼šç›¸ä¹˜<br>Â  - replaceï¼šç”¨function scoreæ›¿æ¢query score<br>Â  - å…¶å®ƒï¼Œä¾‹å¦‚ï¼šsumã€avgã€maxã€min</li>
</ul>
<p>function scoreçš„è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>1ï¼‰æ ¹æ®<strong>åŸå§‹æ¡ä»¶</strong>æŸ¥è¯¢æœç´¢æ–‡æ¡£ï¼Œå¹¶ä¸”è®¡ç®—ç›¸å…³æ€§ç®—åˆ†ï¼Œç§°ä¸º<strong>åŸå§‹ç®—åˆ†</strong>ï¼ˆquery scoreï¼‰</li>
<li>2ï¼‰æ ¹æ®<strong>è¿‡æ»¤æ¡ä»¶</strong>ï¼Œè¿‡æ»¤æ–‡æ¡£</li>
<li>3ï¼‰ç¬¦åˆ<strong>è¿‡æ»¤æ¡ä»¶</strong>çš„æ–‡æ¡£ï¼ŒåŸºäº<strong>ç®—åˆ†å‡½æ•°</strong>è¿ç®—ï¼Œå¾—åˆ°<strong>å‡½æ•°ç®—åˆ†</strong>ï¼ˆfunction scoreï¼‰</li>
<li>4ï¼‰å°†<strong>åŸå§‹ç®—åˆ†</strong>ï¼ˆquery scoreï¼‰å’Œ<strong>å‡½æ•°ç®—åˆ†</strong>ï¼ˆfunction scoreï¼‰åŸºäº<strong>è¿ç®—æ¨¡å¼</strong>åšè¿ç®—ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼Œä½œä¸ºç›¸å…³æ€§ç®—åˆ†ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œå…¶ä¸­çš„å…³é”®ç‚¹æ˜¯ï¼š</p>
<ul>
<li>è¿‡æ»¤æ¡ä»¶ï¼šå†³å®šå“ªäº›æ–‡æ¡£çš„ç®—åˆ†è¢«ä¿®æ”¹</li>
<li>ç®—åˆ†å‡½æ•°ï¼šå†³å®šå‡½æ•°ç®—åˆ†çš„ç®—æ³•</li>
<li>è¿ç®—æ¨¡å¼ï¼šå†³å®šæœ€ç»ˆç®—åˆ†ç»“æœ</li>
</ul>
<p>2ï¼‰ç¤ºä¾‹<br>éœ€æ±‚ï¼šç»™â€œå¦‚å®¶â€è¿™ä¸ªå“ç‰Œçš„é…’åº—æ’åé å‰ä¸€äº›<br>ç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªéœ€æ±‚ï¼Œè½¬æ¢ä¸ºä¹‹å‰è¯´çš„å››ä¸ªè¦ç‚¹ï¼š</p>
<ul>
<li>åŸå§‹æ¡ä»¶ï¼šä¸ç¡®å®šï¼Œå¯ä»¥ä»»æ„å˜åŒ–</li>
<li>è¿‡æ»¤æ¡ä»¶ï¼šbrand &#x3D; â€œå¦‚å®¶â€</li>
<li>ç®—åˆ†å‡½æ•°ï¼šå¯ä»¥ç®€å•ç²—æš´ï¼Œç›´æ¥ç»™å›ºå®šçš„ç®—åˆ†ç»“æœï¼Œweight</li>
<li>è¿ç®—æ¨¡å¼ï¼šæ¯”å¦‚æ±‚å’Œ<br>å› æ­¤æœ€ç»ˆçš„DSLè¯­å¥å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;function_score&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span> Â .... <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="comment">// åŸå§‹æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯ä»»æ„æ¡ä»¶</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;functions&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span>Â <span class="comment">//Â ç®—åˆ†å‡½æ•°</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â æ»¡è¶³çš„æ¡ä»¶ï¼Œå“ç‰Œå¿…é¡»æ˜¯å¦‚å®¶</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å¦‚å®¶&quot;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span>Â <span class="number">2</span>Â <span class="comment">//Â ç®—åˆ†æƒé‡ä¸º2</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">Â  Â  Â  <span class="attr">&quot;boost_mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum&quot;</span> <span class="comment">// åŠ æƒæ¨¡å¼ï¼Œæ±‚å’Œ</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼Œåœ¨æœªæ·»åŠ ç®—åˆ†å‡½æ•°æ—¶ï¼Œå¦‚å®¶å¾—åˆ†å¦‚ä¸‹ï¼š<br><img src="/img/image-20210721193152520.png" alt="image-20210721193152520"></p>
<p>æ·»åŠ äº†ç®—åˆ†å‡½æ•°åï¼Œå¦‚å®¶å¾—åˆ†å°±æå‡äº†ï¼š<br><img src="/img/image-20210721193458182.png" alt="image-20210721193458182"><br>3ï¼‰å°ç»“</p>
<blockquote>
<p><strong>function score queryå®šä¹‰çš„ä¸‰è¦ç´ æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li><strong>è¿‡æ»¤æ¡ä»¶</strong>ï¼šå“ªäº›æ–‡æ¡£è¦åŠ åˆ†</li>
<li><strong>ç®—åˆ†å‡½æ•°</strong>ï¼šå¦‚ä½•è®¡ç®—function score</li>
<li><strong>åŠ æƒæ–¹å¼</strong>ï¼šfunction score ä¸ query scoreå¦‚ä½•è¿ç®—</li>
</ul>
</blockquote>
<h5 id="1-5-3-å¸ƒå°”æŸ¥è¯¢"><a href="#1-5-3-å¸ƒå°”æŸ¥è¯¢" class="headerlink" title="1.5.3.å¸ƒå°”æŸ¥è¯¢"></a>1.5.3.å¸ƒå°”æŸ¥è¯¢</h5><p>å¸ƒå°”æŸ¥è¯¢æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢å­å¥çš„ç»„åˆï¼Œæ¯ä¸€ä¸ªå­å¥å°±æ˜¯ä¸€ä¸ª<strong>å­æŸ¥è¯¢</strong>ã€‚å­æŸ¥è¯¢çš„ç»„åˆæ–¹å¼æœ‰ï¼š</p>
<ul>
<li><strong>must</strong>ï¼šå¿…é¡»åŒ¹é…æ¯ä¸ªå­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œä¸â€</li>
<li><strong>should</strong>ï¼šé€‰æ‹©æ€§åŒ¹é…å­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œæˆ–â€</li>
<li><strong>must_not</strong>ï¼šå¿…é¡»ä¸åŒ¹é…ï¼Œ<strong>ä¸å‚ä¸ç®—åˆ†</strong>ï¼Œç±»ä¼¼â€œéâ€</li>
<li><strong>filter</strong>ï¼šå¿…é¡»åŒ¹é…ï¼Œ<strong>ä¸å‚ä¸ç®—åˆ†</strong><br>æ¯”å¦‚åœ¨æœç´¢é…’åº—æ—¶ï¼Œé™¤äº†å…³é”®å­—æœç´¢å¤–ï¼Œæˆ‘ä»¬è¿˜å¯èƒ½æ ¹æ®å“ç‰Œã€ä»·æ ¼ã€åŸå¸‚ç­‰å­—æ®µåšè¿‡æ»¤ï¼š</li>
</ul>
<p><img src="/img/image-20210721193822848.png" alt="image-20210721193822848"><br>æ¯ä¸€ä¸ªä¸åŒçš„å­—æ®µï¼Œå…¶æŸ¥è¯¢çš„æ¡ä»¶ã€æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œå¿…é¡»æ˜¯å¤šä¸ªä¸åŒçš„æŸ¥è¯¢ï¼Œè€Œè¦ç»„åˆè¿™äº›æŸ¥è¯¢ï¼Œå°±å¿…é¡»ç”¨boolæŸ¥è¯¢äº†ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœç´¢æ—¶ï¼Œå‚ä¸<strong>æ‰“åˆ†çš„å­—æ®µè¶Šå¤šï¼ŒæŸ¥è¯¢çš„æ€§èƒ½ä¹Ÿè¶Šå·®</strong>ã€‚å› æ­¤è¿™ç§å¤šæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œå»ºè®®è¿™æ ·åšï¼š</p>
<ul>
<li>æœç´¢æ¡†çš„å…³é”®å­—æœç´¢ï¼Œæ˜¯å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œä½¿ç”¨mustæŸ¥è¯¢ï¼Œå‚ä¸ç®—åˆ†</li>
<li>å…¶å®ƒè¿‡æ»¤æ¡ä»¶ï¼Œé‡‡ç”¨filteræŸ¥è¯¢ã€‚ä¸å‚ä¸ç®—åˆ†</li>
</ul>
<p>1ï¼‰è¯­æ³•ç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="attr">&quot;city&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;ä¸Šæµ·&quot;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;çš‡å† å‡æ—¥&quot;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â  Â  Â  Â  <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;åç¾è¾¾&quot;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span>Â <span class="number">500</span>Â <span class="punctuation">&#125;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="attr">&quot;score&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span>Â <span class="number">45</span>Â <span class="punctuation">&#125;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>2ï¼‰ç¤ºä¾‹<br>é¢˜ç›®éœ€æ±‚ï¼šæœç´¢åå­—åŒ…å«â€œå¦‚å®¶â€ï¼Œä»·æ ¼ä¸é«˜äº400ï¼Œåœ¨åæ ‡31.21,121.5å‘¨å›´10kmèŒƒå›´å†…çš„é…’åº—ã€‚<br>åˆ†æï¼š</p>
<ul>
<li>åç§°æœç´¢ï¼Œå±äºå…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œåº”è¯¥å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°mustä¸­</li>
<li>ä»·æ ¼ä¸é«˜äº400ï¼Œç”¨rangeæŸ¥è¯¢ï¼Œå±äºè¿‡æ»¤æ¡ä»¶ï¼Œ<strong>ä¸å‚ä¸ç®—åˆ†</strong>ã€‚æ”¾åˆ°must_notä¸­</li>
<li>å‘¨å›´10kmèŒƒå›´å†…ï¼Œç”¨geo_distanceæŸ¥è¯¢ï¼Œå±äºè¿‡æ»¤æ¡ä»¶ï¼Œä¸å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°filterä¸­<br><img src="/img/image-20210721194744183.png" alt="image-20210721194744183"><br>3ï¼‰å°ç»“<blockquote>
<p>boolæŸ¥è¯¢æœ‰å‡ ç§é€»è¾‘å…³ç³»ï¼Ÿ</p>
<ul>
<li><strong>must</strong>ï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œä¸â€</li>
<li><strong>should</strong>ï¼šé€‰æ‹©æ€§åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œæˆ–â€</li>
<li><strong>must_not</strong>ï¼šå¿…é¡»ä¸åŒ¹é…çš„æ¡ä»¶ï¼Œ<strong>ä¸å‚ä¸æ‰“åˆ†</strong></li>
<li><strong>filter</strong>ï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œ<strong>ä¸å‚ä¸æ‰“åˆ†</strong></li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="8-æœç´¢ç»“æœå¤„ç†"><a href="#8-æœç´¢ç»“æœå¤„ç†" class="headerlink" title="8.æœç´¢ç»“æœå¤„ç†"></a>8.æœç´¢ç»“æœå¤„ç†</h2><p>æœç´¢çš„ç»“æœå¯ä»¥æŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„æ–¹å¼å»å¤„ç†æˆ–å±•ç¤ºã€‚</p>
<h4 id="8-1-æ’åº"><a href="#8-1-æ’åº" class="headerlink" title="8.1.æ’åº"></a>8.1.æ’åº</h4><p>elasticsearché»˜è®¤æ˜¯æ ¹æ®ç›¸å…³åº¦ç®—åˆ†ï¼ˆ_scoreï¼‰æ¥æ’åºï¼Œä½†æ˜¯ä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ–¹å¼å¯¹æœç´¢<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/sort-search-results.html">ç»“æœæ’åº</a>ã€‚å¯ä»¥æ’åºå­—æ®µç±»å‹æœ‰ï¼škeywordç±»å‹ã€æ•°å€¼ç±»å‹ã€åœ°ç†åæ ‡ç±»å‹ã€æ—¥æœŸç±»å‹ç­‰ã€‚</p>
<h5 id="8-1-1-æ™®é€šå­—æ®µæ’åº"><a href="#8-1-1-æ™®é€šå­—æ®µæ’åº" class="headerlink" title="8.1.1.æ™®é€šå­—æ®µæ’åº"></a>8.1.1.æ™®é€šå­—æ®µæ’åº</h5><p>keywordã€æ•°å€¼ã€æ—¥æœŸç±»å‹æ’åºçš„è¯­æ³•åŸºæœ¬ä¸€è‡´ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;desc&quot;</span>Â Â <span class="comment">//Â æ’åºå­—æ®µã€æ’åºæ–¹å¼ASCã€DESC</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ’åºæ¡ä»¶æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å†™å¤šä¸ªæ’åºæ¡ä»¶ã€‚æŒ‰ç…§å£°æ˜çš„é¡ºåºï¼Œå½“ç¬¬ä¸€ä¸ªæ¡ä»¶ç›¸ç­‰æ—¶ï¼Œå†æŒ‰ç…§ç¬¬äºŒä¸ªæ¡ä»¶æ’åºï¼Œä»¥æ­¤ç±»æ¨</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<br>éœ€æ±‚æè¿°ï¼š</p>
<blockquote>
<p>é…’åº—æ•°æ®æŒ‰ç…§ç”¨æˆ·è¯„ä»·ï¼ˆscore)é™åºæ’åºï¼Œè¯„ä»·ç›¸åŒçš„æŒ‰ç…§ä»·æ ¼(price)å‡åºæ’åº</p>
</blockquote>
<p><img src="/img/image-20210721195728306.png" alt="image-20210721195728306"></p>
<h5 id="8-1-2-åœ°ç†åæ ‡æ’åº"><a href="#8-1-2-åœ°ç†åæ ‡æ’åº" class="headerlink" title="8.1.2.åœ°ç†åæ ‡æ’åº"></a>8.1.2.åœ°ç†åæ ‡æ’åº</h5><p>åœ°ç†åæ ‡æ’åºç•¥æœ‰ä¸åŒã€‚<br><strong>è¯­æ³•è¯´æ˜</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;_geo_distance&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;çº¬åº¦ï¼Œç»åº¦&quot;</span><span class="punctuation">,</span> <span class="comment">// æ–‡æ¡£ä¸­geo_pointç±»å‹çš„å­—æ®µåã€ç›®æ ‡åæ ‡ç‚¹</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;order&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span><span class="punctuation">,</span> <span class="comment">// æ’åºæ–¹å¼</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;unit&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;km&quot;</span> <span class="comment">// æ’åºçš„è·ç¦»å•ä½</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæŸ¥è¯¢çš„å«ä¹‰æ˜¯ï¼š</p>
<ul>
<li>æŒ‡å®šä¸€ä¸ªåæ ‡ï¼Œä½œä¸ºç›®æ ‡ç‚¹</li>
<li>è®¡ç®—æ¯ä¸€ä¸ªæ–‡æ¡£ä¸­ï¼ŒæŒ‡å®šå­—æ®µï¼ˆå¿…é¡»æ˜¯geo_pointç±»å‹ï¼‰çš„åæ ‡ åˆ°ç›®æ ‡ç‚¹çš„è·ç¦»æ˜¯å¤šå°‘</li>
<li>æ ¹æ®è·ç¦»æ’åº</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong><br>éœ€æ±‚æè¿°ï¼šå®ç°å¯¹é…’åº—æ•°æ®æŒ‰ç…§åˆ°ä½ çš„ä½ç½®åæ ‡çš„è·ç¦»å‡åºæ’åº<br>æç¤ºï¼š<br>    è·å–ä½ çš„ä½ç½®çš„ç»çº¬åº¦çš„æ–¹å¼ï¼š<br>    <a target="_blank" rel="noopener" href="https://lbs.amap.com/demo/jsapi-v2/example/map/click-to-get-lnglat/">https://lbs.amap.com/demo/jsapi-v2/example/map/click-to-get-lnglat/</a></p>
<p>å‡è®¾æˆ‘çš„ä½ç½®æ˜¯ï¼š31.034661ï¼Œ121.612282ï¼Œå¯»æ‰¾æˆ‘å‘¨å›´è·ç¦»æœ€è¿‘çš„é…’åº—ã€‚<br><img src="/img/image-20210721200214690.png" alt="image-20210721200214690"><br>æ’åºä¹‹åä¸æ‰“åˆ†ï¼Œå› ä¸ºæ‰“åˆ†æ— æ„ä¹‰</p>
<h4 id="8-2-åˆ†é¡µ"><a href="#8-2-åˆ†é¡µ" class="headerlink" title="8.2.åˆ†é¡µ"></a>8.2.åˆ†é¡µ</h4><p>elasticsearch <strong>é»˜è®¤æƒ…å†µ</strong>ä¸‹åªè¿”å›<strong>top10</strong>çš„æ•°æ®ã€‚è€Œå¦‚æœè¦æŸ¥è¯¢æ›´å¤šæ•°æ®å°±éœ€è¦ä¿®æ”¹åˆ†é¡µå‚æ•°äº†ã€‚elasticsearchä¸­é€šè¿‡ä¿®æ”¹fromã€sizeå‚æ•°æ¥æ§åˆ¶è¦è¿”å›çš„åˆ†é¡µç»“æœï¼š</p>
<ul>
<li><strong>from</strong>ï¼šä»ç¬¬å‡ ä¸ªæ–‡æ¡£å¼€å§‹</li>
<li><strong>size</strong>ï¼šæ€»å…±æŸ¥è¯¢å‡ ä¸ªæ–‡æ¡£<br>ç±»ä¼¼äºmysqlä¸­çš„<code>limit ?, ?</code></li>
</ul>
<h5 id="8-2-1-åŸºæœ¬çš„åˆ†é¡µ"><a href="#8-2-1-åŸºæœ¬çš„åˆ†é¡µ" class="headerlink" title="8.2.1.åŸºæœ¬çš„åˆ†é¡µ"></a>8.2.1.åŸºæœ¬çš„åˆ†é¡µ</h5><p>åˆ†é¡µçš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span>Â <span class="number">0</span><span class="punctuation">,</span>Â <span class="comment">//Â åˆ†é¡µå¼€å§‹çš„ä½ç½®ï¼Œé»˜è®¤ä¸º0</span></span><br><span class="line">Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">10</span><span class="punctuation">,</span>Â <span class="comment">//Â æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•°</span></span><br><span class="line">Â Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="8-2-2-æ·±åº¦åˆ†é¡µé—®é¢˜"><a href="#8-2-2-æ·±åº¦åˆ†é¡µé—®é¢˜" class="headerlink" title="8.2.2.æ·±åº¦åˆ†é¡µé—®é¢˜"></a>8.2.2.æ·±åº¦åˆ†é¡µé—®é¢˜</h5><p>ç°åœ¨ï¼Œæˆ‘è¦æŸ¥è¯¢990~1000çš„æ•°æ®ï¼ŒæŸ¥è¯¢é€»è¾‘è¦è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span>Â <span class="number">990</span><span class="punctuation">,</span>Â <span class="comment">//Â åˆ†é¡µå¼€å§‹çš„ä½ç½®ï¼Œé»˜è®¤ä¸º0</span></span><br><span class="line">Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">10</span><span class="punctuation">,</span>Â <span class="comment">//Â æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•°</span></span><br><span class="line">Â Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯æŸ¥è¯¢990å¼€å§‹çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ ç¬¬990<del>ç¬¬1000æ¡ æ•°æ®ã€‚<br>ä¸è¿‡ï¼Œelasticsearchå†…éƒ¨åˆ†é¡µæ—¶ï¼Œ**å¿…é¡»å…ˆæŸ¥è¯¢ 0</del>1000æ¡ï¼Œç„¶åæˆªå–å…¶ä¸­çš„990 ~ 1000çš„è¿™10æ¡**ï¼š<br><img src="/img/image-20210721200643029.png" alt="image-20210721200643029"></p>
<p>æŸ¥è¯¢TOP1000ï¼Œå¦‚æœesæ˜¯å•ç‚¹æ¨¡å¼ï¼Œè¿™å¹¶æ— å¤ªå¤§å½±å“ã€‚<br>ä½†æ˜¯elasticsearchå°†æ¥ä¸€å®šæ˜¯é›†ç¾¤ï¼Œä¾‹å¦‚æˆ‘é›†ç¾¤æœ‰5ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘è¦æŸ¥è¯¢TOP1000çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹æŸ¥è¯¢200æ¡å°±å¯ä»¥äº†ã€‚<br>å› ä¸ºèŠ‚ç‚¹Açš„TOP200ï¼Œåœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½æ’åˆ°10000åä»¥å¤–äº†ã€‚<br>å› æ­¤è¦æƒ³è·å–æ•´ä¸ªé›†ç¾¤çš„TOP1000ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„TOP1000ï¼Œæ±‡æ€»ç»“æœåï¼Œé‡æ–°æ’åï¼Œé‡æ–°æˆªå–TOP1000ã€‚<br><img src="/img/image-20210721201003229.png" alt="image-20210721201003229"></p>
<p>é‚£å¦‚æœæˆ‘è¦æŸ¥è¯¢9900~10000çš„æ•°æ®å‘¢ï¼Ÿæ˜¯ä¸æ˜¯è¦å…ˆæŸ¥è¯¢ TOP 10000 å‘¢ï¼Ÿé‚£æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦æŸ¥è¯¢10000æ¡ï¼Ÿæ±‡æ€»åˆ°å†…å­˜ä¸­ï¼Ÿ<br><strong>å½“æŸ¥è¯¢åˆ†é¡µæ·±åº¦è¾ƒå¤§æ—¶ï¼Œæ±‡æ€»æ•°æ®è¿‡å¤šï¼Œå¯¹å†…å­˜å’ŒCPUä¼šäº§ç”Ÿéå¸¸å¤§çš„å‹åŠ›ï¼Œå› æ­¤elasticsearchä¼šç¦æ­¢from+ size è¶…è¿‡10000çš„è¯·æ±‚ã€‚</strong><br>é’ˆå¯¹æ·±åº¦åˆ†é¡µï¼ŒESæä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œ<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/paginate-search-results.html">å®˜æ–¹æ–‡æ¡£</a>ï¼š</p>
<ul>
<li>search afterï¼šåˆ†é¡µæ—¶éœ€è¦æ’åºï¼ŒåŸç†æ˜¯ä»ä¸Šä¸€æ¬¡çš„æ’åºå€¼å¼€å§‹ï¼ŒæŸ¥è¯¢ä¸‹ä¸€é¡µæ•°æ®ã€‚å®˜æ–¹æ¨èä½¿ç”¨çš„æ–¹å¼ã€‚</li>
<li>scrollï¼šåŸç†å°†æ’åºåçš„æ–‡æ¡£idå½¢æˆå¿«ç…§ï¼Œä¿å­˜åœ¨å†…å­˜ã€‚å®˜æ–¹å·²ç»ä¸æ¨èä½¿ç”¨ã€‚</li>
</ul>
<h5 id="8-2-3-å°ç»“"><a href="#8-2-3-å°ç»“" class="headerlink" title="8.2.3.å°ç»“"></a>8.2.3.å°ç»“</h5><p>åˆ†é¡µæŸ¥è¯¢çš„å¸¸è§å®ç°æ–¹æ¡ˆä»¥åŠä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li><code>from + size</code>ï¼š<br>Â  - ä¼˜ç‚¹ï¼šæ”¯æŒ<strong>éšæœºç¿»é¡µ</strong><br>Â  - ç¼ºç‚¹ï¼š<strong>æ·±åº¦åˆ†é¡µé—®é¢˜</strong>ï¼Œ<strong>é»˜è®¤æŸ¥è¯¢ä¸Šé™ï¼ˆfrom + sizeï¼‰æ˜¯10000</strong><br>Â  - åœºæ™¯ï¼šç™¾åº¦ã€äº¬ä¸œã€è°·æ­Œã€æ·˜å®è¿™æ ·çš„éšæœºç¿»é¡µæœç´¢</li>
<li><code>after search</code>ï¼š<br>Â  - ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰<br>Â  - ç¼ºç‚¹ï¼šåªèƒ½<strong>å‘åé€é¡µæŸ¥è¯¢</strong>ï¼Œ<strong>ä¸æ”¯æŒéšæœºç¿»é¡µ</strong><br>Â  - åœºæ™¯ï¼šæ²¡æœ‰éšæœºç¿»é¡µéœ€æ±‚çš„æœç´¢ï¼Œä¾‹å¦‚æ‰‹æœºå‘ä¸‹æ»šåŠ¨ç¿»é¡µ</li>
<li><code>scroll</code>ï¼š<br>Â  - ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰<br>Â  - ç¼ºç‚¹ï¼šä¼šæœ‰<strong>é¢å¤–å†…å­˜æ¶ˆè€—</strong>ï¼Œå¹¶ä¸”æœç´¢ç»“æœæ˜¯éå®æ—¶çš„<br>Â  - åœºæ™¯ï¼šæµ·é‡æ•°æ®çš„è·å–å’Œè¿ç§»ã€‚ä»ES7.1å¼€å§‹ä¸æ¨èï¼Œå»ºè®®ç”¨ after searchæ–¹æ¡ˆã€‚</li>
</ul>
<h4 id="8-3-é«˜äº®"><a href="#8-3-é«˜äº®" class="headerlink" title="8.3.é«˜äº®"></a>8.3.é«˜äº®</h4><h5 id="8-3-1-é«˜äº®åŸç†"><a href="#8-3-1-é«˜äº®åŸç†" class="headerlink" title="8.3.1.é«˜äº®åŸç†"></a>8.3.1.é«˜äº®åŸç†</h5><p>ä»€ä¹ˆæ˜¯é«˜äº®æ˜¾ç¤ºå‘¢ï¼Ÿ<br>æˆ‘ä»¬åœ¨ç™¾åº¦ï¼Œäº¬ä¸œæœç´¢æ—¶ï¼Œå…³é”®å­—ä¼šå˜æˆçº¢è‰²ï¼Œæ¯”è¾ƒé†’ç›®ï¼Œè¿™å«é«˜äº®æ˜¾ç¤ºï¼š</p>
<p><img src="/img/image-20210721202705030.png" alt="image-20210721202705030"><br>é«˜äº®æ˜¾ç¤ºçš„å®ç°åˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<ul>
<li>1ï¼‰ç»™æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…³é”®å­—éƒ½æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œä¾‹å¦‚<code>&lt;em&gt;</code>æ ‡ç­¾</li>
<li>2ï¼‰é¡µé¢ç»™<code>&lt;em&gt;</code>æ ‡ç­¾ç¼–å†™CSSæ ·å¼</li>
</ul>
<h5 id="2-3-2-å®ç°é«˜äº®"><a href="#2-3-2-å®ç°é«˜äº®" class="headerlink" title="2.3.2.å®ç°é«˜äº®"></a>2.3.2.å®ç°é«˜äº®</h5><p><strong>é«˜äº®çš„è¯­æ³•</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;TEXT&quot;</span> <span class="comment">// æŸ¥è¯¢æ¡ä»¶ï¼Œé«˜äº®ä¸€å®šè¦ä½¿ç”¨å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â æŒ‡å®šè¦é«˜äº®çš„å­—æ®µ</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;pre_tags&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;&lt;em&gt;&quot;</span><span class="punctuation">,</span>Â Â <span class="comment">//Â ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„å‰ç½®æ ‡ç­¾</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;post_tags&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;&lt;/em&gt;&quot;</span>Â <span class="comment">//Â ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„åç½®æ ‡ç­¾</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>é«˜äº®æ˜¯å¯¹å…³é”®å­—é«˜äº®ï¼Œå› æ­¤<strong>æœç´¢æ¡ä»¶å¿…é¡»å¸¦æœ‰å…³é”®å­—</strong>ï¼Œè€Œä¸èƒ½æ˜¯èŒƒå›´è¿™æ ·çš„æŸ¥è¯¢ã€‚</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>é«˜äº®çš„å­—æ®µï¼Œå¿…é¡»ä¸æœç´¢æŒ‡å®šçš„å­—æ®µä¸€è‡´</strong>ï¼Œå¦åˆ™æ— æ³•é«˜äº®</li>
<li>å¦‚æœè¦<strong>å¯¹éæœç´¢å­—æ®µé«˜äº®ï¼Œåˆ™éœ€è¦æ·»åŠ ä¸€ä¸ªå±æ€§ï¼š<code>required_field_match=false</code></strong></li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š<br><img src="/img/image-20210721203349633.png" alt="image-20210721203349633"></p>
<h4 id="8-4-æ€»ç»“"><a href="#8-4-æ€»ç»“" class="headerlink" title="8.4.æ€»ç»“"></a>8.4.æ€»ç»“</h4><p>æŸ¥è¯¢çš„DSLæ˜¯ä¸€ä¸ªå¤§çš„JSONå¯¹è±¡ï¼ŒåŒ…å«ä¸‹åˆ—å±æ€§ï¼š</p>
<ul>
<li><p>queryï¼šæŸ¥è¯¢æ¡ä»¶</p>
</li>
<li><p>fromå’Œsizeï¼šåˆ†é¡µæ¡ä»¶</p>
</li>
<li><p>sortï¼šæ’åºæ¡ä»¶</p>
</li>
<li><p>highlightï¼šé«˜äº®æ¡ä»¶</p>
</li>
</ul>
<p>ç¤ºä¾‹ï¼š<br><img src="/img/image-20210721203657850.png" alt="image-20210721203657850"></p>
<h2 id="9-RestClientæŸ¥è¯¢æ–‡æ¡£"><a href="#9-RestClientæŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="9.RestClientæŸ¥è¯¢æ–‡æ¡£"></a>9.RestClientæŸ¥è¯¢æ–‡æ¡£</h2><p>æ–‡æ¡£çš„æŸ¥è¯¢åŒæ ·é€‚ç”¨æ˜¨å¤©å­¦ä¹ çš„ <code>RestHighLevelClient</code>å¯¹è±¡ï¼ŒåŸºæœ¬æ­¥éª¤åŒ…æ‹¬ï¼š</p>
<ul>
<li>1ï¼‰å‡†å¤‡Requestå¯¹è±¡</li>
<li>2ï¼‰å‡†å¤‡è¯·æ±‚å‚æ•°</li>
<li>3ï¼‰å‘èµ·è¯·æ±‚</li>
<li>4ï¼‰è§£æå“åº”</li>
</ul>
<h4 id="9-1-å¿«é€Ÿå…¥é—¨"><a href="#9-1-å¿«é€Ÿå…¥é—¨" class="headerlink" title="9.1.å¿«é€Ÿå…¥é—¨"></a>9.1.å¿«é€Ÿå…¥é—¨</h4><p>æˆ‘ä»¬ä»¥match_allæŸ¥è¯¢ä¸ºä¾‹</p>
<h5 id="9-1-1-å‘èµ·æŸ¥è¯¢è¯·æ±‚"><a href="#9-1-1-å‘èµ·æŸ¥è¯¢è¯·æ±‚" class="headerlink" title="9.1.1.å‘èµ·æŸ¥è¯¢è¯·æ±‚"></a>9.1.1.å‘èµ·æŸ¥è¯¢è¯·æ±‚</h5><p><img src="/img/image-20210721203950559.png" alt="image-20210721203950559"></p>
<p>ä»£ç è§£è¯»ï¼š</p>
<ol>
<li>åˆ›å»º<code>SearchRequest</code>å¯¹è±¡ï¼ŒæŒ‡å®šç´¢å¼•åº“å</li>
<li>åˆ©ç”¨<code>request.source()</code>æ„å»ºDSLï¼ŒDSLä¸­å¯ä»¥åŒ…å«æŸ¥è¯¢ã€åˆ†é¡µã€æ’åºã€é«˜äº®ç­‰<br>Â  - <code>query()</code>ï¼šä»£è¡¨æŸ¥è¯¢æ¡ä»¶ï¼Œåˆ©ç”¨<code>QueryBuilders.matchAllQuery()</code>æ„å»ºä¸€ä¸ªmatch_allæŸ¥è¯¢çš„DSL</li>
<li>åˆ©ç”¨client.search()å‘é€è¯·æ±‚ï¼Œå¾—åˆ°å“åº”<br>è¿™é‡Œå…³é”®çš„APIæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯<code>request.source()</code>ï¼Œå…¶ä¸­åŒ…å«äº†æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€é«˜äº®ç­‰æ‰€æœ‰åŠŸèƒ½ï¼š<br><img src="/img/image-20210721215640790.png" alt="image-20210721215640790"><br>å¦ä¸€ä¸ªæ˜¯<code>QueryBuilders</code>ï¼Œå…¶ä¸­åŒ…å«matchã€termã€function_scoreã€boolç­‰å„ç§æŸ¥è¯¢ï¼š<br><img src="/img/image-20210721215729236.png" alt="image-20210721215729236"></li>
</ol>
<h5 id="9-1-2-è§£æå“åº”"><a href="#9-1-2-è§£æå“åº”" class="headerlink" title="9.1.2.è§£æå“åº”"></a>9.1.2.è§£æå“åº”</h5><p>å“åº”ç»“æœçš„è§£æï¼š<br><img src="/img/image-20210721214221057.png" alt="image-20210721214221057"><br>elasticsearchè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œç»“æ„åŒ…å«ï¼š</p>
<ul>
<li><code>hits</code>ï¼šå‘½ä¸­çš„ç»“æœ<br>Â  - <code>total</code>ï¼šæ€»æ¡æ•°ï¼Œå…¶ä¸­çš„valueæ˜¯å…·ä½“çš„æ€»æ¡æ•°å€¼<br>Â  - <code>max_score</code>ï¼šæ‰€æœ‰ç»“æœä¸­å¾—åˆ†æœ€é«˜çš„æ–‡æ¡£çš„ç›¸å…³æ€§ç®—åˆ†<br>Â  - <code>hits</code>ï¼šæœç´¢ç»“æœçš„æ–‡æ¡£æ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯ä¸€ä¸ªjsonå¯¹è±¡<br>Â  Â  - <code>_source</code>ï¼šæ–‡æ¡£ä¸­çš„åŸå§‹æ•°æ®ï¼Œä¹Ÿæ˜¯jsonå¯¹è±¡</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘ä»¬è§£æå“åº”ç»“æœï¼Œå°±æ˜¯é€å±‚è§£æJSONå­—ç¬¦ä¸²ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>SearchHits</code>ï¼šé€šè¿‡response.getHits()è·å–ï¼Œå°±æ˜¯JSONä¸­çš„æœ€å¤–å±‚çš„hitsï¼Œä»£è¡¨å‘½ä¸­çš„ç»“æœ<br>Â  - <code>SearchHits#getTotalHits().value</code>ï¼šè·å–æ€»æ¡æ•°ä¿¡æ¯<br>Â  - <code>SearchHits#getHits()</code>ï¼šè·å–SearchHitæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æ–‡æ¡£æ•°ç»„<br>Â  Â  - <code>SearchHit#getSourceAsString()</code>ï¼šè·å–æ–‡æ¡£ç»“æœä¸­çš„_sourceï¼Œä¹Ÿå°±æ˜¯åŸå§‹çš„jsonæ–‡æ¡£æ•°æ®</li>
</ul>
<h5 id="9-1-3-å®Œæ•´ä»£ç "><a href="#9-1-3-å®Œæ•´ä»£ç " class="headerlink" title="9.1.3.å®Œæ•´ä»£ç "></a>9.1.3.å®Œæ•´ä»£ç </h5><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><figcaption><span>title:testMatchAll()</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatchAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">Â  Â  <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">Â  Â  <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">Â  Â  <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">Â  Â  request.source()</span><br><span class="line">Â  Â  Â  Â  .query(QueryBuilders.matchAllQuery());</span><br><span class="line">Â  Â  <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">Â  Â  <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  handleResponse(response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">Â  Â  <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">Â  Â  <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">Â  Â  System.out.println(<span class="string">&quot;å…±æœç´¢åˆ°&quot;</span> + total + <span class="string">&quot;æ¡æ•°æ®&quot;</span>);</span><br><span class="line">Â  Â  <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">Â  Â  SearchHit[] hits = searchHits.getHits();</span><br><span class="line">Â  Â  <span class="comment">// 4.3.éå†</span></span><br><span class="line">Â  Â  <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">Â  Â  Â  Â  System.out.println(<span class="string">&quot;hotelDoc = &quot;</span> + hotelDoc);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="9-1-4-å°ç»“"><a href="#9-1-4-å°ç»“" class="headerlink" title="9.1.4.å°ç»“"></a>9.1.4.å°ç»“</h5><p>æŸ¥è¯¢çš„åŸºæœ¬æ­¥éª¤æ˜¯ï¼š</p>
<ol>
<li>åˆ›å»ºSearchRequestå¯¹è±¡</li>
<li>å‡†å¤‡Request.source()ï¼Œä¹Ÿå°±æ˜¯DSLã€‚<br>Â  Â â‘  QueryBuildersæ¥æ„å»ºæŸ¥è¯¢æ¡ä»¶<br>Â  Â â‘¡ ä¼ å…¥Request.source() çš„ query() æ–¹æ³•</li>
<li>å‘é€è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœ</li>
<li>è§£æç»“æœï¼ˆå‚è€ƒJSONç»“æœï¼Œä»å¤–åˆ°å†…ï¼Œé€å±‚è§£æï¼‰</li>
</ol>
<h4 id="9-2-matchæŸ¥è¯¢"><a href="#9-2-matchæŸ¥è¯¢" class="headerlink" title="9.2.matchæŸ¥è¯¢"></a>9.2.matchæŸ¥è¯¢</h4><p>å…¨æ–‡æ£€ç´¢çš„matchå’Œmulti_matchæŸ¥è¯¢ä¸match_allçš„APIåŸºæœ¬ä¸€è‡´ã€‚å·®åˆ«æ˜¯æŸ¥è¯¢æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯queryçš„éƒ¨åˆ†ã€‚<br><img src="/img/image-20210721215923060.png" alt="image-20210721215923060"></p>
<p>å› æ­¤ï¼ŒJavaä»£ç ä¸Šçš„å·®å¼‚ä¸»è¦æ˜¯request.source().query()ä¸­çš„å‚æ•°äº†ã€‚åŒæ ·æ˜¯åˆ©ç”¨QueryBuildersæä¾›çš„æ–¹æ³•ï¼š<br><img src="/img/image-20210721215843099.png" alt="image-20210721215843099"><br>è€Œç»“æœè§£æä»£ç åˆ™å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥æŠ½å–å¹¶å…±äº«ã€‚<br>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">Â  Â  <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">Â  Â  <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">Â  Â  <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">Â  Â  request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;å¦‚å®¶&quot;</span>));</span><br><span class="line">Â  Â  <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">Â  Â  <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="9-3-ç²¾ç¡®æŸ¥è¯¢"><a href="#9-3-ç²¾ç¡®æŸ¥è¯¢" class="headerlink" title="9.3.ç²¾ç¡®æŸ¥è¯¢"></a>9.3.ç²¾ç¡®æŸ¥è¯¢</h4><p>ç²¾ç¡®æŸ¥è¯¢ä¸»è¦æ˜¯ä¸¤è€…ï¼š</p>
<ul>
<li>termï¼šè¯æ¡ç²¾ç¡®åŒ¹é…</li>
<li>rangeï¼šèŒƒå›´æŸ¥è¯¢<br>ä¸ä¹‹å‰çš„æŸ¥è¯¢ç›¸æ¯”ï¼Œå·®å¼‚åŒæ ·åœ¨æŸ¥è¯¢æ¡ä»¶ï¼Œå…¶å®ƒéƒ½ä¸€æ ·ã€‚<br>æŸ¥è¯¢æ¡ä»¶æ„é€ çš„APIå¦‚ä¸‹ï¼š<br><img src="/img/image-20210721220305140.png" alt="image-20210721220305140"></li>
</ul>
<h4 id="9-4-å¸ƒå°”æŸ¥è¯¢"><a href="#9-4-å¸ƒå°”æŸ¥è¯¢" class="headerlink" title="9.4.å¸ƒå°”æŸ¥è¯¢"></a>9.4.å¸ƒå°”æŸ¥è¯¢</h4><p>å¸ƒå°”æŸ¥è¯¢æ˜¯ç”¨mustã€must_notã€filterç­‰æ–¹å¼ç»„åˆå…¶å®ƒæŸ¥è¯¢ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><img src="/img/image-20210721220927286.png" alt="image-20210721220927286"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒAPIä¸å…¶å®ƒæŸ¥è¯¢çš„å·®åˆ«åŒæ ·æ˜¯åœ¨æŸ¥è¯¢æ¡ä»¶çš„æ„å»ºï¼ŒQueryBuildersï¼Œç»“æœè§£æç­‰å…¶ä»–ä»£ç å®Œå…¨ä¸å˜ã€‚<br>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><figcaption><span>title:boolæŸ¥è¯¢æ„å»º</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBool</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">Â  Â  <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">Â  Â  <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">Â  Â  <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">Â  Â  <span class="comment">// 2.1.å‡†å¤‡BooleanQuery</span></span><br><span class="line">Â  Â  <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">Â  Â  <span class="comment">// 2.2.æ·»åŠ term</span></span><br><span class="line">Â  Â  boolQuery.must(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;æ­å·&quot;</span>));</span><br><span class="line">Â  Â  <span class="comment">// 2.3.æ·»åŠ range</span></span><br><span class="line">Â  Â  boolQuery.filter(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).lte(<span class="number">250</span>));</span><br><span class="line">Â  Â  request.source().query(boolQuery);</span><br><span class="line">Â  Â  <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">Â  Â  <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-5-æ’åºã€åˆ†é¡µ"><a href="#9-5-æ’åºã€åˆ†é¡µ" class="headerlink" title="9.5.æ’åºã€åˆ†é¡µ"></a>9.5.æ’åºã€åˆ†é¡µ</h4><p>æœç´¢ç»“æœçš„æ’åºå’Œåˆ†é¡µæ˜¯ä¸<code>query</code><strong>åŒçº§</strong>çš„å‚æ•°ï¼Œå› æ­¤åŒæ ·æ˜¯ä½¿ç”¨<code>request.source()</code>æ¥è®¾ç½®ã€‚<br>å¯¹åº”çš„APIå¦‚ä¸‹ï¼š<br><img src="/img/image-20210721221121266.png" alt="image-20210721221121266"><br>å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPageAndSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">Â  Â  <span class="comment">// é¡µç ï¼Œæ¯é¡µå¤§å°</span></span><br><span class="line">Â  Â  <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> <span class="number">1</span>, size = <span class="number">5</span>;</span><br><span class="line">Â  Â  <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">Â  Â  <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">Â  Â  <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">Â  Â  <span class="comment">// 2.1.query</span></span><br><span class="line">Â  Â  request.source().query(QueryBuilders.matchAllQuery());</span><br><span class="line">Â  Â  <span class="comment">// 2.2.æ’åº sort</span></span><br><span class="line">Â  Â  request.source().sort(<span class="string">&quot;price&quot;</span>, SortOrder.ASC);</span><br><span class="line">Â  Â  <span class="comment">// 2.3.åˆ†é¡µ fromã€size</span></span><br><span class="line">Â  Â  request.source().from((page - <span class="number">1</span>) * size).size(<span class="number">5</span>);</span><br><span class="line">Â  Â  <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">Â  Â  <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-6-é«˜äº®"><a href="#9-6-é«˜äº®" class="headerlink" title="9.6.é«˜äº®"></a>9.6.é«˜äº®</h4><p>é«˜äº®çš„ä»£ç ä¸ä¹‹å‰ä»£ç å·®å¼‚è¾ƒå¤§ï¼Œæœ‰ä¸¤ç‚¹ï¼š</p>
<ul>
<li>æŸ¥è¯¢çš„DSLï¼šå…¶ä¸­é™¤äº†æŸ¥è¯¢æ¡ä»¶ï¼Œè¿˜éœ€è¦æ·»åŠ é«˜äº®æ¡ä»¶ï¼ŒåŒæ ·æ˜¯ä¸queryåŒçº§ã€‚</li>
<li>ç»“æœè§£æï¼šç»“æœé™¤äº†è¦è§£æ_sourceæ–‡æ¡£æ•°æ®ï¼Œè¿˜è¦è§£æé«˜äº®ç»“æœ</li>
</ul>
<h5 id="9-6-1-é«˜äº®è¯·æ±‚æ„å»º"><a href="#9-6-1-é«˜äº®è¯·æ±‚æ„å»º" class="headerlink" title="9.6.1.é«˜äº®è¯·æ±‚æ„å»º"></a>9.6.1.é«˜äº®è¯·æ±‚æ„å»º</h5><p>é«˜äº®è¯·æ±‚çš„æ„å»ºAPIå¦‚ä¸‹ï¼š<br><img src="/img/image-20210721221744883.png" alt="image-20210721221744883"></p>
<p>ä¸Šè¿°ä»£ç çœç•¥äº†æŸ¥è¯¢æ¡ä»¶éƒ¨åˆ†ï¼Œä½†æ˜¯å¤§å®¶ä¸è¦å¿˜äº†ï¼š</p>
<blockquote>
<p>é«˜äº®æŸ¥è¯¢å¿…é¡»ä½¿ç”¨<strong>å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</strong>ï¼Œå¹¶ä¸”è¦æœ‰æœç´¢å…³é”®å­—ï¼Œå°†æ¥æ‰å¯ä»¥å¯¹å…³é”®å­—é«˜äº®ã€‚</p>
</blockquote>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHighlight</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">Â  Â  <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">Â  Â  <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">Â  Â  <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">Â  Â  <span class="comment">// 2.1.query</span></span><br><span class="line">Â  Â  request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;å¦‚å®¶&quot;</span>));</span><br><span class="line">Â  Â  <span class="comment">// 2.2.é«˜äº®</span></span><br><span class="line">Â  Â  request.source()</span><br><span class="line">Â  Â  .highlighter(<span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>()</span><br><span class="line">Â  Â  .field(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">Â  Â  .requireFieldMatch(<span class="literal">false</span>));</span><br><span class="line">Â  Â  <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">Â  Â  <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="9-6-2-é«˜äº®ç»“æœè§£æ"><a href="#9-6-2-é«˜äº®ç»“æœè§£æ" class="headerlink" title="9.6.2.é«˜äº®ç»“æœè§£æ"></a>9.6.2.é«˜äº®ç»“æœè§£æ</h5><p>é«˜äº®çš„ç»“æœä¸æŸ¥è¯¢çš„æ–‡æ¡£ç»“æœé»˜è®¤æ˜¯åˆ†ç¦»çš„ï¼Œå¹¶ä¸åœ¨ä¸€èµ·ã€‚<br>å› æ­¤è§£æé«˜äº®çš„ä»£ç éœ€è¦é¢å¤–å¤„ç†ï¼š<br><img src="/img/image-20210721222057212.png" alt="image-20210721222057212"></p>
<p>ä»£ç è§£è¯»ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šä»ç»“æœä¸­è·å–sourceã€‚<code>hit.getSourceAsString()</code>ï¼Œè¿™éƒ¨åˆ†æ˜¯éé«˜äº®ç»“æœï¼Œjsonå­—ç¬¦ä¸²ã€‚è¿˜éœ€è¦ååºåˆ—ä¸ºHotelDocå¯¹è±¡</li>
<li>ç¬¬äºŒæ­¥ï¼šè·å–é«˜äº®ç»“æœã€‚<code>hit.getHighlightFields()</code>ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªMapï¼Œ<strong>keyæ˜¯é«˜äº®å­—æ®µåç§°ï¼Œå€¼æ˜¯HighlightFieldå¯¹è±¡</strong>ï¼Œä»£è¡¨é«˜äº®å€¼</li>
<li>ç¬¬ä¸‰æ­¥ï¼šä»mapä¸­æ ¹æ®é«˜äº®å­—æ®µåç§°ï¼Œè·å–é«˜äº®å­—æ®µå€¼å¯¹è±¡HighlightField</li>
<li>ç¬¬å››æ­¥ï¼šä»HighlightFieldä¸­è·å–Fragmentsï¼Œå¹¶ä¸”è½¬ä¸ºå­—ç¬¦ä¸²ã€‚è¿™éƒ¨åˆ†å°±æ˜¯çœŸæ­£çš„é«˜äº®å­—ç¬¦ä¸²äº†</li>
<li>ç¬¬äº”æ­¥ï¼šç”¨é«˜äº®çš„ç»“æœæ›¿æ¢HotelDocä¸­çš„éé«˜äº®ç»“æœ</li>
</ul>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><figcaption><span>title:è§£æé«˜äº®ç»“æœ</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">Â  Â  <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">Â  Â  <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">Â  Â  System.out.println(<span class="string">&quot;å…±æœç´¢åˆ°&quot;</span> + total + <span class="string">&quot;æ¡æ•°æ®&quot;</span>);</span><br><span class="line">Â  Â  <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">Â  Â  SearchHit[] hits = searchHits.getHits();</span><br><span class="line">Â  Â  <span class="comment">// 4.3.éå†</span></span><br><span class="line">Â  Â  <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// è·å–é«˜äº®ç»“æœ</span></span><br><span class="line">Â  Â  Â  Â  Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (!CollectionUtils.isEmpty(highlightFields)) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// æ ¹æ®å­—æ®µåè·å–é«˜äº®ç»“æœ</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="type">HighlightField</span> <span class="variable">highlightField</span> <span class="operator">=</span> highlightFields.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (highlightField != <span class="literal">null</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// è·å–é«˜äº®å€¼</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> highlightField.getFragments()[<span class="number">0</span>].string();</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// è¦†ç›–éé«˜äº®ç»“æœ</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  hotelDoc.setName(name);</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  System.out.println(<span class="string">&quot;hotelDoc = &quot;</span> + hotelDoc);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-æ—…æ¸¸æ¡ˆä¾‹"><a href="#10-æ—…æ¸¸æ¡ˆä¾‹" class="headerlink" title="10.æ—…æ¸¸æ¡ˆä¾‹"></a>10.æ—…æ¸¸æ¡ˆä¾‹</h2><p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡æ—…æ¸¸çš„æ¡ˆä¾‹æ¥å®æˆ˜æ¼”ç»ƒä¸‹ä¹‹å‰å­¦ä¹ çš„çŸ¥è¯†ã€‚<br>æˆ‘ä»¬å®ç°å››éƒ¨åˆ†åŠŸèƒ½ï¼š</p>
<ul>
<li>é…’åº—æœç´¢å’Œåˆ†é¡µ</li>
<li>é…’åº—ç»“æœè¿‡æ»¤</li>
<li>æˆ‘å‘¨è¾¹çš„é…’åº—</li>
<li>é…’åº—ç«ä»·æ’å<br>å¯åŠ¨æˆ‘ä»¬æä¾›çš„hotel-demoé¡¹ç›®ï¼Œå…¶é»˜è®¤ç«¯å£æ˜¯8089ï¼Œè®¿é—®<a href="http://localhost:8090ï¼Œå°±èƒ½çœ‹åˆ°é¡¹ç›®é¡µé¢äº†ï¼š">http://localhost:8090ï¼Œå°±èƒ½çœ‹åˆ°é¡¹ç›®é¡µé¢äº†ï¼š</a></li>
</ul>
<p><img src="/img/image-20210721223159598.png" alt="image-20210721223159598"></p>
<h4 id="10-1-é…’åº—æœç´¢å’Œåˆ†é¡µ"><a href="#10-1-é…’åº—æœç´¢å’Œåˆ†é¡µ" class="headerlink" title="10.1.é…’åº—æœç´¢å’Œåˆ†é¡µ"></a>10.1.é…’åº—æœç´¢å’Œåˆ†é¡µ</h4><p>æ¡ˆä¾‹éœ€æ±‚ï¼šå®ç°é»‘é©¬æ—…æ¸¸çš„é…’åº—æœç´¢åŠŸèƒ½ï¼Œå®Œæˆå…³é”®å­—æœç´¢å’Œåˆ†é¡µ</p>
<h5 id="10-1-1-éœ€æ±‚åˆ†æ"><a href="#10-1-1-éœ€æ±‚åˆ†æ" class="headerlink" title="10.1.1.éœ€æ±‚åˆ†æ"></a>10.1.1.éœ€æ±‚åˆ†æ</h5><p>åœ¨é¡¹ç›®çš„é¦–é¡µï¼Œæœ‰ä¸€ä¸ªå¤§å¤§çš„æœç´¢æ¡†ï¼Œè¿˜æœ‰åˆ†é¡µæŒ‰é’®ï¼š</p>
<p><img src="/img/image-20210721223859419.png" alt="image-20210721223859419"></p>
<p>ç‚¹å‡»æœç´¢æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ§åˆ¶å°å‘å‡ºäº†è¯·æ±‚ï¼š</p>
<p><img src="/img/image-20210721224033789.png" alt="image-20210721224033789"></p>
<p>è¯·æ±‚å‚æ•°å¦‚ä¸‹ï¼š</p>
<p><img src="/img/image-20210721224112708.png" alt="image-20210721224112708"></p>
<p>ç”±æ­¤å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬è¿™ä¸ªè¯·æ±‚çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šPOST</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;hotel&#x2F;list</li>
<li>è¯·æ±‚å‚æ•°ï¼šJSONå¯¹è±¡ï¼ŒåŒ…å«4ä¸ªå­—æ®µï¼š<br>Â  - keyï¼šæœç´¢å…³é”®å­—<br>Â  - pageï¼šé¡µç <br>Â  - sizeï¼šæ¯é¡µå¤§å°<br>Â  - sortByï¼šæ’åºï¼Œç›®å‰æš‚ä¸å®ç°</li>
<li>è¿”å›å€¼ï¼šåˆ†é¡µæŸ¥è¯¢ï¼Œéœ€è¦è¿”å›åˆ†é¡µç»“æœPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ï¼š<br>Â  - <code>total</code>ï¼šæ€»æ¡æ•°<br>Â  - <code>List&lt;HotelDoc&gt;</code>ï¼šå½“å‰é¡µçš„æ•°æ®<br>å› æ­¤ï¼Œæˆ‘ä»¬å®ç°ä¸šåŠ¡çš„æµç¨‹å¦‚ä¸‹ï¼š</li>
<li>æ­¥éª¤ä¸€ï¼šå®šä¹‰å®ä½“ç±»ï¼Œæ¥æ”¶è¯·æ±‚å‚æ•°çš„JSONå¯¹è±¡</li>
<li>æ­¥éª¤äºŒï¼šç¼–å†™controllerï¼Œæ¥æ”¶é¡µé¢çš„è¯·æ±‚  </li>
<li>æ­¥éª¤ä¸‰ï¼šç¼–å†™ä¸šåŠ¡å®ç°ï¼Œåˆ©ç”¨RestHighLevelClientå®ç°æœç´¢ã€åˆ†é¡µ</li>
</ul>
<p>10.1.2.å®šä¹‰å®ä½“ç±»<br>å®ä½“ç±»æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å‰ç«¯çš„è¯·æ±‚å‚æ•°å®ä½“ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡ç«¯åº”è¯¥è¿”å›çš„å“åº”ç»“æœå®ä½“ã€‚<br>1ï¼‰è¯·æ±‚å‚æ•°<br>å‰ç«¯è¯·æ±‚çš„jsonç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â  Â  <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœç´¢å…³é”®å­—&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â  Â  <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">Â  Â  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">Â  Â  <span class="attr">&quot;sortBy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹å®šä¹‰ä¸€ä¸ªå®ä½“ç±»ï¼š</p>
<figure class="highlight java"><figcaption><span>title:RequestParams</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> &#123;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String key;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer page;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer size;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String sortBy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ï¼‰è¿”å›å€¼<br>åˆ†é¡µæŸ¥è¯¢ï¼Œéœ€è¦è¿”å›åˆ†é¡µç»“æœPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ï¼š</p>
<ul>
<li><code>total</code>ï¼šæ€»æ¡æ•°</li>
<li><code>List&lt;HotelDoc&gt;</code>ï¼šå½“å‰é¡µçš„æ•°æ®<br>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>cn.itcast.hotel.pojo</code>ä¸­å®šä¹‰è¿”å›ç»“æœï¼š<figure class="highlight java"><figcaption><span>title:PageResult</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> &#123;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Long total;</span><br><span class="line">Â  Â  <span class="keyword">private</span> List&lt;HotelDoc&gt; hotels;</span><br><span class="line">Â  Â  <span class="keyword">public</span> <span class="title function_">PageResult</span><span class="params">()</span> &#123;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">public</span> <span class="title function_">PageResult</span><span class="params">(Long total, List&lt;HotelDoc&gt; hotels)</span> &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.total = total;</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.hotels = hotels;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="10-1-3-å®šä¹‰controller"><a href="#10-1-3-å®šä¹‰controller" class="headerlink" title="10.1.3.å®šä¹‰controller"></a>10.1.3.å®šä¹‰controller</h5><p>å®šä¹‰ä¸€ä¸ªHotelControllerï¼Œå£°æ˜æŸ¥è¯¢æ¥å£ï¼Œæ»¡è¶³ä¸‹åˆ—è¦æ±‚ï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šPost</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;hotel&#x2F;list</li>
<li>è¯·æ±‚å‚æ•°ï¼šå¯¹è±¡ï¼Œç±»å‹ä¸ºRequestParam</li>
<li>è¿”å›å€¼ï¼šPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§<br>Â  - <code>Long total</code>ï¼šæ€»æ¡æ•°<br>Â  - <code>List&lt;HotelDoc&gt; hotels</code>ï¼šé…’åº—æ•°æ®<br>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>cn.itcast.hotel.web</code>ä¸­å®šä¹‰HotelControllerï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hotel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelController</span> &#123;</span><br><span class="line">Â  Â  <span class="meta">@Autowired</span></span><br><span class="line">Â  Â  <span class="keyword">private</span> IHotelService hotelService;</span><br><span class="line">Â  Â  <span class="comment">// æœç´¢é…’åº—æ•°æ®</span></span><br><span class="line">Â  Â  <span class="meta">@PostMapping(&quot;/list&quot;)</span></span><br><span class="line">Â  Â  <span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(<span class="meta">@RequestBody</span> RequestParams params)</span>&#123;</span><br><span class="line">Â  Â  Â    <span class="keyword">return</span> hotelService.search(params);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>10.1.4.å®ç°æœç´¢ä¸šåŠ¡<br>æˆ‘ä»¬åœ¨controllerè°ƒç”¨äº†IHotelServiceï¼Œå¹¶æ²¡æœ‰å®ç°è¯¥æ–¹æ³•ï¼Œå› æ­¤ä¸‹é¢æˆ‘ä»¬å°±åœ¨IHotelServiceä¸­å®šä¹‰æ–¹æ³•ï¼Œå¹¶ä¸”å»å®ç°ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>1ï¼‰åœ¨<code>cn.itcast.hotel.service</code>ä¸­çš„<code>IHotelService</code>æ¥å£ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Â * æ ¹æ®å…³é”®å­—æœç´¢é…’åº—ä¿¡æ¯</span></span><br><span class="line"><span class="comment">Â * <span class="doctag">@param</span> params è¯·æ±‚å‚æ•°å¯¹è±¡ï¼ŒåŒ…å«ç”¨æˆ·è¾“å…¥çš„å…³é”®å­—</span></span><br><span class="line"><span class="comment">Â * <span class="doctag">@return</span> é…’åº—æ–‡æ¡£åˆ—è¡¨</span></span><br><span class="line"><span class="comment">Â */</span></span><br><span class="line">PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span>;</span><br></pre></td></tr></table></figure>

<p>2ï¼‰å®ç°æœç´¢ä¸šåŠ¡ï¼Œè‚¯å®šç¦»ä¸å¼€RestHighLevelClientï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒæ³¨å†Œåˆ°Springä¸­ä½œä¸ºä¸€ä¸ªBeanã€‚åœ¨<code>cn.itcast.hotel</code>ä¸­çš„<code>HotelDemoApplication</code>ä¸­å£°æ˜è¿™ä¸ªBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RestHighLevelClient <span class="title function_">client</span><span class="params">()</span>&#123;</span><br><span class="line">Â  Â  <span class="keyword">return</span> Â <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">Â  Â  Â  Â  HttpHost.create(<span class="string">&quot;http://192.168.150.101:9200&quot;</span>)</span><br><span class="line">Â  Â  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ï¼‰åœ¨<code>cn.itcast.hotel.service.impl</code>ä¸­çš„<code>HotelService</code>ä¸­å®ç°searchæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span> &#123;</span><br><span class="line">Â  Â  <span class="keyword">try</span> &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 2.1.query</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  boolQuery.must(QueryBuilders.matchAllQuery());</span><br><span class="line">Â  Â  Â  Â  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 2.2.åˆ†é¡µ</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> params.getPage();</span><br><span class="line">Â  Â  Â  Â  <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> params.getSize();</span><br><span class="line">Â  Â  Â  Â  request.source().from((page - <span class="number">1</span>) * size).size(size);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> handleResponse(response);</span><br><span class="line">Â  Â  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç»“æœè§£æ</span></span><br><span class="line"><span class="keyword">private</span> PageResult <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">Â  Â  <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">Â  Â  <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">Â  Â  <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">Â  Â  SearchHit[] hits = searchHits.getHits();</span><br><span class="line">Â  Â  <span class="comment">// 4.3.éå†</span></span><br><span class="line">Â  Â  List&lt;HotelDoc&gt; hotels = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Â  Â  <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// æ”¾å…¥é›†åˆ</span></span><br><span class="line">Â  Â  Â  Â  hotels.add(hotelDoc);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// 4.4.å°è£…è¿”å›</span></span><br><span class="line">Â  Â  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total, hotels);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-2-é…’åº—ç»“æœè¿‡æ»¤"><a href="#10-2-é…’åº—ç»“æœè¿‡æ»¤" class="headerlink" title="10.2.é…’åº—ç»“æœè¿‡æ»¤"></a>10.2.é…’åº—ç»“æœè¿‡æ»¤</h4><p>éœ€æ±‚ï¼šæ·»åŠ å“ç‰Œã€åŸå¸‚ã€æ˜Ÿçº§ã€ä»·æ ¼ç­‰è¿‡æ»¤åŠŸèƒ½</p>
<h5 id="10-2-1-éœ€æ±‚åˆ†æ"><a href="#10-2-1-éœ€æ±‚åˆ†æ" class="headerlink" title="10.2.1.éœ€æ±‚åˆ†æ"></a>10.2.1.éœ€æ±‚åˆ†æ</h5><p>åœ¨é¡µé¢æœç´¢æ¡†ä¸‹é¢ï¼Œä¼šæœ‰ä¸€äº›è¿‡æ»¤é¡¹ï¼š</p>
<p><img src="/img/image-20210722091940726.png" alt="image-20210722091940726"><br>ä¼ é€’çš„å‚æ•°å¦‚å›¾ï¼š<br><img src="/img/image-20210722092051994.png" alt="image-20210722092051994"></p>
<p>åŒ…å«çš„è¿‡æ»¤æ¡ä»¶æœ‰ï¼š</p>
<ul>
<li>brandï¼šå“ç‰Œå€¼</li>
<li>cityï¼šåŸå¸‚</li>
<li>minPrice~maxPriceï¼šä»·æ ¼èŒƒå›´</li>
<li>starNameï¼šæ˜Ÿçº§<br>æˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼š</li>
<li>ä¿®æ”¹è¯·æ±‚å‚æ•°çš„å¯¹è±¡RequestParamsï¼Œæ¥æ”¶ä¸Šè¿°å‚æ•°</li>
<li>ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨æœç´¢æ¡ä»¶ä¹‹å¤–ï¼Œæ·»åŠ ä¸€äº›è¿‡æ»¤æ¡ä»¶</li>
</ul>
<h5 id="10-2-2-ä¿®æ”¹å®ä½“ç±»"><a href="#10-2-2-ä¿®æ”¹å®ä½“ç±»" class="headerlink" title="10.2.2.ä¿®æ”¹å®ä½“ç±»"></a>10.2.2.ä¿®æ”¹å®ä½“ç±»</h5><p>ä¿®æ”¹åœ¨<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹çš„å®ä½“ç±»RequestParamsï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> &#123;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String key;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer page;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer size;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String sortBy;</span><br><span class="line">Â  Â  <span class="comment">// ä¸‹é¢æ˜¯æ–°å¢çš„è¿‡æ»¤æ¡ä»¶å‚æ•°</span></span><br><span class="line">Â  Â  <span class="keyword">private</span> String city;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String brand;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String starName;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer minPrice;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer maxPrice;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="10-2-3-ä¿®æ”¹æœç´¢ä¸šåŠ¡"><a href="#10-2-3-ä¿®æ”¹æœç´¢ä¸šåŠ¡" class="headerlink" title="10.2.3.ä¿®æ”¹æœç´¢ä¸šåŠ¡"></a>10.2.3.ä¿®æ”¹æœç´¢ä¸šåŠ¡</h5><p>åœ¨HotelServiceçš„searchæ–¹æ³•ä¸­ï¼Œåªæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼šrequet.source().query( â€¦ )å…¶ä¸­çš„æŸ¥è¯¢æ¡ä»¶ã€‚</p>
<p>åœ¨ä¹‹å‰çš„ä¸šåŠ¡ä¸­ï¼Œåªæœ‰matchæŸ¥è¯¢ï¼Œæ ¹æ®å…³é”®å­—æœç´¢ï¼Œç°åœ¨è¦æ·»åŠ æ¡ä»¶è¿‡æ»¤ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å“ç‰Œè¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢</li>
<li>æ˜Ÿçº§è¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢</li>
<li>ä»·æ ¼è¿‡æ»¤ï¼šæ˜¯æ•°å€¼ç±»å‹ï¼Œç”¨rangeæŸ¥è¯¢</li>
<li>åŸå¸‚è¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢</li>
</ul>
<p>å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ç»„åˆï¼Œè‚¯å®šæ˜¯booleanæŸ¥è¯¢æ¥ç»„åˆï¼š</p>
<ul>
<li>å…³é”®å­—æœç´¢æ”¾åˆ°mustä¸­ï¼Œå‚ä¸ç®—åˆ†</li>
<li>å…¶å®ƒè¿‡æ»¤æ¡ä»¶æ”¾åˆ°filterä¸­ï¼Œä¸å‚ä¸ç®—åˆ†<br>å› ä¸ºæ¡ä»¶æ„å»ºçš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå…ˆå°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼š</li>
</ul>
<p><img src="/img/image-20210722092935453.png" alt="image-20210722092935453"></p>
<p><code>buildBasicQuery</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><figcaption><span>title:buildBasicQuery</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildBasicQuery</span><span class="params">(RequestParams params, SearchRequest request)</span> &#123;</span><br><span class="line">Â  Â  <span class="comment">// 1.æ„å»ºBooleanQuery</span></span><br><span class="line">Â  Â  <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">Â  Â  <span class="comment">// 2.å…³é”®å­—æœç´¢</span></span><br><span class="line">Â  Â  <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">Â  Â  <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.must(QueryBuilders.matchAllQuery());</span><br><span class="line">Â  Â  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// 3.åŸå¸‚æ¡ä»¶</span></span><br><span class="line">Â  Â  <span class="comment">// filter ä¸å‚ä¸ç®—æ³•ï¼Œæé«˜æ€§èƒ½</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (params.getCity() != <span class="literal">null</span> &amp;&amp; !params.getCity().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, params.getCity()));</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// 4.å“ç‰Œæ¡ä»¶</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (params.getBrand() != <span class="literal">null</span> &amp;&amp; !params.getBrand().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;brand&quot;</span>, params.getBrand()));</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// 5.æ˜Ÿçº§æ¡ä»¶</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (params.getStarName() != <span class="literal">null</span> &amp;&amp; !params.getStarName().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;starName&quot;</span>, params.getStarName()));</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// 6.ä»·æ ¼</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (params.getMinPrice() != <span class="literal">null</span> &amp;&amp; params.getMaxPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.filter(QueryBuilders</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .rangeQuery(<span class="string">&quot;price&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .gte(params.getMinPrice())</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .lte(params.getMaxPrice())</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// 7.æ”¾å…¥source</span></span><br><span class="line">Â  Â  request.source().query(boolQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-3-æˆ‘å‘¨è¾¹çš„é…’åº—"><a href="#10-3-æˆ‘å‘¨è¾¹çš„é…’åº—" class="headerlink" title="10.3.æˆ‘å‘¨è¾¹çš„é…’åº—"></a>10.3.æˆ‘å‘¨è¾¹çš„é…’åº—</h4><p>éœ€æ±‚ï¼šæˆ‘é™„è¿‘çš„é…’åº—</p>
<h5 id="10-3-1-éœ€æ±‚åˆ†æ"><a href="#10-3-1-éœ€æ±‚åˆ†æ" class="headerlink" title="10.3.1.éœ€æ±‚åˆ†æ"></a>10.3.1.éœ€æ±‚åˆ†æ</h5><p>åœ¨é…’åº—åˆ—è¡¨é¡µçš„å³ä¾§ï¼Œæœ‰ä¸€ä¸ªå°åœ°å›¾ï¼Œç‚¹å‡»åœ°å›¾çš„å®šä½æŒ‰é’®ï¼Œåœ°å›¾ä¼šæ‰¾åˆ°ä½ æ‰€åœ¨çš„ä½ç½®ï¼š</p>
<p><img src="/img/image-20210722093414542.png" alt="image-20210722093414542"><br>å¹¶ä¸”ï¼Œåœ¨å‰ç«¯ä¼šå‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œå°†ä½ çš„åæ ‡å‘é€åˆ°æœåŠ¡ç«¯ï¼š<br><img src="/img/image-20210722093642382.png" alt="image-20210722093642382"></p>
<p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯åŸºäºè¿™ä¸ªlocationåæ ‡ï¼Œç„¶åæŒ‰ç…§è·ç¦»å¯¹å‘¨å›´é…’åº—æ’åºã€‚å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¿®æ”¹RequestParamså‚æ•°ï¼Œæ¥æ”¶locationå­—æ®µ</li>
<li>ä¿®æ”¹searchæ–¹æ³•ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœlocationæœ‰å€¼ï¼Œæ·»åŠ æ ¹æ®geo_distanceæ’åºçš„åŠŸèƒ½</li>
</ul>
<h5 id="10-3-2-ä¿®æ”¹å®ä½“ç±»"><a href="#10-3-2-ä¿®æ”¹å®ä½“ç±»" class="headerlink" title="10.3.2.ä¿®æ”¹å®ä½“ç±»"></a>10.3.2.ä¿®æ”¹å®ä½“ç±»</h5><p>ä¿®æ”¹åœ¨<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹çš„å®ä½“ç±»RequestParamsï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> &#123;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String key;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer page;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer size;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String sortBy;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String city;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String brand;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String starName;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer minPrice;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer maxPrice;</span><br><span class="line">Â  Â  <span class="comment">// æˆ‘å½“å‰çš„åœ°ç†åæ ‡</span></span><br><span class="line">Â  Â  <span class="keyword">private</span> String location;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="10-3-3-è·ç¦»æ’åºAPI"><a href="#10-3-3-è·ç¦»æ’åºAPI" class="headerlink" title="10.3.3.è·ç¦»æ’åºAPI"></a>10.3.3.è·ç¦»æ’åºAPI</h5><p>æˆ‘ä»¬ä»¥å‰å­¦ä¹ è¿‡æ’åºåŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼š</p>
<ul>
<li>æ™®é€šå­—æ®µæ’åº</li>
<li>åœ°ç†åæ ‡æ’åº<br>æˆ‘ä»¬åªè®²äº†æ™®é€šå­—æ®µæ’åºå¯¹åº”çš„javaå†™æ³•ã€‚åœ°ç†åæ ‡æ’åºåªå­¦è¿‡DSLè¯­æ³•ï¼Œå¦‚ä¸‹ï¼š<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span>Â Â </span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;_geo_distance&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;çº¬åº¦ï¼Œç»åº¦&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;order&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;unit&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;km&quot;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>å¯¹åº”çš„javaä»£ç ç¤ºä¾‹ï¼š<br><img src="/img/image-20210722095227059.png" alt="image-20210722095227059"></p>
<h5 id="10-3-4-æ·»åŠ è·ç¦»æ’åº"><a href="#10-3-4-æ·»åŠ è·ç¦»æ’åº" class="headerlink" title="10.3.4.æ·»åŠ è·ç¦»æ’åº"></a>10.3.4.æ·»åŠ è·ç¦»æ’åº</h5><p>åœ¨<code>cn.itcast.hotel.service.impl</code>çš„<code>HotelService</code>çš„<code>search</code>æ–¹æ³•ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ’åºåŠŸèƒ½ï¼š<br><img src="/img/image-20210722095902314.png" alt="image-20210722095902314"><br>å®Œæ•´ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span> &#123;</span><br><span class="line">Â  Â  <span class="keyword">try</span> &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 2.1.query</span></span><br><span class="line">Â  Â  Â  Â  buildBasicQuery(params, request);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 2.2.åˆ†é¡µ</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> params.getPage();</span><br><span class="line">Â  Â  Â  Â  <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> params.getSize();</span><br><span class="line">Â  Â  Â  Â  request.source().from((page - <span class="number">1</span>) * size).size(size);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 2.3.æ’åº</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">String</span> <span class="variable">location</span> <span class="operator">=</span> params.getLocation();</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (location != <span class="literal">null</span> &amp;&amp; !location.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  request.source().sort(SortBuilders</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .geoDistanceSort(<span class="string">&quot;location&quot;</span>, <span class="keyword">new</span> <span class="title class_">GeoPoint</span>(location))</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order(SortOrder.ASC)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .unit(DistanceUnit.KILOMETERS)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â );</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">Â  Â  Â  Â  <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> handleResponse(response);</span><br><span class="line">Â  Â  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="10-3-5-æ’åºè·ç¦»æ˜¾ç¤º"><a href="#10-3-5-æ’åºè·ç¦»æ˜¾ç¤º" class="headerlink" title="10.3.5.æ’åºè·ç¦»æ˜¾ç¤º"></a>10.3.5.æ’åºè·ç¦»æ˜¾ç¤º</h5><p>é‡å¯æœåŠ¡åï¼Œæµ‹è¯•æˆ‘çš„é…’åº—åŠŸèƒ½ï¼š<br><img src="/img/image-20210722100040674.png" alt="image-20210722100040674"></p>
<p>å‘ç°ç¡®å®å¯ä»¥å®ç°å¯¹æˆ‘é™„è¿‘é…’åº—çš„æ’åºï¼Œä¸è¿‡å¹¶æ²¡æœ‰çœ‹åˆ°é…’åº—åˆ°åº•è·ç¦»æˆ‘å¤šè¿œï¼Œè¿™è¯¥æ€ä¹ˆåŠï¼Ÿ<br>æ’åºå®Œæˆåï¼Œé¡µé¢è¿˜è¦è·å–æˆ‘é™„è¿‘æ¯ä¸ªé…’åº—çš„å…·ä½“<strong>è·ç¦»</strong>å€¼ï¼Œè¿™ä¸ªå€¼åœ¨å“åº”ç»“æœä¸­æ˜¯ç‹¬ç«‹çš„ï¼š</p>
<p><img src="/img/image-20210722095648542.png" alt="image-20210722095648542"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç»“æœè§£æé˜¶æ®µï¼Œé™¤äº†è§£æsourceéƒ¨åˆ†ä»¥å¤–ï¼Œè¿˜è¦å¾—åˆ°sortéƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æ’åºçš„è·ç¦»ï¼Œç„¶åæ”¾åˆ°å“åº”ç»“æœä¸­ã€‚<br>æˆ‘ä»¬è¦åšä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>ä¿®æ”¹HotelDocï¼Œæ·»åŠ æ’åºè·ç¦»å­—æ®µï¼Œç”¨äºé¡µé¢æ˜¾ç¤º</li>
<li>ä¿®æ”¹HotelServiceç±»ä¸­çš„handleResponseæ–¹æ³•ï¼Œæ·»åŠ å¯¹sortå€¼çš„è·å–<br>1ï¼‰ä¿®æ”¹HotelDocç±»ï¼Œæ·»åŠ è·ç¦»å­—æ®µ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelDoc</span> &#123;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Long id;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String name;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String address;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer price;</span><br><span class="line">Â  Â  <span class="keyword">private</span> Integer score;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String brand;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String city;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String starName;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String business;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String location;</span><br><span class="line">Â  Â  <span class="keyword">private</span> String pic;</span><br><span class="line">Â  Â  <span class="comment">// æ’åºæ—¶çš„ è·ç¦»å€¼</span></span><br><span class="line">Â  Â  <span class="keyword">private</span> Object distance;</span><br><span class="line">Â  Â  <span class="keyword">public</span> <span class="title function_">HotelDoc</span><span class="params">(Hotel hotel)</span> &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.id = hotel.getId();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.name = hotel.getName();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.address = hotel.getAddress();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.price = hotel.getPrice();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.score = hotel.getScore();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.brand = hotel.getBrand();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.city = hotel.getCity();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.starName = hotel.getStarName();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.business = hotel.getBusiness();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.location = hotel.getLatitude() + <span class="string">&quot;, &quot;</span> + hotel.getLongitude();</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">this</span>.pic = hotel.getPic();</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>2ï¼‰ä¿®æ”¹HotelServiceä¸­çš„handleResponseæ–¹æ³•<br><img src="/img/image-20210722100613966.png" alt="image-20210722100613966"></p>
<p>é‡å¯åæµ‹è¯•ï¼Œå‘ç°é¡µé¢èƒ½æˆåŠŸæ˜¾ç¤ºè·ç¦»äº†ï¼š<br><img src="/img/image-20210722100838604.png" alt="image-20210722100838604"></p>
<h4 id="10-4-é…’åº—ç«ä»·æ’å"><a href="#10-4-é…’åº—ç«ä»·æ’å" class="headerlink" title="10.4.é…’åº—ç«ä»·æ’å"></a>10.4.é…’åº—ç«ä»·æ’å</h4><p>éœ€æ±‚ï¼šè®©æŒ‡å®šçš„é…’åº—åœ¨æœç´¢ç»“æœä¸­æ’åç½®é¡¶</p>
<h5 id="10-4-1-éœ€æ±‚åˆ†æ"><a href="#10-4-1-éœ€æ±‚åˆ†æ" class="headerlink" title="10.4.1.éœ€æ±‚åˆ†æ"></a>10.4.1.éœ€æ±‚åˆ†æ</h5><p>è¦è®©æŒ‡å®šé…’åº—åœ¨æœç´¢ç»“æœä¸­æ’åç½®é¡¶ï¼Œæ•ˆæœå¦‚å›¾ï¼š</p>
<p><img src="/img/image-20210722100947292.png" alt="image-20210722100947292"><br>é¡µé¢ä¼šç»™æŒ‡å®šçš„é…’åº—æ·»åŠ <strong>å¹¿å‘Š</strong>æ ‡è®°ã€‚<br>é‚£æ€æ ·æ‰èƒ½è®©æŒ‡å®šçš„é…’åº—æ’åç½®é¡¶å‘¢ï¼Ÿ<br>æˆ‘ä»¬ä¹‹å‰å­¦ä¹ è¿‡çš„function_scoreæŸ¥è¯¢å¯ä»¥å½±å“ç®—åˆ†ï¼Œç®—åˆ†é«˜äº†ï¼Œè‡ªç„¶æ’åä¹Ÿå°±é«˜äº†ã€‚è€Œfunction_scoreåŒ…å«3ä¸ªè¦ç´ ï¼š</p>
<ul>
<li>è¿‡æ»¤æ¡ä»¶ï¼šå“ªäº›æ–‡æ¡£è¦åŠ åˆ†</li>
<li>ç®—åˆ†å‡½æ•°ï¼šå¦‚ä½•è®¡ç®—function score</li>
<li>åŠ æƒæ–¹å¼ï¼šfunction score ä¸ query scoreå¦‚ä½•è¿ç®—<br>è¿™é‡Œçš„éœ€æ±‚æ˜¯ï¼šè®©<strong>æŒ‡å®šé…’åº—</strong>æ’åé å‰ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ç»™è¿™äº›é…’åº—æ·»åŠ ä¸€ä¸ªæ ‡è®°ï¼Œè¿™æ ·åœ¨è¿‡æ»¤æ¡ä»¶ä¸­å°±å¯ä»¥<strong>æ ¹æ®è¿™ä¸ªæ ‡è®°æ¥åˆ¤æ–­ï¼Œæ˜¯å¦è¦æé«˜ç®—åˆ†</strong>ã€‚</li>
</ul>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»™é…’åº—æ·»åŠ ä¸€ä¸ªå­—æ®µï¼šisADï¼ŒBooleanç±»å‹ï¼š</p>
<ul>
<li>trueï¼šæ˜¯å¹¿å‘Š</li>
<li>falseï¼šä¸æ˜¯å¹¿å‘Š<br>è¿™æ ·function_scoreåŒ…å«3ä¸ªè¦ç´ å°±å¾ˆå¥½ç¡®å®šäº†ï¼š</li>
<li>è¿‡æ»¤æ¡ä»¶ï¼šåˆ¤æ–­isAD æ˜¯å¦ä¸ºtrue</li>
<li>ç®—åˆ†å‡½æ•°ï¼šæˆ‘ä»¬å¯ä»¥ç”¨æœ€ç®€å•æš´åŠ›çš„weightï¼Œå›ºå®šåŠ æƒå€¼</li>
<li>åŠ æƒæ–¹å¼ï¼šå¯ä»¥ç”¨é»˜è®¤çš„ç›¸ä¹˜ï¼Œå¤§å¤§æé«˜ç®—åˆ†<br>å› æ­¤ï¼Œä¸šåŠ¡çš„å®ç°æ­¥éª¤åŒ…æ‹¬ï¼š</li>
</ul>
<ol>
<li>ç»™HotelDocç±»æ·»åŠ isADå­—æ®µï¼ŒBooleanç±»å‹</li>
<li>æŒ‘é€‰å‡ ä¸ªä½ å–œæ¬¢çš„é…’åº—ï¼Œç»™å®ƒçš„æ–‡æ¡£æ•°æ®æ·»åŠ isADå­—æ®µï¼Œå€¼ä¸ºtrue</li>
<li>ä¿®æ”¹searchæ–¹æ³•ï¼Œæ·»åŠ function scoreåŠŸèƒ½ï¼Œç»™isADå€¼ä¸ºtrueçš„é…’åº—å¢åŠ æƒé‡</li>
</ol>
<h5 id="10-4-2-ä¿®æ”¹HotelDocå®ä½“"><a href="#10-4-2-ä¿®æ”¹HotelDocå®ä½“" class="headerlink" title="10.4.2.ä¿®æ”¹HotelDocå®ä½“"></a>10.4.2.ä¿®æ”¹HotelDocå®ä½“</h5><p>ç»™<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹çš„HotelDocç±»æ·»åŠ isADå­—æ®µï¼š<br><img src="/img/image-20210722101908062.png" alt="image-20210722101908062"></p>
<h5 id="10-4-3-æ·»åŠ å¹¿å‘Šæ ‡è®°"><a href="#10-4-3-æ·»åŠ å¹¿å‘Šæ ‡è®°" class="headerlink" title="10.4.3.æ·»åŠ å¹¿å‘Šæ ‡è®°"></a>10.4.3.æ·»åŠ å¹¿å‘Šæ ‡è®°</h5><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‘å‡ ä¸ªé…’åº—ï¼Œæ·»åŠ isADå­—æ®µï¼Œè®¾ç½®ä¸ºtrueï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">POST /hotel/_update/<span class="number">1902197537</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â  Â  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">Â  Â  Â  Â  <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">Â  Â  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST /hotel/_update/<span class="number">2056126831</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â  Â  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">Â  Â  Â  Â  <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">Â  Â  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST /hotel/_update/<span class="number">1989806195</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â  Â  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">Â  Â  Â  Â  <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">Â  Â  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST /hotel/_update/<span class="number">2056105938</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â  Â  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">Â  Â  Â  Â  <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">Â  Â  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="10-4-4-æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢"><a href="#10-4-4-æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢" class="headerlink" title="10.4.4.æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢"></a>10.4.4.æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢</h5><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦ä¿®æ”¹æŸ¥è¯¢æ¡ä»¶äº†ã€‚ä¹‹å‰æ˜¯ç”¨çš„boolean æŸ¥è¯¢ï¼Œç°åœ¨è¦æ”¹æˆfunction_socreæŸ¥è¯¢ã€‚<br>function_scoreæŸ¥è¯¢ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/img/image-20210721191544750.png" alt="image-20210721191544750"><br>å¯¹åº”çš„JavaAPIå¦‚ä¸‹ï¼š<br><img src="/img/image-20210722102850818.png" alt="image-20210722102850818"></p>
<p>æˆ‘ä»¬å¯ä»¥å°†ä¹‹å‰å†™çš„booleanæŸ¥è¯¢ä½œä¸º<strong>åŸå§‹æŸ¥è¯¢</strong>æ¡ä»¶æ”¾åˆ°queryä¸­ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ·»åŠ <strong>è¿‡æ»¤æ¡ä»¶</strong>ã€<strong>ç®—åˆ†å‡½æ•°</strong>ã€<strong>åŠ æƒæ¨¡å¼</strong>äº†ã€‚æ‰€ä»¥åŸæ¥çš„ä»£ç ä¾ç„¶å¯ä»¥æ²¿ç”¨ã€‚</p>
<p>åœ¨ Elasticsearch ä¸­ï¼Œ<code>function_score</code> æŸ¥è¯¢æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå…è®¸åœ¨æ‰§è¡ŒæŸ¥è¯¢çš„åŒæ—¶ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„å‡½æ•°æ¥ä¿®æ”¹ç›¸å…³æ–‡æ¡£çš„å¾—åˆ†ã€‚å®ƒä¸»è¦åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼š</p>
<ol>
<li><p><strong>Query (åŸå§‹æŸ¥è¯¢)</strong><br> è¿™æ˜¯ <code>function_score</code> çš„æ ¸å¿ƒæŸ¥è¯¢éƒ¨åˆ†ï¼Œç”¨äºç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ã€‚å¯ä»¥æ˜¯ä»»ä½•æ ‡å‡†çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚ <code>match</code>, <code>term</code>, <code>range</code>, æˆ– <code>bool</code> æŸ¥è¯¢ã€‚è¿™ä¸ªéƒ¨åˆ†å†³å®šäº†å“ªäº›æ–‡æ¡£ä¼šè¿›å…¥åç»­çš„æ‰“åˆ†é˜¶æ®µã€‚</p>
</li>
<li><p><strong>Functions (å‡½æ•°éƒ¨åˆ†)</strong><br> è¿™æ˜¯è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œç”¨äºåŸºäºæŸäº›æ–‡æ¡£å­—æ®µçš„å€¼æˆ–å…¶ä»–ç‰¹æ€§ï¼ˆå¦‚åœ°ç†ä½ç½®ã€éšæœºå€¼ã€æ—¶é—´è¡°å‡ç­‰ï¼‰æ¥è°ƒæ•´æ–‡æ¡£çš„ç›¸å…³æ€§åˆ†æ•°ã€‚é€šè¿‡è¿™äº›å‡½æ•°ï¼Œå¯ä»¥å¯¹åŸå§‹æŸ¥è¯¢è¿”å›çš„æ–‡æ¡£è¿›è¡Œè¿›ä¸€æ­¥çš„æ‰“åˆ†ä¼˜åŒ–æˆ–æ’åºæ“ä½œã€‚å‡½æ•°çš„å®šä¹‰å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p>
<ul>
<li><strong>field_value_factor</strong>: æ ¹æ®æ–‡æ¡£å­—æ®µçš„å€¼è°ƒæ•´åˆ†æ•°ï¼Œæ¯”å¦‚å­—æ®µå€¼çš„çº¿æ€§å˜æ¢ã€‚</li>
<li><strong>decay functions</strong>: æä¾›è·ç¦»ã€æ—¶é—´ç­‰çš„è¡°å‡å‡½æ•°ï¼ŒåŒ…æ‹¬ <code>gauss</code>, <code>exp</code>, <code>linear</code>ã€‚</li>
<li><strong>random_score</strong>: ç”¨äºç”Ÿæˆéšæœºæ’åºã€‚</li>
<li><strong>script_score</strong>: ä½¿ç”¨è„šæœ¬çµæ´»åœ°å®šä¹‰è®¡ç®—é€»è¾‘ã€‚</li>
<li><strong>weight</strong>: ä¸ºæ¯ä¸ªå‡½æ•°èµ‹äºˆä¸€ä¸ªæƒé‡ã€‚</li>
</ul>
</li>
</ol>
<p>ä¿®æ”¹<code>cn.itcast.hotel.service.impl</code>åŒ…ä¸‹çš„<code>HotelService</code>ç±»ä¸­çš„<code>buildBasicQuery</code>æ–¹æ³•ï¼Œæ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildBasicQuery</span><span class="params">(RequestParams params, SearchRequest request)</span> &#123;</span><br><span class="line">Â  Â  <span class="comment">// 1.æ„å»ºBooleanQuery</span></span><br><span class="line">Â  Â  <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">Â  Â  <span class="comment">// å…³é”®å­—æœç´¢</span></span><br><span class="line">Â  Â  <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">Â  Â  <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.must(QueryBuilders.matchAllQuery());</span><br><span class="line">Â  Â  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// åŸå¸‚æ¡ä»¶</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (params.getCity() != <span class="literal">null</span> &amp;&amp; !params.getCity().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, params.getCity()));</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// å“ç‰Œæ¡ä»¶</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (params.getBrand() != <span class="literal">null</span> &amp;&amp; !params.getBrand().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;brand&quot;</span>, params.getBrand()));</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// æ˜Ÿçº§æ¡ä»¶</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (params.getStarName() != <span class="literal">null</span> &amp;&amp; !params.getStarName().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;starName&quot;</span>, params.getStarName()));</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// ä»·æ ¼</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (params.getMinPrice() != <span class="literal">null</span> &amp;&amp; params.getMaxPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  boolQuery.filter(QueryBuilders</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .rangeQuery(<span class="string">&quot;price&quot;</span>)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .gte(params.getMinPrice())</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .lte(params.getMaxPrice())</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );</span><br><span class="line">Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment">// 2.ç®—åˆ†æ§åˆ¶</span></span><br><span class="line"></span><br><span class="line">Â  Â  <span class="type">FunctionScoreQueryBuilder</span> <span class="variable">functionScoreQuery</span> <span class="operator">=</span></span><br><span class="line">Â  Â  Â  Â  QueryBuilders.functionScoreQuery(</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// åŸå§‹æŸ¥è¯¢ï¼Œç›¸å…³æ€§ç®—åˆ†çš„æŸ¥è¯¢</span></span><br><span class="line">Â  Â  Â  Â  boolQuery,</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// function scoreçš„æ•°ç»„</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder[]&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// å…¶ä¸­çš„ä¸€ä¸ªfunction score å…ƒç´ </span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  QueryBuilders.termQuery(<span class="string">&quot;isAD&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// ç®—åˆ†å‡½æ•°</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  ScoreFunctionBuilders.weightFactorFunction(<span class="number">10</span>)</span><br><span class="line">Â  Â  Â  Â  Â  Â  )</span><br><span class="line">Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  request.source().query(functionScoreQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://dirtydata.cn">Maple</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://dirtydata.cn/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E5%9F%BA%E7%A1%80/">https://dirtydata.cn/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E5%9F%BA%E7%A1%80/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://dirtydata.cn" target="_blank">æ«å¶</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Elasticsearch/">Elasticsearch</a></div><div class="post_share"><div class="social-share" data-image="/img/es.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat-pay.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat-pay.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E8%BF%9B%E9%98%B6/" title="Elasticsearchæ•™ç¨‹ (äºŒ)"><img class="cover" src="/images/es.png" onerror="onerror=null;src='https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/404-bg.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Elasticsearchæ•™ç¨‹ (äºŒ)</div></div></a></div><div class="next-post pull-right"><a href="/uncategorized/RocketMQ%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" title=""><img class="cover" src="/img/default-bg-2.png" onerror="onerror=null;src='https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/404-bg.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info"></div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E8%BF%9B%E9%98%B6/" title="Elasticsearchæ•™ç¨‹ (äºŒ)"><img class="cover" src="/images/es.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-26</div><div class="title">Elasticsearchæ•™ç¨‹ (äºŒ)</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/gufengnantou.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Maple</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/02maple"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/02maple" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/18273659@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">Hi! Welcome á••( á› )á•—</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ES-%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">ES ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ES-%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">ES å®‰è£…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#es%E7%9A%84ik%E5%88%86%E8%AF%8D%E5%99%A8%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.1.</span> <span class="toc-text">esçš„ikåˆ†è¯å™¨å®‰è£…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES-head%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">ES-headæ’ä»¶å®‰è£…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES%E5%9F%BA%E7%A1%80http%E8%B0%83%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">ESåŸºç¡€httpè°ƒç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-data-es%E5%9F%BA%E7%A1%80%E8%B0%83%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">spring-data-esåŸºç¡€è°ƒç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-ES-%E5%B7%A5%E5%85%B7"><span class="toc-number">1.5.</span> <span class="toc-text">è‡ªå®šä¹‰ ES å·¥å…·</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E9%9B%86%E7%BE%A4-ES-%E8%BF%9E%E6%8E%A5%EF%BC%8C%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.1.</span> <span class="toc-text">å°è£…é›†ç¾¤ ES è¿æ¥ï¼Œç»Ÿä¸€é…ç½®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ES-%E5%AD%A6%E4%B9%A0"><span class="toc-number">2.</span> <span class="toc-text">ES å­¦ä¹ </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">2.1.</span> <span class="toc-text">1. å€’æ’ç´¢å¼•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-ES-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">2.2.</span> <span class="toc-text">2. ES æ•°æ®åº“åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">3. IKåˆ†è¯å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E8%AF%8D%E8%AF%8D%E5%85%B8"><span class="toc-number">2.3.1.</span> <span class="toc-text">æ‰©å±•è¯è¯å…¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E7%94%A8%E8%AF%8D%E8%AF%8D%E5%85%B8"><span class="toc-number">2.3.2.</span> <span class="toc-text">åœç”¨è¯è¯å…¸</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%B4%A2%E5%BC%95%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">2.4.</span> <span class="toc-text">4. ç´¢å¼•åº“æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mapping%E6%98%A0%E5%B0%84%E5%B1%9E%E6%80%A7"><span class="toc-number">2.4.1.</span> <span class="toc-text">Mappingæ˜ å°„å±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%BA%93-CRUD"><span class="toc-number">2.4.2.</span> <span class="toc-text">ç´¢å¼•åº“ CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%BA%93%E5%92%8C%E6%98%A0%E5%B0%84"><span class="toc-number">2.4.2.1.</span> <span class="toc-text">1.  åˆ›å»ºç´¢å¼•åº“å’Œæ˜ å°„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-number">2.4.2.2.</span> <span class="toc-text">2. æŸ¥è¯¢ç´¢å¼•åº“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-number">2.4.2.3.</span> <span class="toc-text">3. ä¿®æ”¹ç´¢å¼•åº“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-number">2.4.2.4.</span> <span class="toc-text">4. åˆ é™¤ç´¢å¼•åº“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-number">2.5.</span> <span class="toc-text">5. æ–‡æ¡£æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%96%B0%E5%A2%9E%E6%96%87%E6%A1%A3"><span class="toc-number">2.5.0.1.</span> <span class="toc-text">1. æ–°å¢æ–‡æ¡£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">2.5.0.2.</span> <span class="toc-text">2. æŸ¥è¯¢æ–‡æ¡£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">2.5.0.3.</span> <span class="toc-text">3. åˆ é™¤æ–‡æ¡£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">2.5.0.4.</span> <span class="toc-text">4. ä¿®æ”¹æ–‡æ¡£</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-RestClient-%E6%93%8D%E4%BD%9C%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-number">2.6.</span> <span class="toc-text">6. RestClient æ“ä½œç´¢å¼•åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#API%E6%93%8D%E4%BD%9C%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-number">2.6.1.</span> <span class="toc-text">APIæ“ä½œç´¢å¼•åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-mapping%E6%98%A0%E5%B0%84%E5%88%86%E6%9E%90"><span class="toc-number">2.6.1.1.</span> <span class="toc-text">1. mappingæ˜ å°„åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%9D%E5%A7%8B%E5%8C%96RestClient"><span class="toc-number">2.6.1.2.</span> <span class="toc-text">2. åˆå§‹åŒ–RestClient</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Client-%E7%B4%A2%E5%BC%95%E5%BA%93CRUD"><span class="toc-number">2.6.1.3.</span> <span class="toc-text">3. Client ç´¢å¼•åº“CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-number">2.6.1.3.1.</span> <span class="toc-text">3.1 åˆ›å»ºç´¢å¼•åº“</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-number">2.6.1.3.2.</span> <span class="toc-text">3.2 åˆ é™¤ç´¢å¼•åº“</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-number">2.6.1.3.3.</span> <span class="toc-text">3.3 æŸ¥è¯¢ç´¢å¼•åº“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3"><span class="toc-number">2.6.2.</span> <span class="toc-text">APIæ“ä½œæ–‡æ¡£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E6%96%87%E6%A1%A3"><span class="toc-number">2.6.2.1.</span> <span class="toc-text">æ–°å¢æ–‡æ¡£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">2.6.2.2.</span> <span class="toc-text">æŸ¥è¯¢æ–‡æ¡£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">2.6.2.3.</span> <span class="toc-text">ä¿®æ”¹æ–‡æ¡£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">2.6.2.4.</span> <span class="toc-text">åˆ é™¤æ–‡æ¡£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E6%96%87%E6%A1%A3"><span class="toc-number">2.6.2.5.</span> <span class="toc-text">æ‰¹é‡å¯¼å…¥æ–‡æ¡£</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-ES-%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E"><span class="toc-number">2.7.</span> <span class="toc-text">7. ES æœç´¢å¼•æ“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-DSL%E8%AE%BE%E7%BD%AE%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.7.1.</span> <span class="toc-text">7.1. DSLè®¾ç½®æŸ¥è¯¢æ¡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-1-DSL%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="toc-number">2.7.1.1.</span> <span class="toc-text">7.1.1 DSLæŸ¥è¯¢åˆ†ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-2-%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.2.</span> <span class="toc-text">7.1.2 å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-1-2-1-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.7.1.2.1.</span> <span class="toc-text">7.1.2.1 ä½¿ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-1-2-2-match%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.2.2.</span> <span class="toc-text">7.1.2.2 matchæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-1-2-3-mulit-match%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.2.3.</span> <span class="toc-text">7.1.2.3 mulit_matchæŸ¥è¯¢</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-3-%E7%B2%BE%E5%87%86%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.3.</span> <span class="toc-text">7.1.3 ç²¾å‡†æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-1-term%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.3.1.</span> <span class="toc-text">1.3.1 termæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-2-range%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.3.2.</span> <span class="toc-text">1.3.2 rangeæŸ¥è¯¢</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-4-%E5%9C%B0%E7%90%86%E5%9D%90%E6%A0%87%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.4.</span> <span class="toc-text">7.1.4 åœ°ç†åæ ‡æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-1-%E7%9F%A9%E5%BD%A2%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.4.1.</span> <span class="toc-text">1.4.1 çŸ©å½¢èŒƒå›´æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-2-%E9%99%84%E8%BF%91-%E5%9C%86%E5%BD%A2-%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.4.2.</span> <span class="toc-text">1.4.2 é™„è¿‘(åœ†å½¢)æŸ¥è¯¢</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-5-%E5%A4%8D%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.5.</span> <span class="toc-text">7.1.5.å¤åˆæŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-5-1-%E7%9B%B8%E5%85%B3%E6%80%A7%E7%AE%97%E5%88%86"><span class="toc-number">2.7.1.5.1.</span> <span class="toc-text">1.5.1.ç›¸å…³æ€§ç®—åˆ†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-5-2-%E7%AE%97%E5%88%86%E5%87%BD%E6%95%B0%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.5.2.</span> <span class="toc-text">1.5.2.ç®—åˆ†å‡½æ•°æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-5-3-%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.7.1.5.3.</span> <span class="toc-text">1.5.3.å¸ƒå°”æŸ¥è¯¢</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%A4%84%E7%90%86"><span class="toc-number">2.8.</span> <span class="toc-text">8.æœç´¢ç»“æœå¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E6%8E%92%E5%BA%8F"><span class="toc-number">2.8.0.1.</span> <span class="toc-text">8.1.æ’åº</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-1-1-%E6%99%AE%E9%80%9A%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F"><span class="toc-number">2.8.0.1.1.</span> <span class="toc-text">8.1.1.æ™®é€šå­—æ®µæ’åº</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-1-2-%E5%9C%B0%E7%90%86%E5%9D%90%E6%A0%87%E6%8E%92%E5%BA%8F"><span class="toc-number">2.8.0.1.2.</span> <span class="toc-text">8.1.2.åœ°ç†åæ ‡æ’åº</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E5%88%86%E9%A1%B5"><span class="toc-number">2.8.0.2.</span> <span class="toc-text">8.2.åˆ†é¡µ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-1-%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%88%86%E9%A1%B5"><span class="toc-number">2.8.0.2.1.</span> <span class="toc-text">8.2.1.åŸºæœ¬çš„åˆ†é¡µ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-2-%E6%B7%B1%E5%BA%A6%E5%88%86%E9%A1%B5%E9%97%AE%E9%A2%98"><span class="toc-number">2.8.0.2.2.</span> <span class="toc-text">8.2.2.æ·±åº¦åˆ†é¡µé—®é¢˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-3-%E5%B0%8F%E7%BB%93"><span class="toc-number">2.8.0.2.3.</span> <span class="toc-text">8.2.3.å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-%E9%AB%98%E4%BA%AE"><span class="toc-number">2.8.0.3.</span> <span class="toc-text">8.3.é«˜äº®</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-3-1-%E9%AB%98%E4%BA%AE%E5%8E%9F%E7%90%86"><span class="toc-number">2.8.0.3.1.</span> <span class="toc-text">8.3.1.é«˜äº®åŸç†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-%E5%AE%9E%E7%8E%B0%E9%AB%98%E4%BA%AE"><span class="toc-number">2.8.0.3.2.</span> <span class="toc-text">2.3.2.å®ç°é«˜äº®</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-%E6%80%BB%E7%BB%93"><span class="toc-number">2.8.0.4.</span> <span class="toc-text">8.4.æ€»ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-RestClient%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">2.9.</span> <span class="toc-text">9.RestClientæŸ¥è¯¢æ–‡æ¡£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">2.9.0.1.</span> <span class="toc-text">9.1.å¿«é€Ÿå…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-1-1-%E5%8F%91%E8%B5%B7%E6%9F%A5%E8%AF%A2%E8%AF%B7%E6%B1%82"><span class="toc-number">2.9.0.1.1.</span> <span class="toc-text">9.1.1.å‘èµ·æŸ¥è¯¢è¯·æ±‚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-1-2-%E8%A7%A3%E6%9E%90%E5%93%8D%E5%BA%94"><span class="toc-number">2.9.0.1.2.</span> <span class="toc-text">9.1.2.è§£æå“åº”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-1-3-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">2.9.0.1.3.</span> <span class="toc-text">9.1.3.å®Œæ•´ä»£ç </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-1-4-%E5%B0%8F%E7%BB%93"><span class="toc-number">2.9.0.1.4.</span> <span class="toc-text">9.1.4.å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-match%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.9.0.2.</span> <span class="toc-text">9.2.matchæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.9.0.3.</span> <span class="toc-text">9.3.ç²¾ç¡®æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-4-%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.9.0.4.</span> <span class="toc-text">9.4.å¸ƒå°”æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-%E6%8E%92%E5%BA%8F%E3%80%81%E5%88%86%E9%A1%B5"><span class="toc-number">2.9.0.5.</span> <span class="toc-text">9.5.æ’åºã€åˆ†é¡µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-%E9%AB%98%E4%BA%AE"><span class="toc-number">2.9.0.6.</span> <span class="toc-text">9.6.é«˜äº®</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-6-1-%E9%AB%98%E4%BA%AE%E8%AF%B7%E6%B1%82%E6%9E%84%E5%BB%BA"><span class="toc-number">2.9.0.6.1.</span> <span class="toc-text">9.6.1.é«˜äº®è¯·æ±‚æ„å»º</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-6-2-%E9%AB%98%E4%BA%AE%E7%BB%93%E6%9E%9C%E8%A7%A3%E6%9E%90"><span class="toc-number">2.9.0.6.2.</span> <span class="toc-text">9.6.2.é«˜äº®ç»“æœè§£æ</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E6%97%85%E6%B8%B8%E6%A1%88%E4%BE%8B"><span class="toc-number">2.10.</span> <span class="toc-text">10.æ—…æ¸¸æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-%E9%85%92%E5%BA%97%E6%90%9C%E7%B4%A2%E5%92%8C%E5%88%86%E9%A1%B5"><span class="toc-number">2.10.0.1.</span> <span class="toc-text">10.1.é…’åº—æœç´¢å’Œåˆ†é¡µ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">2.10.0.1.1.</span> <span class="toc-text">10.1.1.éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-1-3-%E5%AE%9A%E4%B9%89controller"><span class="toc-number">2.10.0.1.2.</span> <span class="toc-text">10.1.3.å®šä¹‰controller</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-%E9%85%92%E5%BA%97%E7%BB%93%E6%9E%9C%E8%BF%87%E6%BB%A4"><span class="toc-number">2.10.0.2.</span> <span class="toc-text">10.2.é…’åº—ç»“æœè¿‡æ»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">2.10.0.2.1.</span> <span class="toc-text">10.2.1.éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-2-2-%E4%BF%AE%E6%94%B9%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">2.10.0.2.2.</span> <span class="toc-text">10.2.2.ä¿®æ”¹å®ä½“ç±»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-2-3-%E4%BF%AE%E6%94%B9%E6%90%9C%E7%B4%A2%E4%B8%9A%E5%8A%A1"><span class="toc-number">2.10.0.2.3.</span> <span class="toc-text">10.2.3.ä¿®æ”¹æœç´¢ä¸šåŠ¡</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-%E6%88%91%E5%91%A8%E8%BE%B9%E7%9A%84%E9%85%92%E5%BA%97"><span class="toc-number">2.10.0.3.</span> <span class="toc-text">10.3.æˆ‘å‘¨è¾¹çš„é…’åº—</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">2.10.0.3.1.</span> <span class="toc-text">10.3.1.éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-3-2-%E4%BF%AE%E6%94%B9%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">2.10.0.3.2.</span> <span class="toc-text">10.3.2.ä¿®æ”¹å®ä½“ç±»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-3-3-%E8%B7%9D%E7%A6%BB%E6%8E%92%E5%BA%8FAPI"><span class="toc-number">2.10.0.3.3.</span> <span class="toc-text">10.3.3.è·ç¦»æ’åºAPI</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-3-4-%E6%B7%BB%E5%8A%A0%E8%B7%9D%E7%A6%BB%E6%8E%92%E5%BA%8F"><span class="toc-number">2.10.0.3.4.</span> <span class="toc-text">10.3.4.æ·»åŠ è·ç¦»æ’åº</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-3-5-%E6%8E%92%E5%BA%8F%E8%B7%9D%E7%A6%BB%E6%98%BE%E7%A4%BA"><span class="toc-number">2.10.0.3.5.</span> <span class="toc-text">10.3.5.æ’åºè·ç¦»æ˜¾ç¤º</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-%E9%85%92%E5%BA%97%E7%AB%9E%E4%BB%B7%E6%8E%92%E5%90%8D"><span class="toc-number">2.10.0.4.</span> <span class="toc-text">10.4.é…’åº—ç«ä»·æ’å</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">2.10.0.4.1.</span> <span class="toc-text">10.4.1.éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-2-%E4%BF%AE%E6%94%B9HotelDoc%E5%AE%9E%E4%BD%93"><span class="toc-number">2.10.0.4.2.</span> <span class="toc-text">10.4.2.ä¿®æ”¹HotelDocå®ä½“</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-3-%E6%B7%BB%E5%8A%A0%E5%B9%BF%E5%91%8A%E6%A0%87%E8%AE%B0"><span class="toc-number">2.10.0.4.3.</span> <span class="toc-text">10.4.3.æ·»åŠ å¹¿å‘Šæ ‡è®°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-4-%E6%B7%BB%E5%8A%A0%E7%AE%97%E5%88%86%E5%87%BD%E6%95%B0%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.10.0.4.4.</span> <span class="toc-text">10.4.4.æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E8%BF%9B%E9%98%B6/" title="Elasticsearchæ•™ç¨‹ (äºŒ)"><img src="/images/es.png" onerror="this.onerror=null;this.src='https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/404-bg.jpg'" alt="Elasticsearchæ•™ç¨‹ (äºŒ)"/></a><div class="content"><a class="title" href="/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E8%BF%9B%E9%98%B6/" title="Elasticsearchæ•™ç¨‹ (äºŒ)">Elasticsearchæ•™ç¨‹ (äºŒ)</a><time datetime="2024-12-25T16:00:00.000Z" title="å‘è¡¨äº 2024-12-26 00:00:00">2024-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E5%9F%BA%E7%A1%80/" title="Elasticsearchæ•™ç¨‹ (ä¸€)"><img src="/img/es.png" onerror="this.onerror=null;this.src='https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/404-bg.jpg'" alt="Elasticsearchæ•™ç¨‹ (ä¸€)"/></a><div class="content"><a class="title" href="/%E6%A1%86%E6%9E%B6%E6%95%99%E7%A8%8B/ES%20%E5%9F%BA%E7%A1%80/" title="Elasticsearchæ•™ç¨‹ (ä¸€)">Elasticsearchæ•™ç¨‹ (ä¸€)</a><time datetime="2024-12-25T16:00:00.000Z" title="å‘è¡¨äº 2024-12-26 00:00:00">2024-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/uncategorized/RocketMQ%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" title="æ— é¢˜"><img src="/img/default-bg-2.png" onerror="this.onerror=null;this.src='https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/404-bg.jpg'" alt="æ— é¢˜"/></a><div class="content"><a class="title" href="/uncategorized/RocketMQ%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" title="æ— é¢˜">æ— é¢˜</a><time datetime="2024-11-10T17:11:24.050Z" title="å‘è¡¨äº 2024-11-11 01:11:24">2024-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%AE%9E%E8%B7%B5/%E7%AE%80%E8%BF%B0%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="ç®€å•çš„è®¾è®¡æ¨¡å¼"><img src="/img/default-bg-1.png" onerror="this.onerror=null;this.src='https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/404-bg.jpg'" alt="ç®€å•çš„è®¾è®¡æ¨¡å¼"/></a><div class="content"><a class="title" href="/%E5%AE%9E%E8%B7%B5/%E7%AE%80%E8%BF%B0%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="ç®€å•çš„è®¾è®¡æ¨¡å¼">ç®€å•çš„è®¾è®¡æ¨¡å¼</a><time datetime="2024-07-25T16:00:00.000Z" title="å‘è¡¨äº 2024-07-26 00:00:00">2024-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/uncategorized/WeChat+Sa-token%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" title="WeChat+Sa-tokenå®ç°æ‰«ç ç™»å½•"><img src="https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/20240830163001.png" onerror="this.onerror=null;this.src='https://images-1318456035.cos.ap-shanghai.myqcloud.com/imgs/404-bg.jpg'" alt="WeChat+Sa-tokenå®ç°æ‰«ç ç™»å½•"/></a><div class="content"><a class="title" href="/uncategorized/WeChat+Sa-token%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" title="WeChat+Sa-tokenå®ç°æ‰«ç ç™»å½•">WeChat+Sa-tokenå®ç°æ‰«ç ç™»å½•</a><time datetime="2024-07-15T16:00:00.000Z" title="å‘è¡¨äº 2024-07-16 00:00:00">2024-07-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/es.png')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Maple</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welcome to maple's blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>